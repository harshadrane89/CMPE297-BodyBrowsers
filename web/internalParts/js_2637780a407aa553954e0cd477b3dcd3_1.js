var OpenLayers={singleFile:true};(function(){var a=typeof OpenLayers=="object"&&OpenLayers.singleFile;window.OpenLayers={_scriptName:!a?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){var a="";var b=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");var c=document.getElementsByTagName("script");for(var d=0,e=c.length;d<e;d++){var f=c[d].getAttribute("src");if(f){var g=f.match(b);if(g){a=g[1];break}}}return a}};if(!a){var b=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js");var c=navigator.userAgent;var d=c.match("MSIE")||c.match("Safari");if(d){var e=new Array(b.length)}var f=OpenLayers._getScriptLocation()+"lib/";for(var g=0,h=b.length;g<h;g++){if(d){e[g]="<script src='"+f+b[g]+"'></script>"}else{var i=document.createElement("script");i.src=f+b[g];var j=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;j.appendChild(i)}}if(d){document.write(e.join(""))}}})();OpenLayers.VERSION_NUMBER="OpenLayers 2.8 -- $Revision: 9492 $";OpenLayers.String={startsWith:function(a,b){return a.indexOf(b)==0},contains:function(a,b){return a.indexOf(b)!=-1},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){var b=a.split("-");var c=b[0];for(var d=1,e=b.length;d<e;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},format:function(a,b,c){if(!b){b=window}var d=function(a,d){var e;var f=d.split(/\.+/);for(var g=0;g<f.length;g++){if(g==0){e=b}e=e[f[g]]}if(typeof e=="function"){e=c?e.apply(null,c):e()}if(typeof e=="undefined"){return"undefined"}else{return e}};return a.replace(OpenLayers.String.tokenRegEx,d)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a)}}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a)}}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this)}}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this)}}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;if(b>0){c=parseFloat(a.toPrecision(b))}return c},format:function(a,b,c,d){b=typeof b!="undefined"?b:0;c=typeof c!="undefined"?c:OpenLayers.Number.thousandsSeparator;d=typeof d!="undefined"?d:OpenLayers.Number.decimalSeparator;if(b!=null){a=parseFloat(a.toFixed(b))}var e=a.toString().split(".");if(e.length==1&&b==null){b=0}var f=e[0];if(c){var g=/(-?[0-9]+)([0-9]{3})/;while(g.test(f)){f=f.replace(g,"$1"+c+"$2")}}var h;if(b==0){h=f}else{var i=e.length>1?e[1]:"0";if(b!=null){i=i+(new Array(b-i.length+1)).join("0")}h=f+d+i}return h}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,a)}}OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments)}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a)}}OpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter){d=a.filter(b,c)}else{var e=a.length;if(typeof b!="function"){throw new TypeError}for(var f=0;f<e;f++){if(f in a){var g=a[f];if(b.call(c,g,f,a)){d.push(g)}}}}return d}};OpenLayers.Class=function(){var a=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}};var b={};var c,d;for(var e=0,f=arguments.length;e<f;++e){if(typeof arguments[e]=="function"){if(e==0&&f>1){d=arguments[e].prototype.initialize;arguments[e].prototype.initialize=function(){};b=new arguments[e];if(d===undefined){delete arguments[e].prototype.initialize}else{arguments[e].prototype.initialize=d}}c=arguments[e].prototype}else{c=arguments[e]}OpenLayers.Util.extend(b,c)}a.prototype=b;return a};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}}};OpenLayers.Class.inherit=function(){var a=arguments[0];var b=new a(OpenLayers.Class.isPrototype);for(var c=1,d=arguments.length;c<d;c++){if(typeof arguments[c]=="function"){var e=arguments[c];arguments[c]=new e(OpenLayers.Class.isPrototype)}OpenLayers.Util.extend(b,arguments[c])}return b};OpenLayers.Util={};OpenLayers.Util.getElement=function(){var a=[];for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];if(typeof d=="string"){d=document.getElementById(d)}if(arguments.length==1){return d}a.push(d)}return a};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement}OpenLayers.Util.extend=function(a,b){a=a||{};if(b){for(var c in b){var d=b[c];if(d!==undefined){a[c]=d}}var e=typeof window.Event=="function"&&b instanceof window.Event;if(!e&&b.hasOwnProperty&&b.hasOwnProperty("toString")){a.toString=b.toString}}return a};OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--){if(a[c]==b){a.splice(c,1)}}return a};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0};OpenLayers.Util.indexOf=function(a,b){for(var c=0,d=a.length;c<d;c++){if(a[c]==b){return c}}return-1};OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){if(b){a.id=b}if(c){a.style.left=c.x+"px";a.style.top=c.y+"px"}if(d){a.style.width=d.w+"px";a.style.height=d.h+"px"}if(e){a.style.position=e}if(f){a.style.border=f}if(g){a.style.overflow=g}if(parseFloat(h)>=0&&parseFloat(h)<1){a.style.filter="alpha(opacity="+h*100+")";a.style.opacity=h}else if(parseFloat(h)==1){a.style.filter="";a.style.opacity=""}};OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");if(d){i.style.backgroundImage="url("+d+")"}if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!e){e="absolute"}OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,g,h);return i};OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){var i=document.createElement("img");if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!e){e="relative"}OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,null,g);if(h){i.style.display="none";OpenLayers.Event.observe(i,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,i));OpenLayers.Event.observe(i,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,i))}i.style.alt=a;i.galleryImg="no";if(d){i.src=d}return i};OpenLayers.Util.setOpacity=function(a,b){OpenLayers.Util.modifyDOMElement(a,null,null,null,null,null,null,b)};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||this.map&&this.viewRequestID==this.map.viewRequestID){this.style.backgroundColor="transparent";this.style.display=""}};OpenLayers.Util.onImageLoadErrorColor="pink";OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=this._attempts?this._attempts+1:1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var a=this.urls;if(a&&a instanceof Array&&a.length>1){var b=this.src.toString();var c,d;for(d=0;c=a[d];d++){if(b.indexOf(c)!=-1){break}}var e=Math.floor(a.length*Math.random());var f=a[e];d=0;while(f==c&&d++<4){e=Math.floor(a.length*Math.random());f=a[e]}this.src=b.replace(c,f)}else{this.src=this.src}}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor}this.style.display=""};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var a=navigator.appVersion.split("MSIE");var b=parseFloat(a[1]);var c=false;try{c=!!document.body.filters}catch(d){}OpenLayers.Util.alphaHackNeeded=c&&b>=5.5&&b<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,i);var j=a.childNodes[0];if(e){j.src=e}OpenLayers.Util.modifyDOMElement(j,a.id+"_innerImage",null,d,"relative",g);if(OpenLayers.Util.alphaHack()){if(a.style.display!="none"){a.style.display="inline-block"}if(h==null){h="scale"}a.style.filter="progid:DXImageTransform.Microsoft"+".AlphaImageLoader(src='"+j.src+"', "+"sizingMethod='"+h+"')";if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1){a.style.filter+=" alpha(opacity="+a.style.opacity*100+")"}j.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=OpenLayers.Util.createDiv();var k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);j.appendChild(k);if(i){k.style.display="none";OpenLayers.Event.observe(k,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,j));OpenLayers.Event.observe(k,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,j))}OpenLayers.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h);return j};OpenLayers.Util.upperCaseObject=function(a){var b={};for(var c in a){b[c.toUpperCase()]=a[c]}return b};OpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c=typeof window.Event=="function"&&b instanceof window.Event;for(var d in b){if(a[d]===undefined||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d)){a[d]=b[d]}}if(!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")){a.toString=b.toString}return a};OpenLayers.Util.getParameterString=function(a){var b=[];for(var c in a){var d=a[c];if(d!=null&&typeof d!="function"){var e;if(typeof d=="object"&&d.constructor==Array){var f=[];for(var g=0,h=d.length;g<h;g++){f.push(encodeURIComponent(d[g]))}e=f.join(",")}else{e=encodeURIComponent(d)}b.push(encodeURIComponent(c)+"="+e)}}return b.join("&")};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.Try=function(){var a=null;for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a};OpenLayers.Util.getNodes=function(a,b){var c=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(a.documentElement.childNodes,b)},function(){return OpenLayers.Util._getNodes(a.childNodes,b)});return c};OpenLayers.Util._getNodes=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){if(a[d].nodeName==b){c.push(a[d])}}return c};OpenLayers.Util.getTagText=function(a,b,c){var d=OpenLayers.Util.getNodes(a,b);if(d&&d.length>0){if(!c){c=0}if(d[c].childNodes.length>1){return d.childNodes[1].nodeValue}else if(d[c].childNodes.length==1){return d[c].firstChild.nodeValue}}else{return""}};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent}if(!b){b=a.firstChild.nodeValue}},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,b){var c=a.relatedTarget?a.relatedTarget:a.toElement;while(c!=b&&c!=null){c=c.parentNode}return c!=b};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(a,b){if(b==null){b=OpenLayers.Util.DEFAULT_PRECISION}var a;if(b==0){a=parseFloat(a)}else{a=parseFloat(parseFloat(a).toPrecision(b))}return a};OpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.distVincenty=function(a,b){var c=6378137,d=6356752.3142,e=1/298.257223563;var f=OpenLayers.Util.rad(b.lon-a.lon);var g=Math.atan((1-e)*Math.tan(OpenLayers.Util.rad(a.lat)));var h=Math.atan((1-e)*Math.tan(OpenLayers.Util.rad(b.lat)));var i=Math.sin(g),j=Math.cos(g);var k=Math.sin(h),l=Math.cos(h);var m=f,n=2*Math.PI;var o=20;while(Math.abs(m-n)>1e-12&&--o>0){var p=Math.sin(m),q=Math.cos(m);var r=Math.sqrt(l*p*l*p+(j*k-i*l*q)*(j*k-i*l*q));if(r==0){return 0}var s=i*k+j*l*q;var t=Math.atan2(r,s);var u=Math.asin(j*l*p/r);var v=Math.cos(u)*Math.cos(u);var w=s-2*i*k/v;var x=e/16*v*(4+e*(4-3*v));n=m;m=f+(1-x)*e*Math.sin(u)*(t+x*r*(w+x*s*(-1+2*w*w)))}if(o==0){return NaN}var y=v*(c*c-d*d)/(d*d);var z=1+y/16384*(4096+y*(-768+y*(320-175*y)));var A=y/1024*(256+y*(-128+y*(74-47*y)));var B=A*r*(w+A/4*(s*(-1+2*w*w)-A/6*w*(-3+4*r*r)*(-3+4*w*w)));var C=d*z*(t-B);var D=C.toFixed(3)/1e3;return D};OpenLayers.Util.getParameters=function(a){a=a||window.location.href;var b="";if(OpenLayers.String.contains(a,"?")){var c=a.indexOf("?")+1;var d=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length;b=a.substring(c,d)}var e={};var f=b.split(/[&;]/);for(var g=0,h=f.length;g<h;++g){var i=f[g].split("=");if(i[0]){var j=decodeURIComponent(i[0]);var k=i[1]||"";k=k.split(",");for(var l=0,m=k.length;l<m;l++){k[l]=decodeURIComponent(k[l])}if(k.length==1){k=k[0]}e[j]=k}}return e};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a)};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_"}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT["degrees"]=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT["nmi"]=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT["Meter"]/1e3,cm:OpenLayers.INCHES_PER_UNIT["Meter"]/100,dm:OpenLayers.INCHES_PER_UNIT["Meter"]*100,km:OpenLayers.INCHES_PER_UNIT["Meter"]*1e3,kmi:OpenLayers.INCHES_PER_UNIT["nmi"],fath:OpenLayers.INCHES_PER_UNIT["Fathom"],ch:OpenLayers.INCHES_PER_UNIT["IntnlChain"],link:OpenLayers.INCHES_PER_UNIT["IntnlLink"],"us-in":OpenLayers.INCHES_PER_UNIT["inches"],"us-ft":OpenLayers.INCHES_PER_UNIT["Foot"],"us-yd":OpenLayers.INCHES_PER_UNIT["Yard"],"us-ch":OpenLayers.INCHES_PER_UNIT["GunterChain"],"us-mi":OpenLayers.INCHES_PER_UNIT["Mile"],"ind-yd":OpenLayers.INCHES_PER_UNIT["IndianYd37"],"ind-ft":OpenLayers.INCHES_PER_UNIT["IndianFt37"],"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(a){var b=a>1?1/a:a;return b};OpenLayers.Util.getResolutionFromScale=function(a,b){if(b==null){b="degrees"}var c=OpenLayers.Util.normalizeScale(a);var d=1/(c*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH);return d};OpenLayers.Util.getScaleFromResolution=function(a,b){if(b==null){b="degrees"}var c=a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH;return c};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true)};OpenLayers.Util.pagePosition=function(a){var b=0,c=0;var d=a;var e=a;while(d){if(d==document.body){if(OpenLayers.Element.getStyle(e,"position")=="absolute"){break}}b+=d.offsetTop||0;c+=d.offsetLeft||0;e=d;try{d=d.offsetParent}catch(f){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:d.id}));break}}d=a;while(d){b-=d.scrollTop||0;c-=d.scrollLeft||0;d=d.parentNode}return[c,b]};OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{};OpenLayers.Util.applyDefaults(c,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var d=OpenLayers.Util.createUrlObject(a,c);var e=OpenLayers.Util.createUrlObject(b,c);for(var f in d){if(f!=="args"){if(d[f]!=e[f]){return false}}}for(var f in d.args){if(d.args[f]!=e.args[f]){return false}delete e.args[f]}for(var f in e.args){return false}return true};OpenLayers.Util.createUrlObject=function(a,b){b=b||{};if(!/^\w+:\/\//.test(a)){var c=window.location;var d=c.port?":"+c.port:"";var e=c.protocol+"//"+c.host.split(":").shift()+d;if(a.indexOf("/")===0){a=e+a}else{var f=c.pathname.split("/");f.pop();a=e+f.join("/")+"/"+a}}if(b.ignoreCase){a=a.toLowerCase()}var g=document.createElement("a");g.href=a;var h={};h.host=g.host.split(":").shift();h.protocol=g.protocol;if(b.ignorePort80){h.port=g.port=="80"||g.port=="0"?"":g.port}else{h.port=g.port==""||g.port=="0"?"80":g.port}h.hash=b.ignoreHash||g.hash==="#"?"":g.hash;var i=g.search;if(!i){var j=a.indexOf("?");i=j!=-1?a.substr(j):""}h.args=OpenLayers.Util.getParameters(i);h.pathname=g.pathname.charAt(0)=="/"?g.pathname:"/"+g.pathname;return h};OpenLayers.Util.removeTail=function(a){var b=null;var c=a.indexOf("?");var d=a.indexOf("#");if(c==-1){b=d!=-1?a.substr(0,d):a}else{b=d!=-1?a.substr(0,Math.min(c,d)):a.substr(0,c)}return b};OpenLayers.Util.getBrowserName=function(){var a="";var b=navigator.userAgent.toLowerCase();if(b.indexOf("opera")!=-1){a="opera"}else if(b.indexOf("msie")!=-1){a="msie"}else if(b.indexOf("safari")!=-1){a="safari"}else if(b.indexOf("mozilla")!=-1){if(b.indexOf("firefox")!=-1){a="firefox"}else{a="mozilla"}}return a};OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e;var f=document.createElement("div");f.style.visibility="hidden";var g=c&&c.containerElement?c.containerElement:document.body;if(b){if(b.w){d=b.w;f.style.width=d+"px"}else if(b.h){e=b.h;f.style.height=e+"px"}}if(c&&c.displayClass){f.className=c.displayClass}var h=document.createElement("div");h.innerHTML=a;h.style.overflow="visible";if(h.childNodes){for(var i=0,j=h.childNodes.length;i<j;i++){if(!h.childNodes[i].style)continue;h.childNodes[i].style.overflow="visible"}}f.appendChild(h);g.appendChild(f);var k=false;var l=f.parentNode;while(l&&l.tagName.toLowerCase()!="body"){var m=OpenLayers.Element.getStyle(l,"position");if(m=="absolute"){k=true;break}else if(m&&m!="static"){break}l=l.parentNode}if(!k){f.style.position="absolute"}if(!d){d=parseInt(h.scrollWidth);f.style.width=d+"px"}if(!e){e=parseInt(h.scrollHeight)}f.removeChild(h);g.removeChild(f);return new OpenLayers.Size(d,e)};OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(a==null){var b=null;var c=null;var d=0;var e=0;b=document.createElement("div");b.style.position="absolute";b.style.top="-1000px";b.style.left="-1000px";b.style.width="100px";b.style.height="50px";b.style.overflow="hidden";c=document.createElement("div");c.style.width="100%";c.style.height="200px";b.appendChild(c);document.body.appendChild(b);d=c.offsetWidth;b.style.overflow="scroll";e=c.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=d-e;a=OpenLayers.Util._scrollbarWidth}return a};OpenLayers.Rico=new Object;OpenLayers.Rico.Corner={round:function(a,b){a=OpenLayers.Util.getElement(a);this._setOptions(b);var c=this.options.color;if(this.options.color=="fromElement"){c=this._background(a)}var d=this.options.bgColor;if(this.options.bgColor=="fromParent"){d=this._background(a.offsetParent)}this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;var c=a.parentNode.getElementsByTagName("span");for(var d=0;d<c.length;d++){c[d].style.backgroundColor=b}},changeOpacity:function(a,b){var c=b;var d="alpha(opacity="+b*100+")";a.style.opacity=c;a.style.filter=d;var e=a.parentNode.getElementsByTagName("span");for(var f=0;f<e.length;f++){e[f].style.opacity=c;e[f].style.filter=d}},reRound:function(a,b){var c=a.parentNode.childNodes[0];var d=a.parentNode.childNodes[2];a.parentNode.removeChild(c);a.parentNode.removeChild(d);this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){if(this.options.border){this._renderBorder(a,c)}if(this._isTopRounded()){this._roundTopCorners(a,b,c)}if(this._isBottomRounded()){this._roundBottomCorners(a,b,c)}},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b);var d="border-left: "+c;var e="border-right: "+c;var f="style='"+d+";"+e+"'";a.innerHTML="<div "+f+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){var d=this._createCorner(c);for(var e=0;e<this.options.numSlices;e++){d.appendChild(this._createCornerSlice(b,c,e,"top"))}a.style.paddingTop=0;a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){var d=this._createCorner(c);for(var e=this.options.numSlices-1;e>=0;e--){d.appendChild(this._createCornerSlice(b,c,e,"bottom"))}a.style.paddingBottom=0;a.appendChild(d)},_createCorner:function(a){var b=document.createElement("div");b.style.backgroundColor=this._isTransparent()?"transparent":a;return b},_createCornerSlice:function(a,b,c,d){var e=document.createElement("span");var f=e.style;f.backgroundColor=a;f.display="block";f.height="1px";f.overflow="hidden";f.fontSize="1px";var g=this._borderColor(a,b);if(this.options.border&&c==0){f.borderTopStyle="solid";f.borderTopWidth="1px";f.borderLeftWidth="0px";f.borderRightWidth="0px";f.borderBottomWidth="0px";f.height="0px";f.borderColor=g}else if(g){f.borderColor=g;f.borderStyle="solid";f.borderWidth="0px 1px"}if(!this.options.compact&&c==this.options.numSlices-1){f.height="2px"}this._setMargin(e,c,d);this._setBorder(e,c,d);return e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else if(this.options.corners.indexOf("tr")>=0){return"right"}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else if(this.options.corners.indexOf("br")>=0){return"right"}return""},_borderColor:function(a,b){if(a=="transparent"){return b}else if(this.options.border){return this.options.border}else if(this.options.blend){return this._blend(b,a)}else{return""}},_setMargin:function(a,b,c){var d=this._marginSize(b);var e=c=="top"?this._whichSideTop():this._whichSideBottom();if(e=="left"){a.style.marginLeft=d+"px";a.style.marginRight="0px"}else if(e=="right"){a.style.marginRight=d+"px";a.style.marginLeft="0px"}else{a.style.marginLeft=d+"px";a.style.marginRight=d+"px"}},_setBorder:function(a,b,c){var d=this._borderSize(b);var e=c=="top"?this._whichSideTop():this._whichSideBottom();if(e=="left"){a.style.borderLeftWidth=d+"px";a.style.borderRightWidth="0px"}else if(e=="right"){a.style.borderRightWidth=d+"px";a.style.borderLeftWidth="0px"}else{a.style.borderLeftWidth=d+"px";a.style.borderRightWidth=d+"px"}if(this.options.border!=false){a.style.borderLeftWidth=d+"px";a.style.borderRightWidth=d+"px"}},_marginSize:function(a){if(this._isTransparent()){return 0}var b=[5,3,2,1];var c=[3,2,1,0];var d=[2,1];var e=[1,0];if(this.options.compact&&this.options.blend){return e[a]}else if(this.options.compact){return d[a]}else if(this.options.blend){return c[a]}else{return b[a]}},_borderSize:function(a){var b=[5,3,2,1];var c=[2,1,1,1];var d=[1,0];var e=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else if(this.options.compact){return d[a]}else if(this.options.blend){return c[a]}else if(this.options.border){return e[a]}else if(this._isTransparent()){return b[a]}return 0},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(a.indexOf(arguments[b])>=0){return true}return false},_blend:function(a,b){var c=OpenLayers.Rico.Color.createFromHex(a);c.blend(OpenLayers.Rico.Color.createFromHex(b));return c},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};(function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(b){if(typeof navigator.mimeTypes!="undefined"&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:a}}})();OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none"},toggle:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]);var d=OpenLayers.Element.visible(c)?"hide":"show";OpenLayers.Element[d](c)}},hide:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]);c.style.display="none"}},show:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]);c.style.display=""}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},getDimensions:function(a){a=OpenLayers.Util.getElement(a);if(OpenLayers.Element.getStyle(a,"display")!="none"){return{width:a.offsetWidth,height:a.offsetHeight}}var b=a.style;var c=b.visibility;var d=b.position;b.visibility="hidden";b.position="absolute";b.display="";var e=a.clientWidth;var f=a.clientHeight;b.display="none";b.position=d;b.visibility=c;return{width:e,height:f}},hasClass:function(a,b){var c=a.className;return!!c&&(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(c)},addClass:function(a,b){if(!OpenLayers.Element.hasClass(a,b)){a.className+=(a.className?" ":"")+b}return a},removeClass:function(a,b){var c=a.className;if(c){a.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))}return a},toggleClass:function(a,b){if(OpenLayers.Element.hasClass(a,b)){OpenLayers.Element.removeClass(a,b)}else{OpenLayers.Element.addClass(a,b)}return a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){c=a.style[OpenLayers.String.camelize(b)];if(!c){if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else if(a.currentStyle){c=a.currentStyle[OpenLayers.String.camelize(b)]}}var e=["left","top","right","bottom"];if(window.opera&&OpenLayers.Util.indexOf(e,b)!=-1&&OpenLayers.Element.getStyle(a,"position")=="static"){c="auto"}}return c=="auto"?null:c}};OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=false;if(a!=null){b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h)}return b},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var a=document.getElementsByTagName("script");for(var b=0,c=a.length;b<c;++b){if(a[b].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a;this.size=b?b:new OpenLayers.Size(20,20);this.offset=c?c:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=d;var e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){if(a!=null){this.size=a}this.draw()},setUrl:function(a){if(a!=null){this.url=a}this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)}},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null){this.px=a}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b)}}},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){var a=this.imageDiv&&this.imageDiv.parentNode&&this.imageDiv.parentNode.nodeType!=11;return a},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(a,b,c,d,e,f){if(a==null){a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=a;this.lonlat=b;this.contentSize=c!=null?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(d!=null){this.contentHTML=d}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var g=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(g,null,null,null,"relative",null,"hidden");var a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(e){this.addCloseBox(f)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(a){if(a==null){if(this.lonlat!=null&&this.map!=null){a=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null);var b=a.getPropertyValue("overflow");if(b!="hidden"){this.contentDiv._oldOverflow=b;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;if(a){this.contentDiv.style.overflow=a;this.contentDiv._oldOverflow=null}})}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a)}}},moveTo:function(a){if(a!=null&&this.div!=null){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){OpenLayers.Element.hide(this.div)},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding();var c=b.left+b.right;var d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;d+=this.padding.top+this.padding.bottom;if(this.closeDiv){var e=parseInt(this.closeDiv.style.width);c+=e+b.right}this.size.w+=c;this.size.h+=d;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=b.left+b.right;this.contentSize.h+=b.bottom+b.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=a.w+"px";this.contentDiv.style.height=a.h+"px"}},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var b=this.map?this.map.layerContainerDiv:document.body;var c=OpenLayers.Util.getRenderedDimensions(a,null,{displayClass:this.displayClass,containerElement:b});var d=this.getSafeContentSize(c);var e=null;if(d.equals(c)){e=c}else{var f=new OpenLayers.Size;f.w=d.w<c.w?d.w:null;f.h=d.h<c.h?d.h:null;if(f.w&&f.h){e=d}else{var g=OpenLayers.Util.getRenderedDimensions(a,f,{displayClass:this.contentDisplayClass,containerElement:b});var h=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if(h!="hidden"&&g.equals(d)){var i=OpenLayers.Util.getScrollbarWidth();if(f.w){g.h+=i}else{g.w+=i}}e=this.getSafeContentSize(g)}}this.setSize(e)},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(a){if(a!=undefined){this.opacity=a}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(a){if(a!=undefined){this.border=a}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(a){if(a!=null){this.contentHTML=a}if(this.contentDiv!=null&&this.contentHTML!=null&&this.contentHTML!=this.contentDiv.innerHTML){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var a=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)};var b=this.contentDiv.getElementsByTagName("img");for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.width==0||e.height==0){var f={popup:this,img:e};e._onImgLoad=OpenLayers.Function.bind(a,f);OpenLayers.Event.observe(e,"load",e._onImgLoad)}}},getSafeContentSize:function(a){var b=a.clone();var c=this.getContentDivPadding();var d=c.left+c.right;var e=c.top+c.bottom;this.fixPadding();d+=this.padding.left+this.padding.right;e+=this.padding.top+this.padding.bottom;if(this.closeDiv){var f=parseInt(this.closeDiv.style.width);d+=f+c.right}if(this.minSize){b.w=Math.max(b.w,this.minSize.w-d);b.h=Math.max(b.h,this.minSize.h-e)}if(this.maxSize){b.w=Math.min(b.w,this.maxSize.w-d);b.h=Math.min(b.h,this.maxSize.h-e)}if(this.map&&this.map.size){var g=0,h=0;if(this.keepInMap&&!this.panMapIfOutOfView){var i=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":g=i.x;h=this.map.size.h-i.y;break;case"tl":g=this.map.size.w-i.x;h=this.map.size.h-i.y;break;case"bl":g=this.map.size.w-i.x;h=i.y;break;case"br":g=i.x;h=i.y;break;default:g=i.x;h=this.map.size.h-i.y;break}}var j=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-e-h;var k=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-d-g;b.w=Math.min(b.w,k);b.h=Math.min(b.h,j)}return b},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);var c=a||function(a){this.hide();OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(c,this))},panIntoView:function(){var a=this.map.getSize();var b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var c=b.clone();if(b.x<this.map.paddingForPopups.left){c.x=this.map.paddingForPopups.left}else if(b.x+this.size.w>a.w-this.map.paddingForPopups.right){c.x=a.w-this.map.paddingForPopups.right-this.size.w}if(b.y<this.map.paddingForPopups.top){c.y=this.map.paddingForPopups.top}else if(b.y+this.size.h>a.h-this.map.paddingForPopups.bottom){c.y=a.h-this.map.paddingForPopups.bottom-this.size.h}var d=b.x-c.x;var e=b.y-c.y;this.map.pan(d,e)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true)},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true)}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true)}},onclick:function(a){OpenLayers.Event.stop(a,true)},onmouseout:function(a){this.mousedown=false},ondblclick:function(a){OpenLayers.Event.stop(a,true)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){this.options=null;this.format=null},read:function(){},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null}},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(a,b){if(b==null){b=a.style}if(a.geometry){var c=a.geometry.getBounds();if(c){if(!c.intersectsBounds(this.extent)){b={display:"none"}}var d=this.drawGeometry(a.geometry,b,a.id);if(b.display!="none"&&b.label&&d!==false){this.drawText(a.id,b,a.geometry.getCentroid())}else{this.removeText(a.id)}return d}}},drawGeometry:function(a,b,c){},drawText:function(a,b,c){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(a){if(!(a instanceof Array)){a=[a]}for(var b=0,c=a.length;b<c;++b){this.eraseGeometry(a[b].geometry);this.removeText(a[b].id)}},eraseGeometry:function(a){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(a){this.layer=a},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},darken:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){var a=this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(a){if(a.length==4){var b=a;var a="#";for(var c=1;c<4;c++){a+=b.charAt(c)+b.charAt(c)}}if(a.indexOf("#")==0){a=a.substring(1)}var d=a.substring(0,2);var e=a.substring(2,4);var f=a.substring(4,6);return new OpenLayers.Rico.Color(parseInt(d,16),parseInt(e,16),parseInt(f,16))};OpenLayers.Rico.Color.createColorFromBackground=function(a){var b=RicoUtil.getElementsComputedStyle(OpenLayers.Util.getElement(a),"backgroundColor","background-color");if(b=="transparent"&&a.parentNode){return OpenLayers.Rico.Color.createColorFromBackground(a.parentNode)}if(b==null){return new OpenLayers.Rico.Color(255,255,255)}if(b.indexOf("rgb(")==0){var c=b.substring(4,b.length-1);var d=c.split(",");return new OpenLayers.Rico.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}else if(b.indexOf("#")==0){return OpenLayers.Rico.Color.createFromHex(b)}else{return new OpenLayers.Rico.Color(255,255,255)}};OpenLayers.Rico.Color.HSBtoRGB=function(a,b,c){var d=0;var e=0;var f=0;if(b==0){d=parseInt(c*255+.5);e=d;f=d}else{var g=(a-Math.floor(a))*6;var h=g-Math.floor(g);var i=c*(1-b);var j=c*(1-b*h);var k=c*(1-b*(1-h));switch(parseInt(g)){case 0:d=c*255+.5;e=k*255+.5;f=i*255+.5;break;case 1:d=j*255+.5;e=c*255+.5;f=i*255+.5;break;case 2:d=i*255+.5;e=c*255+.5;f=k*255+.5;break;case 3:d=i*255+.5;e=j*255+.5;f=c*255+.5;break;case 4:d=k*255+.5;e=i*255+.5;f=c*255+.5;break;case 5:d=c*255+.5;e=i*255+.5;f=j*255+.5;break}}return{r:parseInt(d),g:parseInt(e),b:parseInt(f)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c){var d;var e;var f;var g=a>b?a:b;if(c>g){g=c}var h=a<b?a:b;if(c<h){h=c}f=g/255;if(g!=0){e=(g-h)/g}else{e=0}if(e==0){d=0}else{var i=(g-a)/(g-h);var j=(g-b)/(g-h);var k=(g-c)/(g-h);if(a==g){d=k-j}else if(b==g){d=2+i-k}else{d=4+j-i}d=d/6;if(d<0){d=d+1}}return{h:d,s:e,b:f}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){if(a!=null){this.left=OpenLayers.Util.toFloat(a)}if(b!=null){this.bottom=OpenLayers.Util.toFloat(b)}if(c!=null){this.right=OpenLayers.Util.toFloat(c)}if(d!=null){this.top=OpenLayers.Util.toFloat(d)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=false;if(a!=null){b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom}return b},toString:function(){return"left-bottom=("+this.left+","+this.bottom+")"+" right-top=("+this.right+","+this.top+")"},toArray:function(){return[this.left,this.bottom,this.right,this.top]},toBBOX:function(a){if(a==null){a=6}var b=Math.pow(10,a);var c=Math.round(this.left*b)/b+","+Math.round(this.bottom*b)/b+","+Math.round(this.right*b)/b+","+Math.round(this.top*b)/b;return c},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(a,b){if(b==null){b=this.getCenterLonLat()}var c=[];var d,e;if(b.CLASS_NAME=="OpenLayers.LonLat"){d=b.lon;e=b.lat}else{d=b.x;e=b.y}var f=(this.left-d)*a+d;var g=(this.bottom-e)*a+e;var h=(this.right-d)*a+d;var i=(this.top-e)*a+e;return new OpenLayers.Bounds(f,g,h,i)},add:function(a,b){if(a==null||b==null){var c=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(c);return null}return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a;break}if(b){this.centerLonLat=null;if(this.left==null||b.left<this.left){this.left=b.left}if(this.bottom==null||b.bottom<this.bottom){this.bottom=b.bottom}if(this.right==null||b.right>this.right){this.right=b.right}if(this.top==null||b.top>this.top){this.top=b.top}}}},containsLonLat:function(a,b){return this.contains(a.lon,a.lat,b)},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(c==null){c=true}if(a==null||b==null){return false}a=OpenLayers.Util.toFloat(a);b=OpenLayers.Util.toFloat(b);var d=false;if(c){d=a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top}else{d=a>this.left&&a<this.right&&b>this.bottom&&b<this.top}return d},intersectsBounds:function(a,b){if(b==null){b=true}var c=false;var d=this.left==a.right||this.right==a.left||this.top==a.bottom||this.bottom==a.top;if(b||!d){var e=a.bottom>=this.bottom&&a.bottom<=this.top||this.bottom>=a.bottom&&this.bottom<=a.top;var f=a.top>=this.bottom&&a.top<=this.top||this.top>a.bottom&&this.top<a.top;var g=a.left>=this.left&&a.left<=this.right||this.left>=a.left&&this.left<=a.right;var h=a.right>=this.left&&a.right<=this.right||this.right>=a.left&&this.right<=a.right;c=(e||f)&&(g||h)}return c},containsBounds:function(a,b,c){if(b==null){b=false}if(c==null){c=true}var d=this.contains(a.left,a.bottom,c);var e=this.contains(a.right,a.bottom,c);var f=this.contains(a.left,a.top,c);var g=this.contains(a.right,a.top,c);return b?d||e||f||g:d&&e&&f&&g},determineQuadrant:function(a){var b="";var c=this.getCenterLonLat();b+=a.lat<c.lat?"b":"t";b+=a.lon<c.lon?"l":"r";return b},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b);var d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b);var e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b);var f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);this.left=Math.min(c.x,e.x);this.bottom=Math.min(c.y,d.y);this.right=Math.max(d.x,f.x);this.top=Math.max(e.y,f.y);return this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0;var d=b.rightTolerance||0;var e=this.clone();if(a){while(e.left<a.left&&e.right-d<=a.left){e=e.add(a.getWidth(),0)}while(e.left+c>=a.right&&e.right>a.right){e=e.add(-a.getWidth(),0)}}return e},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(a){var b=a.split(",");return OpenLayers.Bounds.fromArray(b)};OpenLayers.Bounds.fromArray=function(a){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=a.charAt(0)=="t"?"b":"t";b+=a.charAt(1)=="l"?"r":"l";return b};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){this.lon=OpenLayers.Util.toFloat(a);this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(a==null||b==null){var c=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(c);return null}return new OpenLayers.LonLat(this.lon+a,this.lat+b)},equals:function(a){var b=false;if(a!=null){b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat)}return b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);this.lon=c.x;this.lat=c.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){while(b.lon<a.left){b.lon+=a.getWidth()}while(b.lon>a.right){b.lon-=a.getWidth()}}return b},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(a){var b=a.split(",");return new OpenLayers.LonLat(parseFloat(b[0]),parseFloat(b[1]))};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=false;if(a!=null){b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)}return b},add:function(a,b){if(a==null||b==null){var c=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(c);return null}return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a)}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=function(){return false}}if(this.title!=""){this.div.title=this.title}}if(a!=null){this.position=a.clone()}this.moveTo(this.position);return this.div},moveTo:function(a){if(a!=null&&this.div!=null){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(a){var b;if(!a){a=OpenLayers.Util.getBrowserName()=="msie"?navigator.userLanguage:navigator.language}var c=a.split("-");c[0]=c[0].toLowerCase();if(typeof OpenLayers.Lang[c[0]]=="object"){b=c[0]}if(c[1]){var d=c[0]+"-"+c[1].toUpperCase();if(typeof OpenLayers.Lang[d]=="object"){b=d}}if(!b){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language");b=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()];var d=c[a];if(!d){d=a}if(b){d=OpenLayers.String.format(d,b)}return d}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(a,b,c,d,e,f,g){var h=[a,b,c,d,f,g];OpenLayers.Popup.prototype.initialize.apply(this,h);this.anchor=e!=null?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(a){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a);var c=this.calculateNewPx(a);var d=new Array(c);OpenLayers.Popup.prototype.moveTo.apply(this,d);if(this.relativePosition!=b){this.updateRelativePosition()}},setSize:function(a){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)}},calculateRelativePosition:function(a){var b=this.map.getLonLatFromLayerPx(a);var c=this.map.getExtent();var d=c.determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(d)},updateRelativePosition:function(){},calculateNewPx:function(a){var b=a.offset(this.anchor.offset);var c=this.size||this.contentSize;var d=this.relativePosition.charAt(0)=="t";b.y+=d?-c.h:this.anchor.size.h;var e=this.relativePosition.charAt(1)=="l";b.x+=e?-c.w:this.anchor.size.w;return b},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Protocol.SQL=OpenLayers.Class(OpenLayers.Protocol,{databaseName:"ol",tableName:"ol_vector_features",postReadFiltering:true,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Protocol.prototype.destroy.apply(this)},supported:function(){return false},evaluateFilter:function(a,b){return b&&this.postReadFiltering?b.evaluate(a):true},CLASS_NAME:"OpenLayers.Protocol.SQL"});OpenLayers.Protocol.WFS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b){throw"Unsupported WFS version: "+a.version}return new b(a)};OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d;var e=a.params["LAYERS"];var f=(e instanceof Array?e[0]:e).split(":");if(f.length>1){d=f[0]}c=f.pop();var g={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,g))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{canvas:null,features:null,geometryMap:null,initialize:function(a){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.geometryMap={}},eraseGeometry:function(a){this.eraseFeatures(this.features[this.geometryMap[a.id]][0])},supported:function(){var a=document.createElement("canvas");return!!a.getContext},setExtent:function(a){this.extent=a.clone();this.resolution=null;this.redraw()},setSize:function(a){this.size=a.clone();this.root.style.width=a.w+"px";this.root.style.height=a.h+"px";this.root.width=a.w;this.root.height=a.h;this.resolution=null},drawFeature:function(a,b){if(b==null){b=a.style}b=OpenLayers.Util.extend({fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1},b);this.features[a.id]=[a,b];if(a.geometry){this.geometryMap[a.geometry.id]=a.id}this.redraw()},drawGeometry:function(a,b){var c=a.CLASS_NAME;if(c=="OpenLayers.Geometry.Collection"||c=="OpenLayers.Geometry.MultiPoint"||c=="OpenLayers.Geometry.MultiLineString"||c=="OpenLayers.Geometry.MultiPolygon"){for(var d=0;d<a.components.length;d++){this.drawGeometry(a.components[d],b)}return}switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(a,b);break;default:break}},drawExternalGraphic:function(a,b){var c=new Image;c.src=b.externalGraphic;if(b.graphicTitle){c.title=b.graphicTitle}var d=b.graphicWidth||b.graphicHeight;var e=b.graphicHeight||b.graphicWidth;d=d?d:b.pointRadius*2;e=e?e:b.pointRadius*2;var f=b.graphicXOffset!=undefined?b.graphicXOffset:-(.5*d);var g=b.graphicYOffset!=undefined?b.graphicYOffset:-(.5*e);var h=b.graphicOpacity||b.fillOpacity;var i={img:c,x:a[0]+f,y:a[1]+g,width:d,height:e,canvas:this.canvas};c.onload=OpenLayers.Function.bind(function(){this.canvas.drawImage(this.img,this.x,this.y,this.width,this.height)},i)},setCanvasStyle:function(a,b){if(a=="fill"){this.canvas.globalAlpha=b["fillOpacity"];this.canvas.fillStyle=b["fillColor"]}else if(a=="stroke"){this.canvas.globalAlpha=b["strokeOpacity"];this.canvas.strokeStyle=b["strokeColor"];this.canvas.lineWidth=b["strokeWidth"]}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}},drawPoint:function(a,b){if(b.graphic!==false){var c=this.getLocalXY(a);if(b.externalGraphic){this.drawExternalGraphic(c,b)}else{if(b.fill!==false){this.setCanvasStyle("fill",b);this.canvas.beginPath();this.canvas.arc(c[0],c[1],6,0,Math.PI*2,true);this.canvas.fill()}if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();this.canvas.arc(c[0],c[1],6,0,Math.PI*2,true);this.canvas.stroke();this.setCanvasStyle("reset")}}}},drawLineString:function(a,b){if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();var c=this.getLocalXY(a.components[0]);this.canvas.moveTo(c[0],c[1]);for(var d=1;d<a.components.length;d++){var e=this.getLocalXY(a.components[d]);this.canvas.lineTo(e[0],e[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawLinearRing:function(a,b){if(b.fill!==false){this.setCanvasStyle("fill",b);this.canvas.beginPath();var c=this.getLocalXY(a.components[0]);this.canvas.moveTo(c[0],c[1]);for(var d=1;d<a.components.length-1;d++){var e=this.getLocalXY(a.components[d]);this.canvas.lineTo(e[0],e[1])}this.canvas.fill()}if(b.stroke!==false){var f=this.canvas.lineWidth;this.setCanvasStyle("stroke",b);this.canvas.beginPath();var c=this.getLocalXY(a.components[0]);this.canvas.moveTo(c[0],c[1]);for(var d=1;d<a.components.length;d++){var e=this.getLocalXY(a.components[d]);this.canvas.lineTo(e[0],e[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawPolygon:function(a,b){this.drawLinearRing(a.components[0],b);for(var c=1;c<a.components.length;c++){this.drawLinearRing(a.components[c],{fillOpacity:0,strokeWidth:0,strokeOpacity:0,strokeColor:"#000000",fillColor:"#000000"})}},drawText:function(a,b){b=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},b);var c=this.getLocalXY(a);this.setCanvasStyle("reset");this.canvas.fillStyle=b.fontColor;this.canvas.globalAlpha=1;var d=b.fontWeight+" "+b.fontSize+" "+b.fontFamily;if(this.canvas.fillText){var e=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"middle";this.canvas.font=d;this.canvas.textAlign=e;this.canvas.fillText(b.label,c[0],c[1])}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var f=this.canvas.mozMeasureText(b.label);switch(b.labelAlign[0]){case"l":break;case"r":c[0]-=f;break;case"c":default:c[0]-=f/2}this.canvas.translate(c[0],c[1]);this.canvas.mozDrawText(b.label);this.canvas.translate(-1*c[0],-1*c[1])}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution();var c=this.extent;var d=a.x/b+ -c.left/b;var e=c.top/b-a.y/b;return[d,e]},clear:function(){this.canvas.clearRect(0,0,this.root.width,this.root.height)},getFeatureIdFromEvent:function(a){var b=this.map.getLonLatFromPixel(a.xy);var c=this.getResolution();var d=new OpenLayers.Bounds(b.lon-c*5,b.lat-c*5,b.lon+c*5,b.lat+c*5);var e=d.toGeometry();for(var f in this.features){if(!this.features.hasOwnProperty(f)){continue}if(this.features[f][0].geometry.intersects(e)){return f}}return null},eraseFeatures:function(a){if(!(a instanceof Array)){a=[a]}for(var b=0;b<a.length;++b){delete this.features[a[b].id]}this.redraw()},redraw:function(){if(!this.locked){this.clear();var a=[];var b,c;for(var d in this.features){if(!this.features.hasOwnProperty(d)){continue}b=this.features[d][0];c=this.features[d][1];if(!b.geometry){continue}this.drawGeometry(b.geometry,c);if(c.label){a.push([b,c])}}var e;for(var f=0;len=a.length,f<len;++f){e=a[f];this.drawText(e[0].geometry.getCentroid(),e[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right"};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0},insert:function(a){if(this.exists(a)){this.remove(a)}var b=a.id;this.determineZIndex(a);var c=-1;var d=this.order.length;var e;while(d-c>1){e=parseInt((c+d)/2);var f=this.compare(this,a,OpenLayers.Util.getElement(this.order[e]));if(f>0){c=e}else{d=e}}this.order.splice(d,0,b);this.indices[b]=this.getZIndex(a);return this.getNextElement(d)},remove:function(a){var b=a.id;var c=OpenLayers.Util.indexOf(this.order,b);if(c>=0){this.order.splice(c,1);delete this.indices[b];if(this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return this.indices[a.id]!=null},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b}else if(b>this.maxZIndex){this.maxZIndex=b}},getNextElement:function(a){var b=a+1;if(b<this.order.length){var c=OpenLayers.Util.getElement(this.order[b]);if(c==undefined){c=this.getNextElement(b)}return c}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){var d=a.getZIndex(b);var e=0;if(c){var f=a.getZIndex(c);e=d-f}return e},Z_ORDER_DRAWING_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&d==0){d=1}return d},Z_ORDER_Y_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&d==0){var e=b._geometry.getBounds().bottom;var f=c._geometry.getBounds().bottom;var g=f-e;d=g==0?1:g}return d}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",minimumSymbolizer:{strokeLinecap:"round",strokeOpacity:1,strokeDashstyle:"solid",fillOpacity:1,pointRadius:0},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){if(this.vectorRoot){while(this.vectorRoot.childNodes.length>0){this.vectorRoot.removeChild(this.vectorRoot.firstChild)}}if(this.textRoot){while(this.textRoot.childNodes.length>0){this.textRoot.removeChild(this.textRoot.firstChild)}}if(this.indexer){this.indexer.clear()}},getNodeType:function(a,b){},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;var e=true;if(d=="OpenLayers.Geometry.Collection"||d=="OpenLayers.Geometry.MultiPoint"||d=="OpenLayers.Geometry.MultiLineString"||d=="OpenLayers.Geometry.MultiPolygon"){for(var f=0,g=a.components.length;f<g;f++){e=this.drawGeometry(a.components[f],b,c)&&e}return e}e=false;if(b.display!="none"){if(b.backgroundGraphic){this.redrawBackgroundNode(a.id,a,b,c)}e=this.redrawNode(a.id,a,b,c)}if(e==false){var h=document.getElementById(a.id);if(h){if(h._style.backgroundGraphic){h.parentNode.removeChild(document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX))}h.parentNode.removeChild(h)}}return e},redrawNode:function(a,b,c,d){var e=this.nodeFactory(a,this.getNodeType(b,c));e._featureId=d;e._geometry=b;e._geometryClass=b.CLASS_NAME;e._style=c;var f=this.drawGeometryNode(e,b,c);if(f===false){return false}e=f.node;if(this.indexer){var g=this.indexer.insert(e);if(g){this.vectorRoot.insertBefore(e,g)}else{this.vectorRoot.appendChild(e)}}else{if(e.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(e)}}this.postDraw(e);return f.complete},redrawBackgroundNode:function(a,b,c,d){var e=OpenLayers.Util.extend({},c);e.externalGraphic=e.backgroundGraphic;e.graphicXOffset=e.backgroundXOffset;e.graphicYOffset=e.backgroundYOffset;e.graphicZIndex=e.backgroundGraphicZIndex;e.graphicWidth=e.backgroundWidth||e.graphicWidth;e.graphicHeight=e.backgroundHeight||e.graphicHeight;e.backgroundGraphic=null;e.backgroundXOffset=null;e.backgroundYOffset=null;e.backgroundGraphicZIndex=null;return this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,e,null)},drawGeometryNode:function(a,b,c){c=c||a._style;OpenLayers.Util.applyDefaults(c,this.minimumSymbolizer);var d={isFilled:c.fill===undefined?true:c.fill,isStroked:c.stroke===undefined?!!c.strokeWidth:c.stroke};var e;switch(b.CLASS_NAME){case"OpenLayers.Geometry.Point":if(c.graphic===false){d.isFilled=false;d.isStroked=false}e=this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":d.isFilled=false;e=this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":e=this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":e=this.drawPolygon(a,b);break;case"OpenLayers.Geometry.Surface":e=this.drawSurface(a,b);break;case"OpenLayers.Geometry.Rectangle":e=this.drawRectangle(a,b);break;default:break}a._style=c;a._options=d;if(e!=false){return{node:this.setStyle(a,c,d,b),complete:e}}else{return false}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);if(b){this.textRoot.removeChild(b)}},getFeatureIdFromEvent:function(a){var b=a.target;var c=b&&b.correspondingUseElement;var d=c?c:b||a.srcElement;var e=d._featureId;return e},eraseGeometry:function(a){if(a.CLASS_NAME=="OpenLayers.Geometry.MultiPoint"||a.CLASS_NAME=="OpenLayers.Geometry.MultiLineString"||a.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"||a.CLASS_NAME=="OpenLayers.Geometry.Collection"){for(var b=0,c=a.components.length;b<c;b++){this.eraseGeometry(a.components[b])}}else{var d=OpenLayers.Util.getElement(a.id);if(d&&d.parentNode){if(d.geometry){d.geometry.destroy();d.geometry=null}d.parentNode.removeChild(d);if(this.indexer){this.indexer.remove(d)}if(d._style.backgroundGraphic){var e=a.id+this.BACKGROUND_ID_SUFFIX;var f=OpenLayers.Util.getElement(e);if(f&&f.parentNode){f.parentNode.removeChild(f)}}}}},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);if(c){if(!this.nodeTypeCompare(c,b)){c.parentNode.removeChild(c);c=this.nodeFactory(a,b)}}else{c=this.createNode(b,a)}return c},nodeTypeCompare:function(a,b){},createNode:function(a,b){},moveRoot:function(a){var b=this.root;if(a.root.parentNode==this.rendererRoot){b=a.root}b.parentNode.removeChild(b);a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return a!="circle"&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},cacheFeatures:function(a){var b=true;if(!this.clustering){this.clearCache();this.features=a.features;this.cluster();b=false}return b},clearCache:function(){this.features=null},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var b=this.layer.map.getResolution();if(b!=this.resolution||!this.clustersExist()){this.resolution=b;var c=[];var d,e,f;for(var g=0;g<this.features.length;++g){d=this.features[g];if(d.geometry){e=false;for(var h=0;h<c.length;++h){f=c[h];if(this.shouldCluster(f,d)){this.addToCluster(f,d);e=true;break}}if(!e){c.push(this.createCluster(this.features[g]))}}}this.layer.destroyFeatures();if(c.length>0){if(this.threshold>1){var i=c.slice();c=[];var j;for(var g=0,k=i.length;g<k;++g){j=i[g];if(j.attributes.count<this.threshold){Array.prototype.push.apply(c,j.cluster)}else{c.push(j)}}}this.clustering=true;this.layer.addFeatures(c);this.clustering=false}this.clusters=c}}},clustersExist:function(){var a=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){a=true;for(var b=0;b<this.clusters.length;++b){if(this.clusters[b]!=this.layer.features[b]){a=false;break}}}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat();var d=b.geometry.getBounds().getCenterLonLat();var e=Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution;return e<=this.distance},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat();var c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});c.cluster=[a];return c},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Strategy.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return true}return false},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return a},load:function(a){this.layer.events.triggerEvent("loadstart");this.layer.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,scope:this},a));this.layer.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){this.layer.destroyFeatures();var b=a.features;if(b&&b.length>0){var c=this.layer.projection;var d=this.layer.map.getProjectionObject();if(!d.equals(c)){var e;for(var f=0,g=b.length;f<g;++f){e=b[f].geometry;if(e){e.transform(c,d)}}}this.layer.addFeatures(b)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},cacheFeatures:function(a){if(!this.paging){this.clearCache();this.features=a.features;this.pageNext(a)}},clearCache:function(){if(this.features){for(var a=0;a<this.features.length;++a){this.features[a].destroy()}}this.features=null;this.num=null},pageCount:function(){var a=this.features?this.features.length:0;return Math.ceil(a/this.length)},pageNum:function(){return this.num},pageLength:function(a){if(a&&a>0){this.length=a}return this.length},pageNext:function(a){var b=false;if(this.features){if(this.num===null){this.num=-1}var c=(this.num+1)*this.length;b=this.page(c,a)}return b},pagePrevious:function(){var a=false;if(this.features){if(this.num===null){this.num=this.pageCount()}var b=(this.num-1)*this.length;a=this.page(b)}return a},page:function(a,b){var c=false;if(this.features){if(a>=0&&a<this.features.length){var d=Math.floor(a/this.length);if(d!=this.num){this.paging=true;var e=this.features.slice(a,a+this.length);this.layer.removeFeatures(this.layer.features);this.num=d;if(b&&b.features){b.features=e}else{this.layer.addFeatures(e)}this.paging=false;c=true}}}return c},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{auto:false,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){if(this.auto){if(typeof this.auto==="number"){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),this.auto*1e3)}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){if(this.auto){if(typeof this.auto==="number"){window.clearInterval(this.timer)}else{this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}}return a},triggerSave:function(a){var b=a.feature;if(b.state===OpenLayers.State.INSERT||b.state===OpenLayers.State.UPDATE||b.state===OpenLayers.State.DELETE){this.save([a.feature])}},save:function(a){if(!a){a=this.layer.features}var b=this.layer.projection;var c=this.layer.map.getProjectionObject();if(!c.equals(b)){var d=a.length;var e=new Array(d);var f,g;for(var h=0;h<d;++h){f=a[h];g=f.clone();g.fid=f.fid;g.state=f.state;g._original=f;g.geometry.transform(c,b);e[h]=g}a=e}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){if(a.success()){var b=a.reqFeatures;var c,d;var e=[];var f=a.insertIds||[];var g=0;for(var h=0,i=b.length;h<i;++h){d=b[h];d=d._original||d;c=d.state;if(c){if(c==OpenLayers.State.DELETE){e.push(d)}else if(c==OpenLayers.State.INSERT){d.fid=f[g];++g}d.state=null}}if(e.length>0){this.layer.destroyFeatures(e)}}},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=true;this.begin=a;this.finish=b;this.duration=c;this.callbacks=d.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}window.clearInterval(this.interval);this.interval=null;this.playing=false},play:function(){var a={};for(var b in this.begin){var c=this.begin[b];var d=this.finish[b];if(c==null||d==null||isNaN(c)||isNaN(d)){OpenLayers.Console.error("invalid value for Tween")}var e=d-c;a[b]=this.easing.apply(this,[this.time,c,e,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,a)}if(this.time>this.duration){if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish);this.playing=false}window.clearInterval(this.interval);this.interval=null}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return a==0?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){if(a==0)return b;if(a==d)return b+c;if((a/=d/2)<1)return c/2*Math.pow(2,10*(a-1))+b;return c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a+b;return-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d!=this&&d.CLASS_NAME=="OpenLayers.Control.ArgParser"){if(d.displayProjection!=this.displayProjection){this.displayProjection=d.displayProjection}break}}if(b==this.map.controls.length){var e=OpenLayers.Util.getParameters();if(e.layers){this.layers=e.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(e.lat&&e.lon){this.center=new OpenLayers.LonLat(parseFloat(e.lon),parseFloat(e.lat));if(e.zoom){this.zoom=parseInt(e.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;a<b;a++){var c=this.map.layers[a];var d=this.layers.charAt(a);if(d=="B"){this.map.setBaseLayer(c)}else if(d=="T"||d=="F"){c.setVisibility(d=="T")}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;b<c;b++){var d=this.map.layers[b];if(d.attribution&&d.getVisibility()){a.push(d.attribution)}}this.div.innerHTML=a.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{activeColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){OpenLayers.Event.stopObservingElement(this.div);OpenLayers.Event.stopObservingElement(this.minimizeDiv);OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},clearLayersArray:function(a){var b=this[a+"Layers"];if(b){for(var c=0,d=b.length;c<d;c++){var e=b[c];OpenLayers.Event.stopObservingElement(e.inputElem);OpenLayers.Event.stopObservingElement(e.labelSpan)}}this[a+"LayersDiv"].innerHTML="";this[a+"Layers"]=[]},checkRedraw:function(){var a=false;if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length){a=true}else{for(var b=0,c=this.layerStates.length;b<c;b++){var d=this.layerStates[b];var e=this.map.layers[b];if(d.name!=e.name||d.inRange!=e.inRange||d.id!=e.id||d.visibility!=e.visibility){a=true;break}}}return a},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var a=false;var b=false;var c=this.map.layers.length;this.layerStates=new Array(c);for(var d=0;d<c;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();if(!this.ascending){f.reverse()}for(var d=0,c=f.length;d<c;d++){var e=f[d];var g=e.isBaseLayer;if(e.displayInLayerSwitcher){if(g){b=true}else{a=true}var h=g?e==this.map.baseLayer:e.getVisibility();var i=document.createElement("input");i.id=this.id+"_input_"+e.name;i.name=g?"baseLayers":e.name;i.type=g?"radio":"checkbox";i.value=e.name;i.checked=h;i.defaultChecked=h;if(!g&&!e.inRange){i.disabled=true}var j={inputElem:i,layer:e,layerSwitcher:this};OpenLayers.Event.observe(i,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,j));var k=document.createElement("span");if(!g&&!e.inRange){k.style.color="gray"}k.innerHTML=e.name;k.style.verticalAlign=g?"bottom":"baseline";OpenLayers.Event.observe(k,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,j));var l=document.createElement("br");var m=g?this.baseLayers:this.dataLayers;m.push({layer:e,inputElem:i,labelSpan:k});var n=g?this.baseLayersDiv:this.dataLayersDiv;n.appendChild(i);n.appendChild(k);n.appendChild(l)}}this.dataLbl.style.display=a?"":"none";this.baseLbl.style.display=b?"":"none";return this.div},onInputClick:function(a){if(!this.inputElem.disabled){if(this.inputElem.type=="radio"){this.inputElem.checked=true;this.layer.map.setBaseLayer(this.layer)}else{this.inputElem.checked=!this.inputElem.checked;this.layerSwitcher.updateMap()}}OpenLayers.Event.stop(a)},onLayerClick:function(a){this.updateMap()},updateMap:function(){for(var a=0,b=this.baseLayers.length;a<b;a++){var c=this.baseLayers[a];if(c.inputElem.checked){this.map.setBaseLayer(c.layer,false)}}for(var a=0,b=this.dataLayers.length;a<b;a++){var c=this.dataLayers[a];c.layer.setVisibility(c.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="20em";this.div.style.height="";this.showControls(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(a!=null){OpenLayers.Event.stop(a)}},showControls:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""},loadContents:function(){this.div.style.position="absolute";this.div.style.top="25px";this.div.style.right="0px";this.div.style.left="";this.div.style.fontFamily="sans-serif";this.div.style.fontWeight="bold";this.div.style.marginTop="3px";this.div.style.marginLeft="3px";this.div.style.marginBottom="3px";this.div.style.fontSize="smaller";this.div.style.color="white";this.div.style.backgroundColor="transparent";OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this));OpenLayers.Event.observe(this.div,"click",this.ignoreEvent);OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this));OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent);this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";this.layersDiv.style.paddingTop="5px";this.layersDiv.style.paddingLeft="10px";this.layersDiv.style.paddingBottom="5px";this.layersDiv.style.paddingRight="75px";this.layersDiv.style.backgroundColor=this.activeColor;this.layersDiv.style.width="100%";this.layersDiv.style.height="100%";this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("baseLayer");this.baseLbl.style.marginTop="3px";this.baseLbl.style.marginLeft="3px";this.baseLbl.style.marginBottom="3px";this.baseLayersDiv=document.createElement("div");this.baseLayersDiv.style.paddingLeft="10px";this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("overlays");this.dataLbl.style.marginTop="3px";this.dataLbl.style.marginLeft="3px";this.dataLbl.style.marginBottom="3px";this.dataLayersDiv=document.createElement("div");this.dataLayersDiv.style.paddingLeft="10px";if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.activeColor,blend:false});OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,.75);var a=OpenLayers.Util.getImagesLocation();var b=new OpenLayers.Size(18,18);var c=a+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,b,c,"absolute");this.maximizeDiv.style.top="5px";this.maximizeDiv.style.right="0px";this.maximizeDiv.style.left="";this.maximizeDiv.style.display="none";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var c=a+"layer-switcher-minimize.png";var b=new OpenLayers.Size(18,18);this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,b,c,"absolute");this.minimizeDiv.style.top="5px";this.minimizeDiv.style.right="0px";this.minimizeDiv.style.left="";this.minimizeDiv.style.display="none";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv)},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=true;this.ignoreEvent(a)},mouseUp:function(a){if(this.isMouseDown){this.isMouseDown=false;this.ignoreEvent(a)}},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}var b=!this.performedDrag;this.performedDrag=false;return b},defaultDblClick:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom+1);OpenLayers.Event.stop(a);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.viewPortDiv.appendChild(this.zoomBox)}document.onselectstart=function(){return false};OpenLayers.Event.stop(a)},defaultMouseMove:function(a){this.mousePosition=a.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var b=Math.abs(this.mouseDragStart.x-a.xy.x);var c=Math.abs(this.mouseDragStart.y-a.xy.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,c)+"px";if(a.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=a.xy.x+"px"}if(a.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=a.xy.y+"px"}}else{var b=this.mouseDragStart.x-a.xy.x;var c=this.mouseDragStart.y-a.xy.y;var d=this.map.getSize();var e=new OpenLayers.Pixel(d.w/2+b,d.h/2+c);var f=this.map.getLonLatFromViewPortPx(e);this.map.setCenter(f,null,true);this.mouseDragStart=a.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomBox){this.zoomBoxEnd(a)}else{if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor=""},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox()}this.mouseDragStart=null}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1)}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1)}},zoomBoxEnd:function(a){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-a.xy.x)>5||Math.abs(this.mouseDragStart.y-a.xy.y)>5){var b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var c=this.map.getLonLatFromViewPortPx(a.xy);var d=Math.max(b.lat,c.lat);var e=Math.min(b.lat,c.lat);var f=Math.min(b.lon,c.lon);var g=Math.max(b.lon,c.lon);var h=new OpenLayers.Bounds(f,e,g,d);this.map.zoomToExtent(h)}else{var c=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(new OpenLayers.LonLat(c.lon,c.lat),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null},onWheelEvent:function(a){var b=false;var c=OpenLayers.Event.element(a);while(c!=null){if(this.map&&c==this.map.div){b=true;break}c=c.parentNode}if(b){var d=0;if(!a){a=window.event}if(a.wheelDelta){d=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){d=-d}}else if(a.detail){d=-a.detail/3}if(d){a.xy=this.mousePosition;if(d<0){this.defaultWheelDown(a)}else{this.defaultWheelUp(a)}}OpenLayers.Event.stop(a)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,lastXy:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.map){this.map.events.unregister("mousemove",this,this.redraw)}OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}this.redraw();return this.div},redraw:function(a){var b;if(a==null){b=new OpenLayers.LonLat(0,0)}else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return}b=this.map.getLonLatFromPixel(a.xy);if(!b){return}if(this.displayProjection){b.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=a.xy}var c=this.formatOutput(b);if(c!=this.element.innerHTML){this.element.innerHTML=c}},formatOutput:function(a){var b=parseInt(this.numDigits);var c=this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix;return c},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("mousemove",this,this.redraw)},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(a,b){this.direction=a;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,this.slideFactor);break;case OpenLayers.Control.Pan.WEST:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(this.slideFactor,0);break}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.buttons=null;this.position=null},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position;this.buttons=[];var b=new OpenLayers.Size(18,18);var c=new OpenLayers.Pixel(a.x+b.w/2,a.y);this._addButton("panup","north-mini.png",c,b);a.y=c.y+b.h;this._addButton("panleft","west-mini.png",a,b);this._addButton("panright","east-mini.png",a.add(b.w,0),b);this._addButton("pandown","south-mini.png",c.add(0,b.h*2),b);this._addButton("zoomin","zoom-plus-mini.png",c.add(0,b.h*3+5),b);this._addButton("zoomworld","zoom-world-mini.png",c.add(0,b.h*4+5),b);this._addButton("zoomout","zoom-minus-mini.png",c.add(0,b.h*5+5),b);return this.div},_addButton:function(a,b,c,d){var e=OpenLayers.Util.getImagesLocation()+b;var f=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,e,"absolute");this.div.appendChild(f);OpenLayers.Event.observe(f,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,f));OpenLayers.Event.observe(f,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,f));OpenLayers.Event.observe(f,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,f));f.action=a;f.map=this.map;if(!this.slideRatio){var g=this.slideFactor;var h=function(){return g}}else{var i=this.slideRatio;var h=function(a){return this.map.getSize()[a]*i}}f.getSlideFactor=h;this.buttons.push(f);return f},_removeButton:function(a){OpenLayers.Event.stopObservingElement(a);a.map=null;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a){this._removeButton(this.buttons[a])}},doubleClick:function(a){OpenLayers.Event.stop(a);return false},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break}OpenLayers.Event.stop(a)},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,defaultControl:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[]},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a=this.controls.length-1;a>=0;a--){if(this.controls[a].events){this.controls[a].events.un({activate:this.redraw,deactivate:this.redraw,scope:this})}OpenLayers.Event.stopObservingElement(this.controls[a].panel_div);this.controls[a].panel_div=null}},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a=0,b=this.controls.length;a<b;a++){if(this.controls[a]==this.defaultControl){this.controls[a].activate()}}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a=0,b=this.controls.length;a<b;a++){this.controls[a].deactivate()}return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);for(var a=0,b=this.controls.length;a<b;a++){this.map.addControl(this.controls[a]);this.controls[a].deactivate();this.controls[a].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.activate();return this.div},redraw:function(){this.div.innerHTML="";if(this.active){for(var a=0,b=this.controls.length;a<b;a++){var c=this.controls[a].panel_div;if(this.controls[a].active){c.className=this.controls[a].displayClass+"ItemActive"}else{c.className=this.controls[a].displayClass+"ItemInactive"}this.div.appendChild(c)}}},activateControl:function(a){if(!this.active){return false}if(a.type==OpenLayers.Control.TYPE_BUTTON){a.trigger();this.redraw();return}if(a.type==OpenLayers.Control.TYPE_TOGGLE){if(a.active){a.deactivate()}else{a.activate()}this.redraw();return}for(var b=0,c=this.controls.length;b<c;b++){if(this.controls[b]!=a){if(this.controls[b].type!=OpenLayers.Control.TYPE_TOGGLE){this.controls[b].deactivate()}}}a.activate()},addControls:function(a){if(!(a instanceof Array)){a=[a]}this.controls=this.controls.concat(a);for(var b=0,c=a.length;b<c;b++){var d=document.createElement("div");var e=document.createTextNode(" ");a[b].panel_div=d;if(a[b].title!=""){a[b].panel_div.title=a[b].title}OpenLayers.Event.observe(a[b].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,a[b]));OpenLayers.Event.observe(a[b].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}if(this.map){for(var b=0,c=a.length;b<c;b++){this.map.addControl(a[b]);a[b].deactivate();a[b].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.redraw()}},onClick:function(a,b){OpenLayers.Event.stop(b?b:window.event);this.activateControl(a)},getControlsBy:function(a,b){var c=typeof b.test=="function";var d=OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])});return d},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.element=OpenLayers.Util.getElement(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var a=this.map.getScale();if(!a){return}if(a>=9500&&a<=95e4){a=Math.round(a/1e3)+"K"}else if(a>=95e4){a=Math.round(a/1e6)+"M"}else{a=Math.round(a)}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:a})},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.div.style.display="block";this.div.style.position="absolute";this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if(this.topOutUnits==""||this.topInUnits==""){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if(this.bottomOutUnits==""||this.bottomInUnits==""){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/Math.log(10));var c=Math.pow(10,b);var d=parseInt(a/c);var e;if(d>5){e=5}else if(d>2){e=2}else{e=1}return e*c},update:function(){var a=this.map.getResolution();if(!a){return}var b=this.map.getUnits();var c=OpenLayers.INCHES_PER_UNIT;var d=this.maxWidth*a*c[b];var e;var f;if(d>1e5){e=this.topOutUnits;f=this.bottomOutUnits}else{e=this.topInUnits;f=this.bottomInUnits}var g=d/c[e];var h=d/c[f];var i=this.getBarLen(g);var j=this.getBarLen(h);g=i/c[b]*c[e];h=j/c[b]*c[f];var k=g/a;var l=h/a;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(l)+"px";this.eBottom.innerHTML=j+" "+f}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(k)+"px";this.eTop.innerHTML=i+" "+e}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return a.which&&a.which==1||a.button&&a.button==1},isRightClick:function(a){return a.which&&a.which==3||a.button&&a.button==2},stop:function(a,b){if(!b){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}},findElement:function(a,b){var c=OpenLayers.Event.element(a);while(c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase())){c=c.parentNode}return c},observe:function(a,b,c,d){var e=OpenLayers.Util.getElement(a);d=d||false;if(b=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)){b="keydown"}if(!this.observers){this.observers={}}if(!e._eventCacheID){var f="eventCacheID_";if(e.id){f=e.id+"_"+f}e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;if(!this.observers[g]){this.observers[g]=[]}this.observers[g].push({element:e,name:b,observer:c,useCapture:d});if(e.addEventListener){e.addEventListener(b,c,d)}else if(e.attachEvent){e.attachEvent("on"+b,c)}},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a);var c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(a){if(a){for(var b=a.length-1;b>=0;b--){var c=a[b];var d=new Array(c.element,c.name,c.observer,c.useCapture);var e=OpenLayers.Event.stopObserving.apply(this,d)}}},stopObserving:function(a,b,c,d){d=d||false;var e=OpenLayers.Util.getElement(a);var f=e._eventCacheID;if(b=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent){b="keydown"}}var g=false;var h=OpenLayers.Event.observers[f];if(h){var i=0;while(!g&&i<h.length){var j=h[i];if(j.name==b&&j.observer==c&&j.useCapture==d){h.splice(i,1);if(h.length==0){delete OpenLayers.Event.observers[f]}g=true;break}i++}}if(g){if(e.removeEventListener){e.removeEventListener(b,c,d)}else if(e&&e.detachEvent){e.detachEvent("on"+b,c)}}return g},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)}else{var Event=OpenLayers.Event}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e);this.object=a;this.fallThrough=d;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(c!=null){for(var f=0,g=c.length;f<g;f++){this.addEventType(c[f])}}if(b!=null){this.attachToElement(b)}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[]}},attachToElement:function(a){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}this.element=a;for(var b=0,c=this.BROWSER_EVENTS.length;b<c;b++){var d=this.BROWSER_EVENTS[b];this.addEventType(d);OpenLayers.Event.observe(a,d,this.eventHandler)}OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b])}}},register:function(a,b,c){if(c!=null&&OpenLayers.Util.indexOf(this.eventTypes,a)!=-1){if(b==null){b=this.object}var d=this.listeners[a];d.push({obj:b,func:c})}},registerPriority:function(a,b,c){if(c!=null){if(b==null){b=this.object}var d=this.listeners[a];if(d!=null){d.unshift({obj:b,func:c})}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b])}}},unregister:function(a,b,c){if(b==null){b=this.object}var d=this.listeners[a];if(d!=null){for(var e=0,f=d.length;e<f;e++){if(d[e].obj==b&&d[e].func==c){d.splice(e,1);break}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[]}},triggerEvent:function(a,b){var c=this.listeners[a];if(!c||c.length==0){return}if(b==null){b={}}b.object=this.object;b.element=this.element;if(!b.type){b.type=a}var c=c.slice(),d;for(var e=0,f=c.length;e<f;e++){var g=c[e];d=g.func.apply(g.obj,[b]);if(d!=undefined&&d==false){break}}if(!this.fallThrough){OpenLayers.Event.stop(b,true)}return d},handleBrowserEvent:function(a){if(this.includeXY){a.xy=this.getMousePosition(a)}this.triggerEvent(a.type,a)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache()}else if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}if(!this.element.scrolls){this.element.scrolls=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1]}return new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you "+"destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use "+"with the FixedZoomLevels-descendent layers. That this "+"wfs layer checks for minZoomLevel is a relic of the"+"past. We cannot, however, remove it without possibly "+"breaking OL based applications that may depend on it."+" Therefore we are deprecating it -- the minZoomLevel "+"check below will be removed at 3.0. Please instead "+"use min/max resolution setting as described here: "+"http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>"+"To get rid of this message, select a new BaseLayer "+"in the layer switcher in the upper-right corner.<br><br>"+"Most likely, this is because the Google Maps library "+"script was either not included, or does not contain the "+"correct API key for your site.<br><br>"+"Developers: For help getting this working correctly, "+"<a href='http://trac.openlayers.org/wiki/Google' "+"target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>"+"To get rid of this message, select a new BaseLayer "+"in the layer switcher in the upper-right corner.<br><br>"+"Most likely, this is because the ${layerLib} library "+"script was not correctly included.<br><br>"+"Developers: For help getting this working correctly, "+"<a href='http://trac.openlayers.org/wiki/${layerLib}' "+"target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option "+"on the ${layerName} layer. This option is deprecated: "+"its use was designed to support displaying data over commercial "+"basemaps, but that functionality should now be achieved by using "+"Spherical Mercator support. More information is available from "+"http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. "+"Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",end:"",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type."};OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(a,b,c,d,e,f,g){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)}}},setBorder:function(a){this.border=0},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity()}},getCornersToRound:function(){var a=["tl","tr","bl","br"];var b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(a,b);return a.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(a){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(f){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];if(b.image){b.div.removeChild(b.image)}b.image=null;if(b.div){this.groupDiv.removeChild(b.div)}b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);b=b.offset(this.positionBlocks[this.relativePosition].offset);return b},createBlocks:function(){this.blocks=[];var a=null;for(var b in this.positionBlocks){a=b;break}var c=this.positionBlocks[a];for(var d=0;d<c.blocks.length;d++){var e={};this.blocks.push(e);var f=this.id+"_FrameDecorationDiv_"+d;e.div=OpenLayers.Util.createDiv(f,null,null,null,"absolute",null,"hidden",null);var g=this.id+"_FrameDecorationImg_"+d;var h=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;e.image=h(g,null,this.imageSize,this.imageSrc,"absolute",null,null,null);e.div.appendChild(e.image);this.groupDiv.appendChild(e.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var a=this.positionBlocks[this.relativePosition];for(var b=0;b<a.blocks.length;b++){var c=a.blocks[b];var d=this.blocks[b];var e=c.anchor.left;var f=c.anchor.bottom;var g=c.anchor.right;var h=c.anchor.top;var i=isNaN(c.size.w)?this.size.w-(g+e):c.size.w;var j=isNaN(c.size.h)?this.size.h-(f+h):c.size.h;d.div.style.width=(i<0?0:i)+"px";d.div.style.height=(j<0?0:j)+"px";d.div.style.left=e!=null?e+"px":"";d.div.style.bottom=f!=null?f+"px":"";d.div.style.right=g!=null?g+"px":"";d.div.style.top=h!=null?h+"px":"";d.image.style.left=c.position.x+"px";d.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.projCode=a;if(window.Proj4js){this.proj=new Proj4js.Proj(a)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){if(a&&a.getCode){return this.getCode()==a.getCode()}else{return false}},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(a,b,c){if(!OpenLayers.Projection.transforms[a]){OpenLayers.Projection.transforms[a]={}}OpenLayers.Projection.transforms[a][b]=c};OpenLayers.Projection.transform=function(a,b,c){if(b.proj&&c.proj){a=Proj4js.transform(b.proj,c.proj,a)}else if(b&&c&&OpenLayers.Projection.transforms[b.getCode()]&&OpenLayers.Projection.transforms[b.getCode()][c.getCode()]){OpenLayers.Projection.transforms[b.getCode()][c.getCode()](a)}return a};OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);if(!a.format){this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))}if(!this.featureNS){var b=this.format.readNode;this.format.readNode=function(a,c){if(!this.featureNS&&a.prefix==this.featurePrefix){this.featureNS=a.namespaceURI;this.setNamespace("feature",this.featureNS)}return b.apply(this,arguments)}}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},read:function(a){a=OpenLayers.Util.extend({},a);OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"});var c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c});return b},handleRead:function(a,b){if(b.callback){var c=a.priv;if(c.status>=200&&c.status<300){a.features=this.parseFeatures(c);a.code=OpenLayers.Protocol.Response.SUCCESS}else{a.code=OpenLayers.Protocol.Response.FAILURE}b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:a});c.priv=OpenLayers.Request.POST({url:b.url,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)});return c},handleCommit:function(a,b){if(b.callback){var c=a.priv;var d=c.responseXML;if(!d||!d.documentElement){d=c.responseText}var e=this.format.read(d)||{};a.insertIds=e.insertIds||[];a.code=e.success?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit"});var d=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});var e=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType}});if(b.featureNS){e.setAttribute("xmlns:"+this.featurePrefix,b.featureNS)}var f=this.format.writeNode("ogc:Filter",a);e.appendChild(f);d.appendChild(e);var g=OpenLayers.Format.XML.prototype.write.apply(this.format,[d]);return OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:g})},abort:function(a){if(a){a.priv.abort()}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolSize:{},isGecko:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.isGecko=navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1"))},inValidRange:function(a,b,c){var d=a+(c?0:this.translationParameters.x);var e=b+(c?0:this.translationParameters.y);return d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL},setExtent:function(a,b){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution();var d=-a.left/c;var e=a.top/c;if(b){this.left=d;this.top=e;var f="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",f);this.translate(0,0);return true}else{var g=this.translate(d-this.left,e-this.top);if(!g){this.setExtent(a,true)}return g}},translate:function(a,b){if(!this.inValidRange(a,b,true)){return false}else{var c="";if(a||b){c="translate("+a+","+b+")"}this.root.setAttributeNS(null,"transform",c);this.translationParameters={x:a,y:b};return true}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){c="image"}else if(this.isComplexSymbol(b.graphicName)){c="use"}else{c="circle"}break;case"OpenLayers.Geometry.Rectangle":c="rect";break;case"OpenLayers.Geometry.LineString":c="polyline";break;case"OpenLayers.Geometry.LinearRing":c="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":c="path";break;default:break}return c},setStyle:function(a,b,c){b=b||a._style;c=c||a._options;var d=parseFloat(a.getAttributeNS(null,"r"));var e=1;var f;if(a._geometryClass=="OpenLayers.Geometry.Point"&&d){a.style.visibility="";if(b.graphic===false){a.style.visibility="hidden"}else if(b.externalGraphic){f=this.getPosition(a);if(b.graphicTitle){a.setAttributeNS(null,"title",b.graphicTitle)}if(b.graphicWidth&&b.graphicHeight){a.setAttributeNS(null,"preserveAspectRatio","none")}var g=b.graphicWidth||b.graphicHeight;var h=b.graphicHeight||b.graphicWidth;g=g?g:b.pointRadius*2;h=h?h:b.pointRadius*2;var i=b.graphicXOffset!=undefined?b.graphicXOffset:-(.5*g);var j=b.graphicYOffset!=undefined?b.graphicYOffset:-(.5*h);var k=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(f.x+i).toFixed());a.setAttributeNS(null,"y",(f.y+j).toFixed());a.setAttributeNS(null,"width",g);a.setAttributeNS(null,"height",h);a.setAttributeNS(this.xlinkns,"href",b.externalGraphic);a.setAttributeNS(null,"style","opacity: "+k)}else if(this.isComplexSymbol(b.graphicName)){var l=b.pointRadius*3;var m=l*2;var n=this.importSymbol(b.graphicName);var o="#"+n;f=this.getPosition(a);e=this.symbolSize[n]/m;var p=a.parentNode;var q=a.nextSibling;if(p){p.removeChild(a)}a.setAttributeNS(this.xlinkns,"href",o);a.setAttributeNS(null,"width",m);a.setAttributeNS(null,"height",m);a.setAttributeNS(null,"x",f.x-l);a.setAttributeNS(null,"y",f.y-l);if(q){p.insertBefore(a,q)}else if(p){p.appendChild(a)}}else{a.setAttributeNS(null,"r",b.pointRadius)}if(typeof b.rotation!="undefined"&&f){var r=OpenLayers.String.format("rotate(${0} ${1} ${2})",[b.rotation,f.x,f.y]);a.setAttributeNS(null,"transform",r)}}if(c.isFilled){a.setAttributeNS(null,"fill",b.fillColor);a.setAttributeNS(null,"fill-opacity",b.fillOpacity)}else{a.setAttributeNS(null,"fill","none")}if(c.isStroked){a.setAttributeNS(null,"stroke",b.strokeColor);a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity);a.setAttributeNS(null,"stroke-width",b.strokeWidth*e);a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap);a.setAttributeNS(null,"stroke-linejoin","round");a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,e))}else{a.setAttributeNS(null,"stroke","none")}if(b.pointerEvents){a.setAttributeNS(null,"pointer-events",b.pointerEvents)}if(b.cursor!=null){a.setAttributeNS(null,"cursor",b.cursor)}return a},dashStyle:function(a,b){var c=a.strokeWidth*b;switch(a.strokeDashstyle){case"solid":return"none";case"dot":return[1,4*c].join();case"dash":return[4*c,4*c].join();case"dashdot":return[4*c,4*c,1,4*c].join();case"longdash":return[8*c,4*c].join();case"longdashdot":return[8*c,4*c,1,4*c].join();default:return a.strokeDashstyle.replace(/ /g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);if(b){c.setAttributeNS(null,"id",b)}return c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){var d=this.getResolution();var e=b.x/d+this.left;var f=this.top-b.y/d;if(this.inValidRange(e,f)){a.setAttributeNS(null,"cx",e);a.setAttributeNS(null,"cy",f);a.setAttributeNS(null,"r",c);return a}else{return false}},drawLineString:function(a,b){var c=this.getComponentsString(b.components);if(c.path){a.setAttributeNS(null,"points",c.path);return c.complete?a:null}else{return false}},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);if(c.path){a.setAttributeNS(null,"points",c.path);return c.complete?a:null}else{return false}},drawPolygon:function(a,b){var c="";var d=true;var e=true;var f,g;for(var h=0,i=b.components.length;h<i;h++){c+=" M";f=this.getComponentsString(b.components[h].components," ");g=f.path;if(g){c+=" "+g;e=f.complete&&e}else{d=false}}c+=" z";if(d){a.setAttributeNS(null,"d",c);a.setAttributeNS(null,"fill-rule","evenodd");return e?a:null}else{return false}},drawRectangle:function(a,b){var c=this.getResolution();var d=b.x/c+this.left;var e=this.top-b.y/c;if(this.inValidRange(d,e)){a.setAttributeNS(null,"x",d);a.setAttributeNS(null,"y",e);a.setAttributeNS(null,"width",b.width/c);a.setAttributeNS(null,"height",b.height/c);return a}else{return false}},drawSurface:function(a,b){var c=null;var d=true;for(var e=0,f=b.components.length;e<f;e++){if(e%3==0&&e/3==0){var g=this.getShortString(b.components[e]);if(!g){d=false}c="M "+g}else if(e%3==1){var g=this.getShortString(b.components[e]);if(!g){d=false}c+=" C "+g}else{var g=this.getShortString(b.components[e]);if(!g){d=false}c+=" "+g}}c+=" Z";if(d){a.setAttributeNS(null,"d",c);return a}else{return false}},drawText:function(a,b,c){var d=this.getResolution();var e=c.x/d+this.left;var f=c.y/d-this.top;var g=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"text");var h=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_tspan","tspan");g.setAttributeNS(null,"x",e);g.setAttributeNS(null,"y",-f);g.setAttributeNS(null,"pointer-events","none");if(b.fontColor){g.setAttributeNS(null,"fill",b.fontColor)}if(b.fontFamily){g.setAttributeNS(null,"font-family",b.fontFamily)}if(b.fontSize){g.setAttributeNS(null,"font-size",b.fontSize)}if(b.fontWeight){g.setAttributeNS(null,"font-weight",b.fontWeight)}var i=b.labelAlign||"cm";g.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[i[0]]||"middle");if(this.isGecko){g.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[i[1]]||"central")}else{h.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[i[1]]||"-35%")}h.textContent=b.label;if(!g.parentNode){g.appendChild(h);this.textRoot.appendChild(g)}},getComponentsString:function(a,b){var c=[];var d=true;var e=a.length;var f=[];var g,h,i;for(var j=0;j<e;j++){h=a[j];c.push(h);g=this.getShortString(h);if(g){f.push(g)}else{if(j>0){if(this.getShortString(a[j-1])){f.push(this.clipLine(a[j],a[j-1]))}}if(j<e-1){if(this.getShortString(a[j+1])){f.push(this.clipLine(a[j],a[j+1]))}}d=false}}return{path:f.join(b||","),complete:d}},clipLine:function(a,b){if(b.equals(a)){return""}var c=this.getResolution();var d=this.MAX_PIXEL-this.translationParameters.x;var e=this.MAX_PIXEL-this.translationParameters.y;var f=b.x/c+this.left;var g=this.top-b.y/c;var h=a.x/c+this.left;var i=this.top-a.y/c;var j;if(h<-d||h>d){j=(i-g)/(h-f);h=h<0?-d:d;i=g+(h-f)*j}if(i<-e||i>e){j=(h-f)/(i-g);i=i<0?-e:e;h=f+(i-g)*j}return h+","+i},getShortString:function(a){var b=this.getResolution();var c=a.x/b+this.left;var d=this.top-a.y/b;if(this.inValidRange(c,d)){return c+","+d}else{return false}},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+a;if(document.getElementById(b)!=null){return b}var c=OpenLayers.Renderer.symbol[a];if(!c){throw new Error(a+" is not a valid symbol name");return}var d=this.nodeFactory(b,"symbol");var e=this.nodeFactory(null,"polygon");d.appendChild(e);var f=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var g="";var h,i;for(var j=0;j<c.length;j=j+2){h=c[j];i=c[j+1];f.left=Math.min(f.left,h);f.bottom=Math.min(f.bottom,i);f.right=Math.max(f.right,h);f.top=Math.max(f.top,i);g+=" "+h+","+i}e.setAttributeNS(null,"points",g);var k=f.getWidth();var l=f.getHeight();var m=[f.left-k,f.bottom-l,k*3,l*3];d.setAttributeNS(null,"viewBox",m.join(" "));this.symbolSize[b]=Math.max(k,l)*3;this.defs.appendChild(d);return d.id},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(a){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var b=document.createStyleSheet();var c=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var d=0,e=c.length;d<e;d++){b.addRule("olv\\:"+c[d],"behavior: url(#default#VML); "+"position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.offset={x:0,y:0}},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){return!!document.namespaces},setExtent:function(a,b){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution();var d=a.left/c;var e=a.top/c-this.size.h;if(b){this.offset={x:d,y:e};d=0;e=0}else{d=d-this.offset.x;e=e-this.offset.y}var f=d+" "+e;this.root.coordorigin=f;var g=[this.root,this.vectorRoot,this.textRoot];var h;for(var i=0,j=g.length;i<j;++i){h=g[i];var k=this.size.w+" "+this.size.h;h.coordsize=k}this.root.style.flip="y";return true},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var c=this.size.w+"px";var d=this.size.h+"px";var e;for(var f=0,g=b.length;f<g;++f){e=b[f];e.style.width=c;e.style.height=d}},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){c="olv:rect"}else if(this.isComplexSymbol(b.graphicName)){c="olv:shape"}else{c="olv:oval"}break;case"OpenLayers.Geometry.Rectangle":c="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":c="olv:shape";break;default:break}return c},setStyle:function(a,b,c,d){b=b||a._style;c=c||a._options;var e=1;if(a._geometryClass=="OpenLayers.Geometry.Point"){if(b.externalGraphic){if(b.graphicTitle){a.title=b.graphicTitle}var f=b.graphicWidth||b.graphicHeight;var g=b.graphicHeight||b.graphicWidth;f=f?f:b.pointRadius*2;g=g?g:b.pointRadius*2;var h=this.getResolution();var i=b.graphicXOffset!=undefined?b.graphicXOffset:-(.5*f);var j=b.graphicYOffset!=undefined?b.graphicYOffset:-(.5*g);a.style.left=(d.x/h-this.offset.x+i).toFixed();a.style.top=(d.y/h-this.offset.y-(j+g)).toFixed();a.style.width=f+"px";a.style.height=g+"px";a.style.flip="y";b.fillColor="none";c.isStroked=false}else if(this.isComplexSymbol(b.graphicName)){var k=this.importSymbol(b.graphicName);a.path=k.path;a.coordorigin=k.left+","+k.bottom;var l=k.size;a.coordsize=l+","+l;this.drawCircle(a,d,b.pointRadius);a.style.flip="y"}else{this.drawCircle(a,d,b.pointRadius)}}if(c.isFilled){a.fillcolor=b.fillColor}else{a.filled="false"}var m=a.getElementsByTagName("fill");var n=m.length==0?null:m[0];if(!c.isFilled){if(n){a.removeChild(n)}}else{if(!n){n=this.createNode("olv:fill",a.id+"_fill")}n.opacity=b.fillOpacity;if(a._geometryClass=="OpenLayers.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity){n.opacity=b.graphicOpacity}n.src=b.externalGraphic;n.type="frame";if(!(b.graphicWidth&&b.graphicHeight)){n.aspect="atmost"}}if(n.parentNode!=a){a.appendChild(n)}}if(typeof b.rotation!="undefined"){if(b.externalGraphic){this.graphicRotate(a,i,j);n.opacity=0}else{a.style.rotation=b.rotation}}if(c.isStroked){a.strokecolor=b.strokeColor;a.strokeweight=b.strokeWidth+"px"}else{a.stroked=false}var o=a.getElementsByTagName("stroke");var p=o.length==0?null:o[0];if(!c.isStroked){if(p){a.removeChild(p)}}else{if(!p){p=this.createNode("olv:stroke",a.id+"_stroke");a.appendChild(p)}p.opacity=b.strokeOpacity;p.endcap=!b.strokeLinecap||b.strokeLinecap=="butt"?"flat":b.strokeLinecap;p.dashstyle=this.dashStyle(b)}if(b.cursor!="inherit"&&b.cursor!=null){a.style.cursor=b.cursor}return a},graphicRotate:function(a,b,c){var d=d||a._style;var e=a._options;var f,g;if(!(d.graphicWidth&&d.graphicHeight)){var h=new Image;h.onreadystatechange=OpenLayers.Function.bind(function(){if(h.readyState=="complete"||h.readyState=="interactive"){f=h.width/h.height;g=Math.max(d.pointRadius*2,d.graphicWidth||0,d.graphicHeight||0);b=b*f;d.graphicWidth=g*f;d.graphicHeight=g;this.graphicRotate(a,b,c)}},this);h.src=d.externalGraphic;return}else{g=Math.max(d.graphicWidth,d.graphicHeight);f=d.graphicWidth/d.graphicHeight}var i=Math.round(d.graphicWidth||g*f);var j=Math.round(d.graphicHeight||g);a.style.width=i+"px";a.style.height=j+"px";var k=document.getElementById(a.id+"_image");if(!k){k=this.createNode("olv:imagedata",a.id+"_image");a.appendChild(k)}k.style.width=i+"px";k.style.height=j+"px";k.src=d.externalGraphic;k.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader("+"src='', sizingMethod='scale')";var l=d.rotation*Math.PI/180;var m=Math.sin(l);var n=Math.cos(l);var o="progid:DXImageTransform.Microsoft.Matrix(M11="+n+",M12="+ -m+",M21="+m+",M22="+n+",SizingMethod='auto expand')\n";var p=d.graphicOpacity||d.fillOpacity;if(p&&p!=1){o+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+p+")\n"}a.style.filter=o;var q=new OpenLayers.Geometry.Point(-b,-c);var r=(new OpenLayers.Bounds(0,0,i,j)).toGeometry();r.rotate(d.rotation,q);var s=r.getBounds();a.style.left=Math.round(parseInt(a.style.left)+s.left)+"px";a.style.top=Math.round(parseInt(a.style.top)-s.bottom)+"px"},postDraw:function(a){var b=a._style.fillColor;var c=a._style.strokeColor;if(b=="none"&&a.fillcolor!=b){a.fillcolor=b}if(c=="none"&&a.strokecolor!=c){a.strokecolor=c}},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution();var e=new OpenLayers.Bounds((c.left/d-this.offset.x).toFixed(),(c.bottom/d-this.offset.y).toFixed(),(c.right/d-this.offset.x).toFixed(),(c.top/d-this.offset.y).toFixed());a.style.left=e.left+"px";a.style.top=e.top+"px";a.style.width=e.getWidth()+"px";a.style.height=e.getHeight()+"px";a.coordorigin=e.left+" "+e.top;a.coordsize=e.getWidth()+" "+e.getHeight()}},dashStyle:function(a){var b=a.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:var c=b.split(/[ ,]/);if(c.length==2){if(1*c[0]>=2*c[1]){return"longdash"}return c[0]==1||c[1]==1?"dot":"dash"}else if(c.length==4){return 1*c[0]>=2*c[1]?"longdashdot":"dashdot"}return"solid"}},createNode:function(a,b){var c=document.createElement(a);if(b){c.id=b}c.unselectable="on";c.onselectstart=function(){return false};return c},nodeTypeCompare:function(a,b){var c=b;var d=c.indexOf(":");if(d!=-1){c=c.substr(d+1)}var e=a.nodeName;d=e.indexOf(":");if(d!=-1){e=e.substr(d+1)}return c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=(b.x/d-this.offset.x).toFixed()-c+"px";a.style.top=(b.y/d-this.offset.y).toFixed()-c+"px";var e=c*2;a.style.width=e+"px";a.style.height=e+"px";return a}return false},drawLineString:function(a,b){return this.drawLine(a,b,false)},drawLinearRing:function(a,b){return this.drawLine(a,b,true)},drawLine:function(a,b,c){this.setNodeDimension(a,b);var d=this.getResolution();var e=b.components.length;var f=new Array(e);var g,h,i;for(var j=0;j<e;j++){g=b.components[j];h=g.x/d-this.offset.x;i=g.y/d-this.offset.y;f[j]=" "+h.toFixed()+","+i.toFixed()+" l "}var k=c?" x e":" e";a.path="m"+f.join("")+k;return a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c=this.getResolution();var d=[];var e,f,g,h,i,j,k,l;for(g=0,h=b.components.length;g<h;g++){e=b.components[g];d.push("m");for(f=0,i=e.components.length;f<i;f++){j=e.components[f];k=j.x/c-this.offset.x;l=j.y/c-this.offset.y;d.push(" "+k.toFixed()+","+l.toFixed());if(f==0){d.push(" l")}}d.push(" x ")}d.push("e");a.path=d.join("");return a},drawRectangle:function(a,b){var c=this.getResolution();a.style.left=b.x/c-this.offset.x+"px";a.style.top=b.y/c-this.offset.y+"px";a.style.width=b.width/c+"px";a.style.height=b.height/c+"px";return a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect");var e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var f=this.getResolution();d.style.left=(c.x/f-this.offset.x).toFixed()+"px";d.style.top=(c.y/f-this.offset.y).toFixed()+"px";d.style.flip="y";e.innerText=b.label;if(b.fillColor){e.style.color=b.fontColor}if(b.fontFamily){e.style.fontFamily=b.fontFamily}if(b.fontSize){e.style.fontSize=b.fontSize}if(b.fontWeight){e.style.fontWeight=b.fontWeight}e.style.whiteSpace="nowrap";e.inset="1px,0px,0px,0px";if(!d.parentNode){d.appendChild(e);this.textRoot.appendChild(d)}var g=b.labelAlign||"cm";var h=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)];var i=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)];d.style.left=parseInt(d.style.left)-h-1+"px";d.style.top=parseInt(d.style.top)+i+"px"},drawSurface:function(a,b){this.setNodeDimension(a,b);var c=this.getResolution();var d=[];var e,f,g;for(var h=0,i=b.components.length;h<i;h++){e=b.components[h];f=e.x/c-this.offset.x;g=e.y/c-this.offset.y;if(h%3==0&&h/3==0){d.push("m")}else if(h%3==1){d.push(" c")}d.push(" "+f+","+g)}d.push(" x e");a.path=d.join("");return a},moveRoot:function(a){var b=this.map.getLayer(a.container.id);if(b instanceof OpenLayers.Layer.Vector.RootContainer){b=this.map.getLayer(this.container.id)}b&&b.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a;var c=this.symbolCache[b];if(c){return c}var d=OpenLayers.Renderer.symbol[a];if(!d){throw new Error(a+" is not a valid symbol name");return}var e=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var f=["m"];for(var g=0;g<d.length;g=g+2){x=d[g];y=d[g+1];e.left=Math.min(e.left,x);e.bottom=Math.min(e.bottom,y);e.right=Math.max(e.right,x);e.top=Math.max(e.top,y);f.push(x);f.push(y);if(g==0){f.push("l")}}f.push("x e");var h=f.join(" ");var i=(e.getWidth()-e.getHeight())/2;if(i>0){e.bottom=e.bottom-i;e.top=e.top+i}else{e.left=e.left-i;e.right=e.right+i}c={path:h,size:e.getWidth(),left:e.left,bottom:e.bottom};this.symbolCache[b]=c;return c},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1};OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(a,b,c,d,e){this.layer=a;this.position=b.clone();this.bounds=c.clone();this.url=d;this.size=e.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)}OpenLayers.Util.applyDefaults(a,this);return a},draw:function(){var a=this.layer.maxExtent;var b=a&&this.bounds.intersectsBounds(a,false);this.shouldDraw=b||this.layer.displayOutsideMaxExtent;this.clear();return this.shouldDraw},moveTo:function(a,b,c){if(c==null){c=true}this.bounds=a.clone();this.position=b.clone();if(c){this.draw()}},clear:function(){},getBoundsFromBaseLayer:function(a){var b=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(b);var c=this.layer.map.getLonLatFromLayerPx(a);var d=a.clone();d.x+=this.size.w;d.y+=this.size.h;var e=this.layer.map.getLonLatFromLayerPx(d);if(c.lon>e.lon){if(c.lon<0){c.lon=-180-(c.lon+180)}else{e.lon=180+e.lon+180}}var f=new OpenLayers.Bounds(c.lon,e.lat,e.lon,c.lat);return f},showTile:function(){if(this.shouldDraw){this.show()}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y);if(a){this.position=a}if(b){this.direction=b}this.measureDivs=[]},destroy:function(){for(var a in this.buttons){var b=this.buttons[a];b.map=null;b.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments);this.buttons={};var a=new OpenLayers.Size(28,28);var b=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",b,a,"Shift->Drag to zoom to area");b=b.add(this.direction=="vertical"?0:a.w,this.direction=="vertical"?a.h:0);this._addButton("pan","panning-hand-off.png","panning-hand-on.png",b,a,"Drag the map to pan.");b=b.add(this.direction=="vertical"?0:a.w,this.direction=="vertical"?a.h:0);this.switchModeTo("pan");return this.div},_addButton:function(a,b,c,d,e,f){var g=OpenLayers.Util.getImagesLocation()+b;var h=OpenLayers.Util.getImagesLocation()+c;var i=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+a,d,e,g,"absolute");this.div.appendChild(i);i.imgLocation=g;i.activeImgLocation=h;i.events=new OpenLayers.Events(this,i,null,true);i.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this});i.action=a;i.title=f;i.alt=f;i.map=this.map;this.buttons[a]=i;return i},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.buttonClicked=a.element.action;OpenLayers.Event.stop(a)},buttonUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.buttonClicked!=null){if(this.buttonClicked==a.element.action){this.switchModeTo(a.element.action)}OpenLayers.Event.stop(a);this.buttonClicked=null}},defaultDblClick:function(a){this.switchModeTo("pan");this.performedDrag=false;var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom+1);OpenLayers.Event.stop(a);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;this.startViaKeyboard=false;if(a.shiftKey&&this.mode!="zoombox"){this.switchModeTo("zoombox");this.startViaKeyboard=true}else if(a.altKey&&this.mode!="measure"){this.switchModeTo("measure")}else if(!this.mode){this.switchModeTo("pan")}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.performedDrag=true;break;case"measure":var b="";if(this.measureStart){var c=this.map.getLonLatFromViewPortPx(this.mouseDragStart);b=OpenLayers.Util.distVincenty(this.measureStart,c);b=Math.round(b*100)/100;b=b+"km";this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart);this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBox.style.width="4px";this.measureBox.style.height="4px";this.measureBox.style.fontSize="1px";this.measureBox.style.backgroundColor="red";this.measureBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.layerContainerDiv.appendChild(this.measureBox);if(b){this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBoxDistance.innerHTML=b;this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.layerContainerDiv.appendChild(this.measureBoxDistance);this.measureDivs.push(this.measureBoxDistance)}this.measureBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.layerContainerDiv.appendChild(this.measureBox);this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move";break}document.onselectstart=function(){return false};OpenLayers.Event.stop(a)},switchModeTo:function(a){if(a!=this.mode){if(this.mode&&this.buttons[this.mode]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation)}if(this.mode=="measure"&&a!="measure"){for(var b=0,c=this.measureDivs.length;b<c;b++){if(this.measureDivs[b]){this.map.layerContainerDiv.removeChild(this.measureDivs[b])}}this.measureDivs=[];this.measureStart=null}this.mode=a;if(this.buttons[a]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[a],null,null,null,this.buttons[a].activeImgLocation)}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor="";break}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(a){if(this.mouseDragStart!=null){switch(this.mode){case"zoombox":var b=Math.abs(this.mouseDragStart.x-a.xy.x);var c=Math.abs(this.mouseDragStart.y-a.xy.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,c)+"px";if(a.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=a.xy.x+"px"}if(a.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=a.xy.y+"px"}break;default:var b=this.mouseDragStart.x-a.xy.x;var c=this.mouseDragStart.y-a.xy.y;var d=this.map.getSize();var e=new OpenLayers.Pixel(d.w/2+b,d.h/2+c);var f=this.map.getLonLatFromViewPortPx(e);this.map.setCenter(f,null,true);this.mouseDragStart=a.xy.clone()}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.mode){case"zoombox":this.zoomBoxEnd(a);if(this.startViaKeyboard){this.leaveMode()}break;case"pan":if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="default"},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();if(this.startViaKeyboard){this.leaveMode()}}this.mouseDragStart=null;this.map.div.style.cursor="default"}},defaultClick:function(a){if(this.performedDrag){this.performedDrag=false;return false}},CLASS_NAME:"OpenLayers.Control.MouseToolbar"});OpenLayers.Control.MouseToolbar.X=6;OpenLayers.Control.MouseToolbar.Y=300;OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,activateOnDraw:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution()}}},this.registry);this.clear();var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions);this.next=new OpenLayers.Control.Button(c)},onPreviousChange:function(a,b){if(a&&!this.previous.active){this.previous.activate()}else if(!a&&this.previous.active){this.previous.deactivate()}},onNextChange:function(a,b){if(a&&!this.next.active){this.next.activate()}else if(!a&&this.next.active){this.next.deactivate()}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();if(this.activateOnDraw){this.activate()}},previousTrigger:function(){var a=this.previousStack.shift();var b=this.previousStack.shift();if(b!=undefined){this.nextStack.unshift(a);this.previousStack.unshift(b);this.restoring=true;this.restore(b);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(a)}return b},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return a},clear:function(){this.previousStack=[];this.nextStack=[]},restore:function(a){var b=this.map.getZoomForResolution(a.resolution);this.map.setCenter(a.center,b)},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>this.limit+1){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b])}a=true;if(this.previousStack.length==0){this.initStack()}}}return a},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners){this.map.events.unregister(b,this,this.listeners[b])}if(this.clearOnDeactivate){this.clear()}a=true}}return a},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoomBarDiv:null,divEvents:null,zoomWorldIcon:false,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var b=new OpenLayers.Size(18,18);var c=new OpenLayers.Pixel(a.x+b.w/2,a.y);var d=b.w;if(this.zoomWorldIcon){c=new OpenLayers.Pixel(a.x+b.w,a.y)}this._addButton("panup","north-mini.png",c,b);a.y=c.y+b.h;this._addButton("panleft","west-mini.png",a,b);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",a.add(b.w,0),b);d*=2}this._addButton("panright","east-mini.png",a.add(d,0),b);this._addButton("pandown","south-mini.png",c.add(0,b.h*2),b);this._addButton("zoomin","zoom-plus-mini.png",c.add(0,b.h*3+5),b);c=this._addZoomBar(c.add(0,b.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",c,b);return this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImagesLocation();var c=this.id+"_"+this.map.id;var d=this.map.getNumZoomLevels()-1-this.map.getZoom();var e=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,d*this.zoomStopHeight),new OpenLayers.Size(20,9),b+"slider.png","absolute");this.slider=e;this.sliderEvents=new OpenLayers.Events(this,e,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var f=new OpenLayers.Size;f.h=this.zoomStopHeight*this.map.getNumZoomLevels();f.w=this.zoomStopWidth;var g=null;if(OpenLayers.Util.alphaHack()){var c=this.id+"_"+this.map.id;g=OpenLayers.Util.createAlphaImageDiv(c,a,new OpenLayers.Size(f.w,this.zoomStopHeight),b+"zoombar.png","absolute",null,"crop");g.style.height=f.h+"px"}else{g=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,f,b+"zoombar.png")}this.zoombarDiv=g;this.divEvents=new OpenLayers.Events(this,g,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(g);this.startTop=parseInt(g.style.top);this.div.appendChild(e);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}var b=a.xy.y;var c=OpenLayers.Util.pagePosition(a.object)[1];var d=(b-c)/this.zoomStopHeight;if(!this.map.fractionalZoom){d=Math.floor(d)}var e=this.map.getNumZoomLevels()-1-d;e=Math.min(Math.max(e,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(e);OpenLayers.Event.stop(a)},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a)},zoomBarDrag:function(a){if(this.mouseDragStart!=null){var b=this.mouseDragStart.y-a.xy.y;var c=OpenLayers.Util.pagePosition(this.zoombarDiv);if(a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-b;this.slider.style.top=d+"px";this.mouseDragStart=a.xy.clone()}OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.zoomStart.y-a.xy.y;var c=this.map.zoom;if(this.map.fractionalZoom){c+=b/this.zoomStopHeight;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)}else{c+=Math.round(b/this.zoomStopHeight)}this.map.zoomTo(c);this.moveZoomBar();this.mouseDragStart=null;OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,base:"",displayProjection:null,initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.element=OpenLayers.Util.getElement(a);this.base=b||document.location.href},destroy:function(){if(this.element.parentNode==this.div){this.div.removeChild(this.element)}this.element=null;this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d.CLASS_NAME==this.argParserClass.CLASS_NAME){if(d.displayProjection!=this.displayProjection){this.displayProjection=d.displayProjection}break}}if(b==this.map.controls.length){this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.className=this.displayClass;this.element=document.createElement("a");this.element.innerHTML=OpenLayers.i18n("permalink");this.element.href="";this.div.appendChild(this.element)}this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var a=this.base;if(a.indexOf("?")!=-1){a=a.substring(0,a.indexOf("?"))}a+="?"+OpenLayers.Util.getParameterString(this.createParams());this.element.href=a},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a){d.zoom=b||this.map.getZoom();var e=a.lat;var f=a.lon;if(this.displayProjection){var g=OpenLayers.Projection.transform({x:f,y:e},this.map.getProjectionObject(),this.displayProjection);f=g.x;e=g.y}d.lat=Math.round(e*1e5)/1e5;d.lon=Math.round(f*1e5)/1e5;c=c||this.map.layers;d.layers="";for(var h=0,i=c.length;h<i;h++){var j=c[h];if(j.isBaseLayer){d.layers+=j==this.map.baseLayer?"B":"0"}else{d.layers+=j.getVisibility()?"T":"F"}}}return d},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(a,b){if(b&&typeof b==="object"){for(var c in b){if(b.hasOwnProperty(c)){b[c]=walk(c,b[c])}}}return filter(a,b)}object=walk("",object)}if(this.keepData){this.data=object}return object}}catch(e){}return null},write:function(a,b){this.pretty=!!b;var c=null;var d=typeof a;if(this.serialize[d]){try{c=this.serialize[d].apply(this,[a])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}}return c},writeIndent:function(){var a=[];if(this.pretty){for(var b=0;b<this.level;++b){a.push(this.indent)}}return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(a==null){return"null"}if(a.constructor==Date){return this.serialize.date.apply(this,[a])}if(a.constructor==Array){return this.serialize.array.apply(this,[a])}var b=["{"];this.level+=1;var c,d,e;var f=false;for(c in a){if(a.hasOwnProperty(c)){d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]);e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]);if(d!=null&&e!=null){if(f){b.push(",")}b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e);f=true}}}this.level-=1;b.push(this.writeNewline(),this.writeIndent(),"}");return b.join("")},array:function(a){var b;var c=["["];this.level+=1;for(var d=0,e=a.length;d<e;++d){b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]);if(b!=null){if(d>0){c.push(",")}c.push(this.writeNewline(),this.writeIndent(),b)}}this.level-=1;c.push(this.writeNewline(),this.writeIndent(),"]");return c.join("")},string:function(a){var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(a)){return'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];if(d){return d}d=c.charCodeAt();return"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16)})+'"'}return'"'+a+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(a){return a<10?"0"+a:a}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b){throw"Unsupported WFST version: "+a.version}return new b(a)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=a.documentElement;var c=this.version||b.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==c){var d=OpenLayers.Format.WMSCapabilities["v"+c.replace(/\./g,"_")];if(!d){throw"Can't find a WMS capabilities parser for version "+c}var e=new d(this.options)}var f=e.read(a);f.version=c;return f},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");if(b>0){a=a.substring(b)}var c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;if(window.ActiveXObject&&!this.xmldom){b=new ActiveXObject("Microsoft.XMLDOM")}else{b=this.xmldom}b.loadXML(a);return b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;b.open("GET","data:"+"text/xml"+";charset=utf-8,"+encodeURIComponent(a),false);if(b.overrideMimeType){b.overrideMimeType("text/xml")}b.send(null);return b.responseXML});if(this.keepData){this.data=c}return c},write:function(a){var b;if(this.xmldom){b=a.xml}else{var c=new XMLSerializer;if(a.nodeType==1){var d=document.implementation.createDocument("","",null);if(d.importNode){a=d.importNode(a,true)}d.appendChild(a);b=c.serializeToString(d)}else{b=c.serializeToString(a)}}return b},createElementNS:function(a,b){var c;if(this.xmldom){if(typeof a=="string"){c=this.xmldom.createNode(1,b,a)}else{c=this.xmldom.createNode(1,b,"")}}else{c=document.createElementNS(a,b)}return c},createTextNode:function(a){var b;if(this.xmldom){b=this.xmldom.createTextNode(a)}else{b=document.createTextNode(a)}return b},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS){d=a.getElementsByTagNameNS(b,c)}else{var e=a.getElementsByTagName("*");var f,g;for(var h=0,i=e.length;h<i;++h){f=e[h];g=f.prefix?f.prefix+":"+c:c;if(c=="*"||g==f.nodeName){if(b=="*"||b==f.namespaceURI){d.push(f)}}}}return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS){d=a.getAttributeNodeNS(b,c)}else{var e=a.attributes;var f,g;for(var h=0,i=e.length;h<i;++h){f=e[h];if(f.namespaceURI==b){g=f.prefix?f.prefix+":"+c:c;if(g==f.nodeName){d=f;break}}}}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS){d=a.getAttributeNS(b,c)||""}else{var e=this.getAttributeNodeNS(a,b,c);if(e){d=e.nodeValue}}return d},getChildValue:function(a,b){var c=b||"";if(a){for(var d=a.firstChild;d;d=d.nextSibling){switch(d.nodeType){case 3:case 4:c+=d.nodeValue}}}return c},concatChildValues:function(a,b){var c="";var d=a.firstChild;var e;while(d){e=d.nodeValue;if(e){c+=e}d=d.nextSibling}if(c==""&&b!=undefined){c=b}return c},isSimpleContent:function(a){var b=true;for(var c=a.firstChild;c;c=c.nextSibling){if(c.nodeType===1){b=false;break}}return b},contentType:function(a){var b=false,c=false;var d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:c=true;break;case 8:break;default:b=true}if(c&&b){break}}if(c&&b){d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else if(c){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}else if(b){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},hasAttributeNS:function(a,b,c){var d=false;if(a.hasAttributeNS){d=a.hasAttributeNS(b,c)}else{d=!!this.getAttributeNodeNS(a,b,c)}return d},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS){a.setAttributeNS(b,c,d)}else{if(this.xmldom){if(b){var e=a.ownerDocument.createNode(2,c,b);e.nodeValue=d;a.setAttributeNode(e)}else{a.setAttribute(c,d)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];if(!c){var d=a.indexOf(":");c=this.namespaces[a.substring(0,d)]}if(!c){c=this.namespaces[this.defaultPrefix]}var e=this.createElementNS(c,a);if(b.attributes){this.setAttributes(e,b.attributes)}var f=b.value;if(f!=null){if(typeof f=="boolean"){f=String(f)}e.appendChild(this.createTextNode(f))}return e},setAttributes:function(a,b){var c,d;for(var e in b){if(b[e]!=null&&b[e].toString){c=b[e].toString();d=this.namespaces[e.substring(0,e.indexOf(":"))]||null;this.setAttributeNS(a,d,e,c)}}},readNode:function(a,b){if(!b){b={}}var c=this.readers[this.namespaceAlias[a.namespaceURI]];if(c){var d=a.localName||a.nodeName.split(":").pop();var e=c[d]||c["*"];if(e){e.apply(this,[a,b])}}return b},readChildNodes:function(a,b){if(!b){b={}}var c=a.childNodes;var d;for(var e=0,f=c.length;e<f;++e){d=c[e];if(d.nodeType==1){this.readNode(d,b)}}return b},writeNode:function(a,b,c){var d,e;var f=a.indexOf(":");if(f>0){d=a.substring(0,f);e=a.substring(f+1)}else{if(c){d=this.namespaceAlias[c.namespaceURI]}else{d=this.defaultPrefix}e=a}var g=this.writers[d][e].apply(this,[b]);if(c){c.appendChild(g)}return g},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){outer:for(var d=a;d;d=d.nextSibling){switch(d.nodeType){case 1:if((!b||b===(d.localName||d.nodeName.split(":").pop()))&&(!c||c===d.namespaceURI)){break outer}d=null;break outer;case 3:if(/^\s*$/.test(d.nodeValue)){break};case 4:case 6:case 12:case 10:case 11:d=null;break outer}}return d||null},lookupNamespaceURI:function(a,b){var c=null;if(a){if(a.lookupNamespaceURI){c=a.lookupNamespaceURI(b)}else{outer:switch(a.nodeType){case 1:if(a.namespaceURI!==null&&a.prefix===b){c=a.namespaceURI;break outer}var d=a.attributes.length;if(d){var e;for(var f=0;f<d;++f){e=a.attributes[f];if(e.prefix==="xmlns"&&e.name==="xmlns:"+b){c=e.value||null;break outer}else if(e.name==="xmlns"&&b===null){c=e.value||null;break outer}}}c=this.lookupNamespaceURI(a.parentNode,b);break outer;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break outer;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break outer;case 6:case 12:case 10:case 11:break outer;default:c=this.lookupNamespaceURI(a.parentNode,b);break outer}}}return c},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(a,b,c){OpenLayers.Util.extend(this,c);this.control=a;this.callbacks=b;if(a.map){this.setMap(a.map)}OpenLayers.Util.extend(this,c);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(this.keyMask==null){return true}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return b==this.keyMask},activate:function(){if(this.active){return false}var a=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,c=a.length;b<c;b++){if(this[a[b]]){this.register(a[b],this[a[b]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var a=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,c=a.length;b<c;b++){if(this[a[b]]){this.unregister(a[b],this[a[b]])}}this.active=false;return true},callback:function(a,b){if(a&&this.callbacks[a]){this.callbacks[a].apply(this.control,b)}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(a,b){if(arguments.length===1&&typeof a==="object"){b=a;a=b&&b.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,b);this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(a);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var c=this.div.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(c,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);c=this.div.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(c);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE["Popup"]-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var d=true;var e=document.getElementsByTagName("link");for(var f=0,g=e.length;f<g;++f){if(OpenLayers.Util.isEquivalentUrl(e.item(f).href,this.theme)){d=false;break}}if(d){var h=document.createElement("link");h.setAttribute("rel","stylesheet");h.setAttribute("type","text/css");h.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(h)}}this.layers=[];if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoom,new OpenLayers.Control.ArgParser,new OpenLayers.Control.Attribution]}else{this.controls=[]}}for(var f=0,g=this.controls.length;f<g;f++){this.addControlToMap(this.controls[f])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy)},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy()}this.controls=null}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null},setOptions:function(a){OpenLayers.Util.extend(this,a)},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d=typeof c.test=="function";var e=OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])});return e},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){var b=null;for(var c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+b*5)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;a<b;a++){var c=this.layers[a];this.setLayerZIndex(c,a)}},addLayer:function(a){for(var b=0,c=this.layers.length;b<c;b++){if(this.layers[b]==a){var d=OpenLayers.i18n("layerAlreadyAdded",{layerName:a.name});OpenLayers.Console.warn(d);return false}}if(this.allOverlays){a.isBaseLayer=false}this.events.triggerEvent("preaddlayer",{layer:a});a.div.className="olLayerDiv";a.div.style.overflow="";this.setLayerZIndex(a,this.layers.length);if(a.isFixed){this.viewPortDiv.appendChild(a.div)}else{this.layerContainerDiv.appendChild(a.div)}this.layers.push(a);a.setMap(this);if(a.isBaseLayer||this.allOverlays&&!this.baseLayer){if(this.baseLayer==null){this.setBaseLayer(a)}else{a.setVisibility(false)}}else{a.redraw()}this.events.triggerEvent("addlayer",{layer:a});a.afterAdd()},addLayers:function(a){for(var b=0,c=a.length;b<c;b++){this.addLayer(a[b])}},removeLayer:function(a,b){if(b==null){b=true}if(a.isFixed){this.viewPortDiv.removeChild(a.div)}else{this.layerContainerDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.layers,a);a.removeMap(this);a.map=null;if(this.baseLayer==a){this.baseLayer=null;if(b){for(var c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:a})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(b<0){b=0}else if(b>this.layers.length){b=this.layers.length}if(c!=b){this.layers.splice(c,1);this.layers.splice(b,0,a);for(var d=0,e=this.layers.length;d<e;d++){this.setLayerZIndex(this.layers[d],d)}this.events.triggerEvent("changelayer",{layer:a,property:"order"});if(this.allOverlays){if(b===0){this.setBaseLayer(a)}else if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){var b=null;if(this.baseLayer){b=this.baseLayer.getExtent()}if(a!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,a)!=-1){if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=a;this.viewRequestID++;if(!this.allOverlays){this.baseLayer.visibility=true}var c=this.getCenter();if(c!=null){var d=b?b.getCenterLonLat():c;var e=b?this.getZoomForExtent(b,true):this.getZoomForResolution(this.resolution,true);this.setCenter(d,e,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(a,b){this.controls.push(a);this.addControlToMap(a,b)},addControlToMap:function(a,b){a.outsideViewport=a.div!=null;if(this.displayProjection&&!a.displayProjection){a.displayProjection=this.displayProjection}a.setMap(this);var c=a.draw(b);if(c){if(!a.outsideViewport){c.style.zIndex=this.Z_INDEX_BASE["Control"]+this.controls.length;this.viewPortDiv.appendChild(c)}}},getControl:function(a){var b=null;for(var c=0,d=this.controls.length;c<d;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){if(a&&a==this.getControl(a.id)){if(a.div&&a.div.parentNode==this.viewPortDiv){this.viewPortDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.controls,a)}},addPopup:function(a,b){if(b){for(var c=this.popups.length-1;c>=0;--c){this.removePopup(this.popups[c])}}a.map=this;this.popups.push(a);var d=a.draw();if(d){d.style.zIndex=this.Z_INDEX_BASE["Popup"]+this.popups.length;this.layerContainerDiv.appendChild(d)}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div)}catch(b){}}a.map=null},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone()}return a},updateSize:function(){this.events.clearMouseCache();var a=this.getCurrentSize();var b=this.getSize();if(b==null){this.size=b=a}if(!a.equals(b)){this.size=a;for(var c=0,d=this.layers.length;c<d;c++){this.layers[c].onMapResize()}if(this.baseLayer!=null){var e=new OpenLayers.Pixel(a.w/2,a.h/2);var f=this.getLonLatFromViewPortPx(e);var g=this.getZoom();this.zoom=null;this.setCenter(this.getCenter(),g)}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){var b=OpenLayers.Element.getDimensions(this.div);a.w=b.width;a.h=b.height}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height)}return a},calculateBounds:function(a,b){var c=null;if(a==null){a=this.getCenter()}if(b==null){b=this.getResolution()}if(a!=null&&b!=null){var d=this.getSize();var e=d.w*b;var f=d.h*b;c=new OpenLayers.Bounds(a.lon-e/2,a.lat-f/2,a.lon+e/2,a.lat+f/2)}return c},getCenter:function(){var a=null;if(this.center){a=this.center.clone()}return a},getZoom:function(){return this.zoom},pan:function(a,b,c){c=OpenLayers.Util.applyDefaults(c,{animate:true,dragging:false});var d=this.getViewPortPxFromLonLat(this.getCenter());var e=d.add(a,b);if(!c.dragging||!e.equals(d)){var f=this.getLonLatFromViewPortPx(e);if(c.animate){this.panTo(f)}else{this.setCenter(f,null,c.dragging)}}},panTo:function(a){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(a)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)}var b=this.getCenter();if(a.lon==b.lon&&a.lat==b.lat){return}var c={lon:b.lon,lat:b.lat};var d={lon:a.lon,lat:a.lat};this.panTween.start(c,d,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(a){this.events.triggerEvent("movestart")},this),eachStep:OpenLayers.Function.bind(function(a){a=new OpenLayers.LonLat(a.lon,a.lat);this.moveTo(a,this.zoom,{dragging:true,noEvent:true})},this),done:OpenLayers.Function.bind(function(a){a=new OpenLayers.LonLat(a.lon,a.lat);this.moveTo(a,this.zoom,{noEvent:true});this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(a)}},setCenter:function(a,b,c,d){this.moveTo(a,b,{dragging:c,forceZoomChange:d,caller:"setCenter"})},moveTo:function(a,b,c){if(!c){c={}}var d=c.dragging;var e=c.forceZoomChange;var f=c.noEvent;if(this.panTween&&c.caller=="setCenter"){this.panTween.stop()}if(!this.center&&!this.isValidLonLat(a)){a=this.maxExtent.getCenterLonLat()}if(this.restrictedExtent!=null){if(a==null){a=this.getCenter()}if(b==null){b=this.getZoom()}var g=this.getResolutionForZoom(b);var h=this.calculateBounds(a,g);if(!this.restrictedExtent.containsBounds(h)){var i=this.restrictedExtent.getCenterLonLat();if(h.getWidth()>this.restrictedExtent.getWidth()){a=new OpenLayers.LonLat(i.lon,a.lat)}else if(h.left<this.restrictedExtent.left){a=a.add(this.restrictedExtent.left-h.left,0)}else if(h.right>this.restrictedExtent.right){a=a.add(this.restrictedExtent.right-h.right,0)}if(h.getHeight()>this.restrictedExtent.getHeight()){a=new OpenLayers.LonLat(a.lon,i.lat)}else if(h.bottom<this.restrictedExtent.bottom){a=a.add(0,this.restrictedExtent.bottom-h.bottom)}else if(h.top>this.restrictedExtent.top){a=a.add(0,this.restrictedExtent.top-h.top)}}}var j=e||this.isValidZoomLevel(b)&&b!=this.getZoom();var k=this.isValidLonLat(a)&&!a.equals(this.center);if(j||k||!d){if(!this.dragging&&!f){this.events.triggerEvent("movestart")}if(k){if(!j&&this.center){this.centerLayerContainer(a)}this.center=a.clone()}if(j||this.layerContainerOrigin==null){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}if(j){this.zoom=b;this.resolution=this.getResolutionForZoom(b);this.viewRequestID++}var l=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(l,j,d);if(d){this.baseLayer.events.triggerEvent("move")}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:j})}}l=this.baseLayer.getExtent();for(var m=0,n=this.layers.length;m<n;m++){var o=this.layers[m];if(o!==this.baseLayer&&!o.isBaseLayer){var p=o.calculateInRange();if(o.inRange!=p){o.inRange=p;if(!p){o.display(false)}this.events.triggerEvent("changelayer",{layer:o,property:"visibility"})}if(p&&o.visibility){o.moveTo(l,j,d);if(d){o.events.triggerEvent("move")}else{o.events.triggerEvent("moveend",{zoomChanged:j})}}}}if(j){for(var m=0,n=this.popups.length;m<n;m++){this.popups[m].updatePosition()}}this.events.triggerEvent("move");if(j){this.events.triggerEvent("zoomend")}}if(!d&&!f){this.events.triggerEvent("moveend")}this.dragging=!!d},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var c=this.getViewPortPxFromLonLat(a);if(b!=null&&c!=null){this.layerContainerDiv.style.left=Math.round(b.x-c.x)+"px";this.layerContainerDiv.style.top=Math.round(b.y-c.y)+"px"}},isValidZoomLevel:function(a){return a!=null&&a>=0&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=false;if(a!=null){var c=this.getMaxExtent();b=c.containsLonLat(a)}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection}return a},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution}return a},getMaxExtent:function(a){var b=null;if(a&&a.restricted&&this.restrictedExtent){b=this.restrictedExtent}else if(this.baseLayer!=null){b=this.baseLayer.maxExtent}return b},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels}return a},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent()}return a},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution()}return a},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units}return a},getScale:function(){var a=null;if(this.baseLayer!=null){var b=this.getResolution();var c=this.baseLayer.units;a=OpenLayers.Util.getScaleFromResolution(b,c)}return a},getZoomForExtent:function(a,b){var c=null;if(this.baseLayer!=null){c=this.baseLayer.getZoomForExtent(a,b)}return c},getResolutionForZoom:function(a){var b=null;if(this.baseLayer){b=this.baseLayer.getResolutionForZoom(a)}return b},getZoomForResolution:function(a,b){var c=null;if(this.baseLayer!=null){c=this.baseLayer.getZoomForResolution(a,b)}return c},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){var d=this.getMaxExtent();a=a.clone();while(a.right<a.left){a.right+=d.getWidth()}c=a.getCenterLonLat().wrapDateLine(d)}this.setCenter(c,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){var b=a?a.restricted:true;var c=this.getMaxExtent({restricted:b});this.zoomToExtent(c)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units);var d=this.getSize();var e=d.w*c;var f=d.h*c;var g=this.getCenter();var h=new OpenLayers.Bounds(g.lon-e/2,g.lat-f/2,g.lon+e/2,g.lat+f/2);this.zoomToExtent(h,b)},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getLonLatFromViewPortPx(a)}return b},getViewPortPxFromLonLat:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getViewPortPxFromLonLat(a)}return b},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){var b=this.getViewPortPxFromLonLat(a);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getViewPortPxFromLayerPx:function(a){var b=null;if(a!=null){var c=parseInt(this.layerContainerDiv.style.left);var d=parseInt(this.layerContainerDiv.style.top);b=a.add(c,d)}return b},getLayerPxFromViewPortPx:function(a){var b=null;if(a!=null){var c=-parseInt(this.layerContainerDiv.style.left);var d=-parseInt(this.layerContainerDiv.style.top);b=a.add(c,d);if(isNaN(b.x)||isNaN(b.y)){b=null}}return b},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){var b=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(b)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b?b:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=c}else{this.icon.url=c.url;this.icon.size=c.size;this.icon.offset=c.offset;this.icon.calculateOffset=c.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(a){return this.icon.draw(a)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(a){if(a!=null&&this.icon!=null){this.icon.moveTo(a)}this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=this.icon&&this.icon.isDrawn();return a},onScreen:function(){var a=false;if(this.map){var b=this.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},inflate:function(a){if(this.icon){var b=new OpenLayers.Size(this.icon.size.w*a,this.icon.size.h*a);this.icon.setSize(b)}},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var a=OpenLayers.Util.getImagesLocation()+"marker.png";var b=new OpenLayers.Size(21,25);var c=function(a){return new OpenLayers.Pixel(-(a.w/2),-a.h)};return new OpenLayers.Icon(a,b,null,c)};OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(676,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-638,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-638,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(600,660),initialize:function(a,b,c,d,e,f,g){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=OpenLayers.Util.applyDefaults(a,b);var c=new OpenLayers.Request.XMLHttpRequest;var d=a.url;if(a.params){var e=OpenLayers.Util.getParameterString(a.params);if(e.length>0){var f=d.indexOf("?")>-1?"&":"?";d+=f+e}}if(a.proxy&&d.indexOf("http")==0){d=a.proxy+encodeURIComponent(d)}c.open(a.method,d,a.async,a.user,a.password);for(var g in a.headers){c.setRequestHeader(g,a.headers[g])}var h=a.scope?OpenLayers.Function.bind(a.callback,a.scope):a.callback;var i;if(a.success){i=a.scope?OpenLayers.Function.bind(a.success,a.scope):a.success}var j;if(a.failure){j=a.scope?OpenLayers.Function.bind(a.failure,a.scope):a.failure}var k=this.events;c.onreadystatechange=function(){if(c.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var b=k.triggerEvent("complete",{request:c,config:a,requestUrl:d});if(b!==false){h(c);if(!c.status||c.status>=200&&c.status<300){k.triggerEvent("success",{request:c,config:a,requestUrl:d});if(i){i(c)}}if(c.status&&(c.status<200||c.status>=300)){k.triggerEvent("failure",{request:c,config:a,requestUrl:d});if(j){j(c)}}}}};if(a.async===false){c.send(a.data)}else{window.setTimeout(function(){c.send(a.data)},0)}return c},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a)}};OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(a,b,c,d,e){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=d;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0].id)}OpenLayers.Event.stopObservingElement(this.imgDiv.id);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null;this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}this.imgDiv=null;if(this.frame!=null&&this.frame.parentNode==this.layer.div){this.layer.div.removeChild(this.frame)}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else{if(this.backBufferTile){this.backBufferTile.clear()}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}}if(!a){return false}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;var b=a&&this.bounds.intersectsBounds(a,false);if(b){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.imageSize||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile()}this.backBufferTile.hide()}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv()}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage)}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice()}this.url=this.layer.getURL(this.bounds);this.positionImage()}return true},positionImage:function(){if(this.layer==null)return;OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var a=this.layer.getImageSize();if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url)}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}}},initImgDiv:function(){var a=this.layer.imageOffset;var b=this.layer.getImageSize();if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,a,b,null,"relative",null,null,null,true)}else{this.imgDiv=OpenLayers.Util.createImage(null,a,b,null,"relative",null,null,true)}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var c=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(c,this))}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(c,this))}var d=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){c.call(this)}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(d,this))},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide()}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return}var a=1;if(this.backBufferTile.resolution){a=this.backBufferTile.resolution/this.layer.getResolution()}if(a!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var b=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var c=new OpenLayers.Size(this.backBufferTile.size.w*a,this.backBufferTile.size.h*a);var d=this.layer.map.getLayerPxFromLonLat(b);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,d,c);var e=this.backBufferTile.imageSize;e=new OpenLayers.Size(e.w*a,e.h*a);var f=this.backBufferTile.imageOffset;if(f){f=new OpenLayers.Pixel(f.x*a,f.y*a)}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,f,e);this.backBufferTile.show()}}else{if(this.layer.singleTile){this.backBufferTile.show()}else{this.backBufferTile.hide()}}this.lastRatio=a},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft}}},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera";OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){if(!this.mapDiv){return}this.handlers.click.destroy();this.mapDiv.removeChild(this.extentRectangle);this.extentRectangle=null;this.rectEvents.destroy();this.rectEvents=null;this.ovmap.destroy();this.ovmap=null;this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){OpenLayers.Event.stopObservingElement(this.minimizeDiv);this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var a=this.map.baseLayer.clone();this.layers=[a]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1e3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImagesLocation();var c=b+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(18,18),c,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var c=b+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(18,18),c,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var d=["dblclick","mousedown"];for(var e=0,f=d.length;e<f;e++){OpenLayers.Event.observe(this.maximizeDiv,d[e],OpenLayers.Event.stop);OpenLayers.Event.observe(this.minimizeDiv,d[e],OpenLayers.Event.stop)}this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x;var c=this.handlers.drag.last.y-a.y;if(b!=0||c!=0){var d=this.rectPxBounds.top;var e=this.rectPxBounds.left;var f=Math.abs(this.rectPxBounds.getHeight());var g=this.rectPxBounds.getWidth();var h=Math.max(0,d-c);h=Math.min(h,this.ovmap.size.h-this.hComp-f);var i=Math.max(0,e-b);i=Math.min(i,this.ovmap.size.w-this.wComp-g);this.setRectPxBounds(new OpenLayers.Bounds(i,h+f,i+g,h))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel();var c=a.xy.x-b.x;var d=a.xy.y-b.y;var e=this.rectPxBounds.top;var f=this.rectPxBounds.left;var g=Math.abs(this.rectPxBounds.getHeight());var h=this.rectPxBounds.getWidth();var i=Math.max(0,e+d);i=Math.min(i,this.ovmap.size.h-g);var j=Math.max(0,f+c);j=Math.min(j,this.ovmap.size.w-h);this.setRectPxBounds(new OpenLayers.Bounds(j,i+g,j+h,i));this.updateMapToRect()},maximizeControl:function(a){this.element.style.display="";this.showToggle(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.element.style.display="none";this.showToggle(true);if(a!=null){OpenLayers.Event.stop(a)}},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":""},update:function(){if(this.ovmap==null){this.createMap()}if(this.autoPan||!this.isSuitableOverview()){this.updateOverview()}this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent();var b=this.map.maxExtent;var c=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));if(this.ovmap.getProjection()!=this.map.getProjection()){c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}var d=this.ovmap.getResolution()/this.map.getResolution();return d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var a=this.map.getResolution();var b=this.ovmap.getResolution();var c=b/a;if(c>this.maxRatio){b=this.minRatio*a}else if(c<=this.minRatio){b=this.maxRatio*a}var d;if(this.ovmap.getProjection()!=this.map.getProjection()){d=this.map.center.clone();d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{d=this.map.center}this.ovmap.setCenter(d,this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=this.wComp?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=this.hComp?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(a){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(a){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}});if(this.ovmap.getProjection()!=this.map.getProjection()){var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=b&&c?OpenLayers.INCHES_PER_UNIT[b]/OpenLayers.INCHES_PER_UNIT[c]:1}},updateRectToMap:function(){var a;if(this.ovmap.getProjection()!=this.map.getProjection()){a=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{a=this.map.getExtent()}var b=this.getRectBoundsFromMapBounds(a);if(b){this.setRectPxBounds(b)}},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection()){a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())}this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0);var c=Math.max(a.left,0);var d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp);var e=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp);var f=Math.max(e-c,0);var g=Math.max(d-b,0);if(f<this.minRectSize||g<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var h=c+f/2-this.minRectSize/2;var i=b+g/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(i)+"px";this.extentRectangle.style.left=Math.round(h)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(b)+"px";this.extentRectangle.style.left=Math.round(c)+"px";this.extentRectangle.style.height=Math.round(g)+"px";this.extentRectangle.style.width=Math.round(f)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(e),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=new OpenLayers.LonLat(a.left,a.bottom);var c=new OpenLayers.LonLat(a.right,a.top);var d=this.getOverviewPxFromLonLat(b);var e=this.getOverviewPxFromLonLat(c);var f=null;if(d&&e){f=new OpenLayers.Bounds(d.x,d.y,e.x,e.y)}return f},getMapBoundsFromRectBounds:function(a){var b=new OpenLayers.Pixel(a.left,a.bottom);var c=new OpenLayers.Pixel(a.right,a.top);var d=this.getLonLatFromOverviewPx(b);var e=this.getLonLatFromOverviewPx(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size;var c=this.ovmap.getResolution();var d=this.ovmap.getExtent().getCenterLonLat();var e=a.x-b.w/2;var f=a.y-b.h/2;return new OpenLayers.LonLat(d.lon+e*c,d.lat-f*c)},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution();var c=this.ovmap.getExtent();var d=null;if(c){d=new OpenLayers.Pixel(Math.round(1/b*(a.lon-c.left)),Math.round(1/b*(c.top-a.lat)))}return d},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(a,b,c){this.layer=a;this.lonlat=b;this.data=c!=null?c:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if(this.layer!=null&&this.layer.map!=null){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var a=false;if(this.layer!=null&&this.layer.map!=null){var b=this.layer.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){if(this.lonlat!=null){var b=this.id+"_popup";var c=this.marker?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(b,this.lonlat,this.data.popupSize,this.data.popupContentHTML,c,a)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.0",version:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=a.documentElement;var c=this.version;if(!c){c=b.getAttribute("version");if(!c){c=this.defaultVersion}}var d=OpenLayers.Format.WFSCapabilities["v"+c.replace(/\./g,"_")];if(!d){throw"Can't find a WFS capabilities parser for version "+c}var e=new d(this.options);var f=e.read(a);f.version=c;return f},CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},readers:{xsd:{schema:function(a,b){var c=[];var d={};var e={complexTypes:c,customTypes:d};this.readChildNodes(a,e);var f=a.attributes;var g,h;for(var i=0,j=f.length;i<j;++i){g=f[i];h=g.name;if(h.indexOf("xmlns")==0){this.setNamespace(h.split(":")[1]||"",g.value)}else{b[h]=g.value}}b.featureTypes=c;b.targetPrefix=this.namespaceAlias[b.targetNamespace];var k,l;for(var i=0,j=c.length;i<j;++i){k=c[i];l=d[k.typeName];if(d[k.typeName]){k.typeName=l.name}}},complexType:function(a,b){var c={typeName:a.getAttribute("name")};this.readChildNodes(a,c);b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c);b.properties=c.elements},element:function(a,b){if(b.elements){var c={};var d=a.attributes;var e;for(var f=0,g=d.length;f<g;++f){e=d[f];c[e.name]=e.value}var h=c.type;if(!h){h={};this.readChildNodes(a,h);c.restriction=h;c.type=h.base}var i=h.base||h;c.localType=i.split(":").pop();b.elements.push(c)}if(b.complexTypes){var h=a.getAttribute("type");var j=h.split(":").pop();b.customTypes[j]={name:a.getAttribute("name"),type:h}}},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base");this.readRestriction(a,b)}}},readRestriction:function(a,b){var c=a.childNodes;var d,e,f;for(var g=0,h=c.length;g<h;++g){d=c[g];if(d.nodeType==1){e=d.nodeName.split(":").pop();f=d.getAttribute("value");if(!b[e]){b[e]=f}else{if(typeof b[e]=="string"){b[e]=[b[e]]}b[e].push(f)}}}},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b={};this.readNode(a,b);return b},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(a){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;if(!c){if(a&&a.layer){c=a.layer.projection.getCode()}else{c=this.srsName}}return c},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b={};this.readNode(a,b);if(b.features){b=b.features}return b},readers:{wfs:{FeatureCollection:function(a,b){b.features=[];this.readChildNodes(a,b)}}},write:function(a){var b=this.writeNode("wfs:Transaction",a);var c=this.schemaLocationAttr();if(c){this.setAttributeNS(b,this.namespaces["xsi"],"xsi:schemaLocation",c)}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});this.writeNode("Query",a,b);return b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(a.featureNS?a.featurePrefix+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS){b.setAttribute("xmlns:"+a.featurePrefix,a.featureNS)}if(a.filter){this.setFilterProperty(a.filter);this.writeNode("ogc:Filter",a.filter,b)}return b},Transaction:function(a){var b=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});if(a){var c,d;for(var e=0,f=a.length;e<f;++e){d=a[e];c=this.stateName[d.state];if(c){this.writeNode(c,d,b)}}}return b},Insert:function(a){var b=this.createElementNSPlus("wfs:Insert");this.srsName=this.getSrsName(a);this.writeNode("feature:_typeName",a,b);return b},Update:function(a){var b=this.createElementNSPlus("wfs:Update",{attributes:{typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("Property",{name:this.geometryName,value:a},b);for(var c in a.attributes){this.writeNode("Property",{name:c,value:a.attributes[c]},b)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[a.fid]}),b);return b},Property:function(a){var b=this.createElementNSPlus("wfs:Property");this.writeNode("Name",a.name,b);this.writeNode("Value",a.value,b);return b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;if(a instanceof OpenLayers.Feature.Vector){b=this.createElementNSPlus("wfs:Value");this.srsName=this.getSrsName(a);var c=this.writeNode("feature:_geometry",a.geometry).firstChild;b.appendChild(c)}else{b=this.createElementNSPlus("wfs:Value",{value:a})}return b},Delete:function(a){var b=this.createElementNSPlus("wfs:Delete",{attributes:{typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[a.fid]}),b);return b}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);if(a.schema){b[a.featurePrefix]=a.schema}var c=[];var d;for(var e in b){d=this.namespaces[e];if(d){c.push(d+" "+b[e])}}var f=c.join(" ")||undefined;return f},setFilterProperty:function(a){if(a.filters){for(var b=0,c=a.filters.length;b<c;++b){this.setFilterProperty(a.filters[b])}}else{if(a instanceof OpenLayers.Filter.Spatial){a.property=this.geometryName}}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.WMC=OpenLayers.Class({defaultVersion:"1.1.0",version:null,layerOptions:null,layerParams:null,parser:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},read:function(a,b){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var c=a.documentElement;var d=this.version;if(!d){d=c.getAttribute("version");if(!d){d=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=d){var e=OpenLayers.Format.WMC["v"+d.replace(/\./g,"_")];if(!e){throw"Can't find a WMC parser for version "+d}this.parser=new e(this.options)}var f=this.parser.read(a,b);var g;if(b.map){this.context=f;if(b.map instanceof OpenLayers.Map){g=this.mergeContextToMap(f,b.map)}else{g=this.contextToMap(f,b.map)}}else{g=f}return g},contextToMap:function(a,b){var c=new OpenLayers.Map(b,{maxExtent:a.maxExtent,projection:a.projection});c.addLayers(a.layers);c.setCenter(a.bounds.getCenterLonLat(),c.getZoomForExtent(a.bounds,true));return c},mergeContextToMap:function(a,b){b.addLayers(a.layers);return b},write:function(a,b){if(a.CLASS_NAME=="OpenLayers.Map"){a=this.mapToContext(a)}var c=b&&b.version||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=c){var d=OpenLayers.Format.WMC["v"+c.replace(/\./g,"_")];if(!d){throw"Can't find a WMS capabilities parser for version "+c}this.parser=new d(this.options)}var e=this.parser.write(a,b);return e},mapToContext:function(a){var b={bounds:a.getExtent(),maxExtent:a.maxExtent,projection:a.projection,layers:a.layers,size:a.getSize()};return b},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.XML,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b={};var c=a.documentElement;this.runChildNodes(b,c);return b},runChildNodes:function(a,b){var c=b.childNodes;var d,e;for(var f=0;f<c.length;++f){d=c[f];if(d.nodeType==1){e=this["read_cap_"+d.nodeName];if(e){e.apply(this,[a,d])}}}},read_cap_Capability:function(a,b){var c={layers:[]};this.runChildNodes(c,b);a.capability=c},read_cap_Request:function(a,b){var c={};this.runChildNodes(c,b);a.request=c},read_cap_GetMap:function(a,b){var c={formats:[]};this.runChildNodes(c,b);a.getmap=c},read_cap_Format:function(a,b){if(a.formats){a.formats.push(this.getChildValue(b))}},read_cap_DCPType:function(a,b){var c=b.getElementsByTagName("OnlineResource");if(c.length>0){this.read_cap_OnlineResource(a,c[0])}},read_cap_Service:function(a,b){var c={};this.runChildNodes(c,b);a.service=c},read_cap_Layer:function(a,b,c){var d={formats:a.request.getmap.formats||[],styles:[],queryable:b.getAttribute("queryable")==="1"||b.getAttribute("queryable")==="true"};if(c){d.styles=d.styles.concat(c.styles);d.llbbox=c.llbbox;d.minScale=c.minScale;d.maxScale=c.maxScale}var e=b.childNodes;var f,g,h;for(var i=0;i<e.length;++i){f=e[i];g=f.nodeName;h=this["read_cap_"+f.nodeName];if(h){if(g=="Layer"){h.apply(this,[a,f,d])}else{h.apply(this,[d,f])}}}if(d.name){var j=d.name.indexOf(":");if(j>0){d.prefix=d.name.substring(0,j)}a.layers.push(d)}},read_cap_ScaleHint:function(a,b){var c=b.getAttribute("min");var d=b.getAttribute("max");var e=Math.pow(2,.5);var f=OpenLayers.INCHES_PER_UNIT["m"];a.maxScale=parseFloat((e*c*f*OpenLayers.DOTS_PER_INCH).toPrecision(13));a.minScale=parseFloat((e*d*f*OpenLayers.DOTS_PER_INCH).toPrecision(13))},read_cap_Name:function(a,b){var c=this.getChildValue(b);if(c){a.name=c}},read_cap_Title:function(a,b){var c=this.getChildValue(b);if(c){a.title=c}},read_cap_Abstract:function(a,b){var c=this.getChildValue(b);if(c){a["abstract"]=c}},read_cap_LatLonBoundingBox:function(a,b){a.llbbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))]},read_cap_Style:function(a,b){var c={};this.runChildNodes(c,b);a.styles.push(c)},read_cap_LegendURL:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height")};var d=b.getElementsByTagName("OnlineResource");if(d.length>0){this.read_cap_OnlineResource(c,d[0])}a.legend=c},read_cap_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,"http://www.w3.org/1999/xlink","href")},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=a.documentElement;var c=this.version;if(!c){c=b.getAttribute("version");if(!c){c=this.defaultVersion}}if(c=="1.1.1"||c=="1.1.0"){c="1.1"}var d=OpenLayers.Format.WMSDescribeLayer["v"+c.replace(/\./g,"_")];if(!d){throw"Can't find a WMS DescribeLayer parser for version "+c}var e=new d(this.options);var f=e.read(a);f.version=c;return f},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);OpenLayers.Util.extend(this,a);this.options=a},read:function(a){var b;if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var c=a.documentElement;if(c){var d=this;var e=this["read_"+c.nodeName];if(e){b=e.call(this,c)}else{b=(new OpenLayers.Format.GML(this.options?this.options:{})).read(a)}}else{b=a}return b},read_msGMLOutput:function(a){var b=[];var c=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier);if(c){for(var d=0,e=c.length;d<e;++d){var f=c[d];var g=f.nodeName;if(f.prefix){g=g.split(":")[1]}var g=g.replace(this.layerIdentifier,"");var h=this.getSiblingNodesByTagCriteria(f,this.featureIdentifier);if(h){for(var i=0;i<h.length;i++){var j=h[i];var k=this.parseGeometry(j);var l=this.parseAttributes(j);var m=new OpenLayers.Feature.Vector(k,l,null);m.type=g;b.push(m)}}}}return b},read_FeatureInfoResponse:function(a){var b=[];var c=this.getElementsByTagNameNS(a,"*","FIELDS");for(var d=0,e=c.length;d<e;d++){var f=c[d];var g=null;var h={};for(var i=0,j=f.attributes.length;i<j;i++){var k=f.attributes[i];h[k.nodeName]=k.nodeValue}b.push(new OpenLayers.Feature.Vector(g,h,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var c=[];var d,e,f,g,h;if(a&&a.hasChildNodes()){d=a.childNodes;f=d.length;for(var i=0;i<f;i++){h=d[i];while(h&&h.nodeType!=1){h=h.nextSibling;i++}e=h?h.nodeName:"";if(e.length>0&&e.indexOf(b)>-1){c.push(h)}else{g=this.getSiblingNodesByTagCriteria(h,b);if(g.length>0){c.length==0?c=g:c.push(g)}}}}return c},parseAttributes:function(a){var b={};if(a.nodeType==1){var c=a.childNodes;n=c.length;for(var d=0;d<n;++d){var e=c[d];if(e.nodeType==1){var f=e.childNodes;if(f.length==1){var g=f[0];if(g.nodeType==3||g.nodeType==4){var h=e.prefix?e.nodeName.split(":")[1]:e.nodeName;var i=g.nodeValue.replace(this.regExes.trimSpace,"");b[h]=i}}}}}return b},parseGeometry:function(a){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML}var b=this.gmlFormat.parseFeature(a);var c=null;if(b&&b.geometry){c=b.geometry.clone();b.destroy()}return c},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.pixelTolerance!=null){this.mousedown=function(a){this.down=a.xy;return true}}},mousedown:null,mouseup:function(a){var b=true;if(this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)){b=this.rightclick(a)}return b},rightclick:function(a){if(this.passesTolerance(a)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[a]);return!this.stopDouble}else{var b=this["double"]?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]);var c=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(c,this.delay)}}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a])}return!this.stopSingle},dblclick:function(a){if(this.passesTolerance(a)){if(this["double"]){this.callback("dblclick",[a])}this.clearTimer()}return!this.stopDouble},click:function(a){if(this.passesTolerance(a)){if(this.timerId!=null){this.clearTimer()}else{var b=this.single?OpenLayers.Util.extend({},a):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)}}return!this.stopSingle},passesTolerance:function(a){var b=true;if(this.pixelTolerance!=null&&this.down){var c=Math.sqrt(Math.pow(this.down.x-a.xy.x,2)+Math.pow(this.down.y-a.xy.y,2));if(c>this.pixelTolerance){b=false}}return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a])}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(a){var b=true;this.dragging=false;if(this.checkModifiers(a)&&OpenLayers.Event.isLeftClick(a)){this.started=true;this.start=a.xy;this.last=a.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(a);this.callback("down",[a.xy]);OpenLayers.Event.stop(a);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:function(){return true};document.onselectstart=function(){return false}}b=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return b},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=function(){return false}}this.last=this.evt.xy}return true},removeTimeout:function(){this.timeoutId=null},mouseup:function(a){if(this.started){var b=this.start!=this.last;this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(a);this.callback("up",[a.xy]);if(b){this.callback("done",[a.xy])}document.onselectstart=this.oldOnselectstart}return true},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,this.map.div)){var b=this.start!=this.last;this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(a);this.callback("out",[]);if(b){this.callback("done",[a.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}return true},click:function(a){return this.start==this.last},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return a},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]);this.layer=b},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true},click:function(a){return this.handle(a)?!this.stopClick:true},mousemove:function(a){if(!this.callbacks["over"]&&!this.callbacks["out"]){return true}this.handle(a);return true},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){if(this.feature&&!this.feature.layer){this.feature=null}var b=a.type;var c=false;var d=!!this.feature;var e=b=="click"||b=="dblclick";this.feature=this.layer.getFeatureFromEvent(a);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){var f=this.feature!=this.lastFeature;if(this.geometryTypeMatches(this.feature)){if(d&&f){if(this.lastFeature){this.triggerCallback(b,"out",[this.lastFeature])}this.triggerCallback(b,"in",[this.feature])}else if(!d||e){this.triggerCallback(b,"in",[this.feature])}this.lastFeature=this.feature;c=true}else{if(this.lastFeature&&(d&&f||e)){this.triggerCallback(b,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(d||e)){this.triggerCallback(b,"out",[this.lastFeature])}}return c},triggerCallback:function(a,b,c){var d=this.EVENTMAP[a][b];if(d){if(a=="click"&&this.up&&this.down){var e=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(e<=this.clickTolerance){this.callback(d,c)}}else{this.callback(d,c)}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},handleMapEvents:function(a){if(!a.property||a.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE["Feature"]-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE["Feature"]){this.layer.setZIndex(a)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}return!this.stopMove},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.div)){this.clearTimer();this.callback("move",[a])}return true},passesTolerance:function(a){var b=true;if(this.pixelTolerance&&this.px){var c=Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2));if(c<this.pixelTolerance){b=false}}return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true}return a},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var a=0,b=this.KEY_EVENTS.length;a<b;a++){OpenLayers.Event.observe(document,this.KEY_EVENTS[a],this.eventListener)}return true}else{return false}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,c=this.KEY_EVENTS.length;b<c;b++){OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[b],this.eventListener)}a=true}return a},handleKeyEvent:function(a){if(this.checkModifiers(a)){this.callback(a.type,[a])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(a){if(!this.map||!this.checkModifiers(a)){return}var b=false;var c=false;var d=false;var e=OpenLayers.Event.element(a);while(e!=null&&!d&&!b){if(!b){try{if(e.currentStyle){g=e.currentStyle["overflow"]}else{var f=document.defaultView.getComputedStyle(e,null);var g=f.getPropertyValue("overflow")}b=g&&g=="auto"||g=="scroll"}catch(h){}}if(!c){for(var i=0,j=this.map.layers.length;i<j;i++){if(e==this.map.layers[i].div||e==this.map.layers[i].pane){c=true;break}}}d=e==this.map.div;e=e.parentNode}if(!b&&d){if(c){this.wheelZoom(a)}OpenLayers.Event.stop(a)}},wheelZoom:function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){b=-b}}else if(a.detail){b=-a.detail/3}if(b){if(this.mousePosition){a.xy=this.mousePosition}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter())}if(b<0){this.callback("down",[a,b])}else{this.callback("up",[a,b])}}},mousemove:function(a){this.mousePosition=a.xy},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true}else{return false}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],initialize:function(a,b){this.addOptions(b);this.name=a;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true}},destroy:function(a){if(a==null){a=true}if(this.map!=null){this.map.removeLayer(this,a)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.options)}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(a){if(this.options==null){this.options={}}OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},onMapResize:function(){},redraw:function(){var a=false;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();if(b&&this.inRange&&this.visibility){var c=true;this.moveTo(b,c,false);this.events.triggerEvent("moveend",{zoomChanged:c});a=true}}return a},moveTo:function(a,b,c){var d=this.visibility;if(!this.isBaseLayer){d=d&&this.inRange}this.display(d)},setMap:function(a){if(this.map==null){this.map=a;this.maxExtent=this.maxExtent||this.map.maxExtent;this.projection=this.projection||this.map.projection;if(this.projection&&typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var b=this.visibility&&this.inRange;this.div.style.display=b?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(a){var b=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=b;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter)}},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(a){var b=this.calculateInRange();if(a!=(this.div.style.display!="none")){this.div.style.display=a&&b?"block":"none"}},calculateInRange:function(){var a=false;if(this.alwaysInRange){a=true}else{if(this.map){var b=this.map.getResolution();a=b>=this.minResolution&&b<=this.maxResolution}}return a},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var a=new Array("projection","units","scales","resolutions","maxScale","minScale","maxResolution","minResolution","minExtent","maxExtent","numZoomLevels","maxZoomLevel");var b=["projection","units"];var c=false;var d={};for(var e=0,f=a.length;e<f;e++){var g=a[e];if(this.options[g]&&OpenLayers.Util.indexOf(b,g)==-1){c=true}d[g]=this.options[g]||this.map[g]}if(this.alwaysInRange==null){this.alwaysInRange=!c}if((this.options.minScale!=null||this.options.maxScale!=null)&&this.options.scales==null){d.scales=null}if((this.options.minResolution!=null||this.options.maxResolution!=null)&&this.options.resolutions==null){d.resolutions=null}if(!d.numZoomLevels&&d.maxZoomLevel){d.numZoomLevels=d.maxZoomLevel+1}if(d.scales!=null||d.resolutions!=null){if(d.scales!=null){d.resolutions=[];for(var e=0,f=d.scales.length;e<f;e++){var h=d.scales[e];d.resolutions[e]=OpenLayers.Util.getResolutionFromScale(h,d.units)}}d.numZoomLevels=d.resolutions.length}else{if(d.minScale){d.maxResolution=OpenLayers.Util.getResolutionFromScale(d.minScale,d.units)}else if(d.maxResolution=="auto"){var i=this.map.getSize();var j=d.maxExtent.getWidth()/i.w;var k=d.maxExtent.getHeight()/i.h;d.maxResolution=Math.max(j,k)}if(d.maxScale!=null){d.minResolution=OpenLayers.Util.getResolutionFromScale(d.maxScale,d.units)}else if(d.minResolution=="auto"&&d.minExtent!=null){var i=this.map.getSize();var j=d.minExtent.getWidth()/i.w;var k=d.minExtent.getHeight()/i.h;d.minResolution=Math.max(j,k)}if(d.minResolution!=null&&this.options.numZoomLevels==undefined){var l=d.maxResolution/d.minResolution;d.numZoomLevels=Math.floor(Math.log(l)/Math.log(2))+1}d.resolutions=new Array(d.numZoomLevels);var m=2;if(typeof d.minResolution=="number"&&d.numZoomLevels>1){m=Math.pow(d.maxResolution/d.minResolution,1/(d.numZoomLevels-1))}for(var e=0;e<d.numZoomLevels;e++){var n=d.maxResolution/Math.pow(m,e);d.resolutions[e]=n}}d.resolutions.sort(function(a,b){return b-a});this.resolutions=d.resolutions;this.maxResolution=d.resolutions[0];var o=d.resolutions.length-1;this.minResolution=d.resolutions[o];this.scales=[];for(var e=0,f=d.resolutions.length;e<f;e++){this.scales[e]=OpenLayers.Util.getScaleFromResolution(d.resolutions[e],d.units)}this.minScale=this.scales[0];this.maxScale=this.scales[this.scales.length-1];this.numZoomLevels=d.numZoomLevels},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize();var d=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(d,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var c=Math.floor(a);var d=Math.ceil(a);b=this.resolutions[c]-(a-c)*(this.resolutions[c]-this.resolutions[d])}else{b=this.resolutions[Math.round(a)]}return b},getZoomForResolution:function(a,b){var c;if(this.map.fractionalZoom){var d=0;var e=this.resolutions.length-1;var f=this.resolutions[d];var g=this.resolutions[e];var h;for(var i=0,j=this.resolutions.length;i<j;++i){h=this.resolutions[i];if(h>=a){f=h;d=i}if(h<=a){g=h;e=i;break}}var k=f-g;if(k>0){c=d+(f-a)/k}else{c=d}}else{var l;var m=Number.POSITIVE_INFINITY;for(var i=0,j=this.resolutions.length;i<j;i++){if(b){l=Math.abs(this.resolutions[i]-a);if(l>m){break}m=l}else{if(this.resolutions[i]<a){break}}}c=Math.max(0,i-1)}return c},getLonLatFromViewPortPx:function(a){var b=null;if(a!=null){var c=this.map.getSize();var d=this.map.getCenter();if(d){var e=this.map.getResolution();var f=a.x-c.w/2;var g=a.y-c.h/2;b=new OpenLayers.LonLat(d.lon+f*e,d.lat-g*e);if(this.wrapDateLine){b=b.wrapDateLine(this.maxExtent)}}}return b},getViewPortPxFromLonLat:function(a){var b=null;if(a!=null){var c=this.map.getResolution();var d=this.map.getExtent();b=new OpenLayers.Pixel(1/c*(a.lon-d.left),1/c*(d.top-a.lat))}return b},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=0,c=this.div.childNodes.length;b<c;++b){var d=this.div.childNodes[b].firstChild;OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,a)}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,c)}return a},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,b,c){this.bounds=a;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div,null);this.setBorder(b,c)},destroy:function(){this.bounds=null;this.div=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){if(!a){a="red"}if(!b){b=2}this.div.style.border=b+"px solid "+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,null,a,b);return this.div},onScreen:function(){var a=false;if(this.map){var b=this.map.getExtent();a=b.containsBounds(this.bounds,true,true)}return a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});(function(){function h(a){a._object.onreadystatechange=new window.Function;delete a._headers}function g(a){try{a.responseText=a._object.responseText}catch(b){}try{a.responseXML=f(a._object)}catch(b){}try{a.status=a._object.status}catch(b){}try{a.statusText=a._object.statusText}catch(b){}}function f(a){var b=a.responseXML;if(c&&b&&!b.documentElement&&a.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(a.responseText)}if(b)if(c&&b.parseError!=0||b.documentElement&&b.documentElement.tagName=="parsererror")return null;return b}function e(a){if(a.onreadystatechange)a.onreadystatechange.apply(a);if(d.onreadystatechange)d.onreadystatechange.apply(a)}function d(){this._object=a?new a:new window.ActiveXObject("Microsoft.XMLHTTP")}var a=window.XMLHttpRequest;var b=!!window.controllers,c=window.document.all&&!window.opera;if(b&&a.wrapped)d.wrapped=a.wrapped;d.UNSENT=0;d.OPENED=1;d.HEADERS_RECEIVED=2;d.LOADING=3;d.DONE=4;d.prototype.readyState=d.UNSENT;d.prototype.responseText="";d.prototype.responseXML=null;d.prototype.status=0;d.prototype.statusText="";d.prototype.onreadystatechange=null;d.onreadystatechange=null;d.onopen=null;d.onsend=null;d.onabort=null;d.prototype.open=function(a,f,i,j,k){this._async=i;var l=this,m=this.readyState;if(c){var n=function(){if(l._object.readyState!=d.DONE)h(l)};if(i)window.attachEvent("onunload",n)}this._object.onreadystatechange=function(){if(b&&!i)return;l.readyState=l._object.readyState;g(l);if(l._aborted){l.readyState=d.UNSENT;return}if(l.readyState==d.DONE){h(l);if(c&&i)window.detachEvent("onunload",n)}if(m!=l.readyState)e(l);m=l.readyState};if(d.onopen)d.onopen.apply(this,arguments);this._object.open(a,f,i,j,k);if(!i&&b){this.readyState=d.OPENED;e(this)}};d.prototype.send=function(a){if(d.onsend)d.onsend.apply(this,arguments);if(a&&a.nodeType){a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml;if(!this._headers["Content-Type"])this._object.setRequestHeader("Content-Type","application/xml")}this._object.send(a);if(b&&!this._async){this.readyState=d.OPENED;g(this);while(this.readyState<d.DONE){this.readyState++;e(this);if(this._aborted)return}}};d.prototype.abort=function(){if(d.onabort)d.onabort.apply(this,arguments);if(this.readyState>d.UNSENT)this._aborted=true;this._object.abort();h(this)};d.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};d.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)};d.prototype.setRequestHeader=function(a,b){if(!this._headers)this._headers={};this._headers[a]=b;return this._object.setRequestHeader(a,b)};d.prototype.toString=function(){return"["+"object"+" "+"XMLHttpRequest"+"]"};d.toString=function(){return"["+"XMLHttpRequest"+"]"};if(!window.Function.prototype.apply){window.Function.prototype.apply=function(a,b){if(!b)b=[];a.__func=this;a.__func(b[0],b[1],b[2],b[3],b[4]);delete a.__func}}OpenLayers.Request.XMLHttpRequest=d})();OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}))};OpenLayers.loadURL=function(a,b,c,d,e){if(typeof b=="string"){b=OpenLayers.Util.getParameters(b)}var f=d?d:OpenLayers.nullHandler;var g=e?e:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:a,params:b,success:f,failure:g,scope:c})};OpenLayers.parseXMLString=function(a){var b=a.indexOf("<");if(b>0){a=a.substring(b)}var c=OpenLayers.Util.Try(function(){var b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(a);return b},function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;b.open("GET","data:"+"text/xml"+";charset=utf-8,"+encodeURIComponent(a),false);if(b.overrideMimeType){b.overrideMimeType("text/xml")}b.send(null);return b.responseXML});return c};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(a){for(var b=0;b<this.responders.length;b++){if(a==this.responders[b]){return}}this.responders.push(a)},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a)},dispatch:function(a,b,c){var d;for(var e=0;e<this.responders.length;e++){d=this.responders[e];if(d[a]&&typeof d[a]=="function"){try{d[a].apply(d,[b,c])}catch(f){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(a,b){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[b]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(a,"http")){a=OpenLayers.ProxyHost+encodeURIComponent(a)}this.transport=OpenLayers.Ajax.getTransport();this.request(a)},request:function(a){this.url=a;this.method=this.options.method;var b=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){b["_method"]=this.method;this.method="post"}this.parameters=b;if(b=OpenLayers.Util.getParameterString(b)){if(this.method=="get"){this.url+=(this.url.indexOf("?")>-1?"&":"?")+b}else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){b+="&_="}}try{var c=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(c)}OpenLayers.Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||b:null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(d){this.dispatchException(d)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!(a==4&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};if(this.method=="post"){a["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){a["Connection"]="close"}}if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(typeof b.push=="function"){for(var c=0,d=b.length;c<d;c+=2){a[b[c]]=b[c+1]}}else{for(var c in b){a[c]=b[c]}}}for(var e in a){this.transport.setRequestHeader(e,a[e])}},success:function(){var a=this.getStatus();return!a||a>=200&&a<300},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var b=OpenLayers.Ajax.Request.Events[a];var c=new OpenLayers.Ajax.Response(this);if(b=="Complete"){try{this._complete=true;(this.options["on"+c.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(c)}catch(d){this.dispatchException(d)}var e=c.getHeader("Content-type")}try{(this.options["on"+b]||OpenLayers.Ajax.emptyFunction)(c);OpenLayers.Ajax.Responders.dispatch("on"+b,this,c)}catch(d){this.dispatchException(d)}if(b=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction}},getHeader:function(a){try{return this.transport.getResponseHeader(a)}catch(b){return null}},dispatchException:function(a){var b=this.options.onException;if(b){b(this,a);OpenLayers.Ajax.Responders.dispatch("onException",this,a)}else{var c=false;var d=OpenLayers.Ajax.Responders.responders;for(var e=0;e<d.length;e++){if(d[e].onException){c=true;break}}if(c){OpenLayers.Ajax.Responders.dispatch("onException",this,a)}else{throw a}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(a){this.request=a;var b=this.transport=a.transport,c=this.readyState=b.readyState;if(c>2&&!!!(window.attachEvent&&!window.opera)||c==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=b.responseText==null?"":String(b.responseText)}if(c==4){var d=b.responseXML;this.responseXML=d===undefined?null:d}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a)}});OpenLayers.Ajax.getElementsByTagNameNS=function(a,b,c,d){var e=null;if(a.getElementsByTagNameNS){e=a.getElementsByTagNameNS(b,d)}else{e=a.getElementsByTagName(c+":"+d)}return e};OpenLayers.Ajax.serializeXMLToString=function(a){var b=new XMLSerializer;var c=b.serializeToString(a);return c};OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(a,b){},onDrag:function(a,b){},onComplete:function(a,b){},layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks)),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){if(!this.handlers.drag.dragging){this.feature=a;this.handlers.drag.activate();this.over=true;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over")}else{if(this.feature.id==a.id){this.over=true}else{this.over=false}}},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.feature=null}else{if(this.feature.id==a.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval})},panMap:function(a){this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false})},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{slideFactor:75,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress});this.activate()},defaultKeyPress:function(a){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var b=this.map.getSize();this.map.pan(0,-.75*b.h);break;case 34:var b=this.map.getSize();this.map.pan(0,.75*b.h);break;case 35:var b=this.map.getSize();this.map.pan(.75*b.w,0);break;case 36:var b=this.map.getSize();this.map.pan(-.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,maxFeatures:10,layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{this.handler=new OpenLayers.Handler.Click(this,{click:this.getInfoForClick},this.handlerOptions.click||{})}},activate:function(){if(!this.active){this.handler.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(a){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var a=[];var b=this.layers||this.map.layers;var c,d;for(var e=0,f=b.length;e<f;++e){c=b[e];if(c instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||c.getVisibility())){d=c.url instanceof Array?c.url[0]:c.url;if(!this.url){this.url=d}if(this.urlMatches(d)){a.push(c)}}}return a},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls){for(var c=0,d=this.layerUrls.length;c<d;++c){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=true;break}}}return b},request:function(a,b){b=b||{};var c=[];var d=[];var e=this.findLayers();if(e.length>0){for(var f=0,g=e.length;f<g;f++){c=c.concat(e[f].params.LAYERS);if(e[f].params.STYLES){d=d.concat(e[f].params.STYLES)}else{if(e[f].params.LAYERS instanceof Array){d=d.concat(new Array(e[f].params.LAYERS.length))}else{d=d.concat(e[f].params.LAYERS.replace(/[^,]/g,""))}}}var h={url:this.url,params:OpenLayers.Util.applyDefaults({service:"WMS",version:"1.1.0",request:"GetFeatureInfo",layers:c,query_layers:c,styles:d,bbox:this.map.getExtent().toBBOX(),srs:this.map.getProjection(),feature_count:this.maxFeatures,x:a.x,y:a.y,height:this.map.getSize().h,width:this.map.getSize().w,info_format:this.infoFormat},this.vendorParams),callback:function(b){this.handleResponse(a,b)},scope:this};var i=OpenLayers.Request.GET(h);if(b.hover===true){this.hoverRequest=i.priv}}else{OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(a,b){var c=b.responseXML;if(!c||!c.documentElement){c=b.responseText}var d=this.format.read(c);this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:d,request:b,xy:a});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},setMap:function(a){this.handler.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,renderIntent:"default",initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=a?a:null;this.state=null;this.attributes={};if(b){this.attributes=OpenLayers.Util.extend(this.attributes,b)}this.style=c?c:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=false;if(this.layer&&this.layer.map){var c=this.layer.map.getExtent();if(a){var d=this.geometry.getBounds();b=c.intersectsBounds(d)}else{var e=c.toGeometry();b=e.intersects(this.geometry)}}return b},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=false;if(this.geometry){d=this.geometry.atPoint(a,b,c)}return d},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move){return}var b;if(a.CLASS_NAME=="OpenLayers.LonLat"){b=this.layer.getViewPortPxFromLonLat(a)}else{b=a}var c=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var d=this.layer.map.getResolution();this.geometry.move(d*(b.x-c.x),d*(c.y-b.y));this.layer.drawFeature(this);return c},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break}}else if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;break}}else if(a==OpenLayers.State.UNKNOWN){this.state=a}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(a,b){var c=arguments;var d=this.processXMLNode(b);c=new Array(a,d.lonlat,d);OpenLayers.Feature.prototype.initialize.apply(this,c);this.createMarker();this.layer.addMarker(this.marker)},destroy:function(){if(this.marker!=null){this.layer.removeMarker(this.marker)}OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(a){var b=OpenLayers.Ajax.getElementsByTagNameNS(a,"http://www.opengis.net/gml","gml","Point");var c=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(b[0],"http://www.opengis.net/gml","gml","coordinates")[0]);var d=c.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(d[0]),parseFloat(d[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.WFSCapabilities,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b={};var c=a.documentElement;this.runChildNodes(b,c);return b},runChildNodes:function(a,b){var c=b.childNodes;var d,e;for(var f=0;f<c.length;++f){d=c[f];if(d.nodeType==1){e=this["read_cap_"+d.nodeName];if(e){e.apply(this,[a,d])}}}},read_cap_FeatureTypeList:function(a,b){var c={featureTypes:[]};this.runChildNodes(c,b);a.featureTypeList=c},read_cap_FeatureType:function(a,b,c){var d={};this.runChildNodes(d,b);a.featureTypes.push(d)},read_cap_Name:function(a,b){var c=this.getChildValue(b);if(c){a.name=c}},read_cap_Title:function(a,b){var c=this.getChildValue(b);if(c){a.title=c}},read_cap_Abstract:function(a,b){var c=this.getChildValue(b);if(c){a["abstract"]=c}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(a==null){b=this.namespaces[this.defaultPrefix]}else{for(b in this.namespaces){if(this.namespaces[b]==a){break}}}return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=a.documentElement;this.rootPrefix=b.prefix;var c={version:b.getAttribute("version")};this.runChildNodes(c,b);return c},runChildNodes:function(a,b){var c=b.childNodes;var d,e,f,g;for(var h=0,i=c.length;h<i;++h){d=c[h];if(d.nodeType==1){f=this.getNamespacePrefix(d.namespaceURI);g=d.nodeName.split(":").pop();e=this["read_"+f+"_"+g];if(e){e.apply(this,[a,d])}}}},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")))},read_wmc_LayerList:function(a,b){a.layers=[];this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={params:this.layerParams||{},options:{visibility:b.getAttribute("hidden")!="1",queryable:b.getAttribute("queryable")=="1"},formats:[],styles:[]};this.runChildNodes(c,b);c.params.layers=c.name;c.options.maxExtent=c.maxExtent;var d=this.getLayerFromInfo(c);a.layers.push(d)},getLayerFromInfo:function(a){var b=a.options;if(this.layerOptions){OpenLayers.Util.applyDefaults(b,this.layerOptions)}var c=new OpenLayers.Layer.WMS(a.title,a.href,a.params,b);return c},read_wmc_Extension:function(a,b){this.runChildNodes(a,b)},read_ol_units:function(a,b){a.options.units=this.getChildValue(b)},read_ol_maxExtent:function(a,b){var c=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));a.maxExtent=c},read_ol_transparent:function(a,b){a.params.transparent=this.getChildValue(b)},read_ol_numZoomLevels:function(a,b){a.options.numZoomLevels=parseInt(this.getChildValue(b))},read_ol_opacity:function(a,b){a.options.opacity=parseFloat(this.getChildValue(b))},read_ol_singleTile:function(a,b){a.options.singleTile=this.getChildValue(b)=="true"},read_ol_isBaseLayer:function(a,b){a.options.isBaseLayer=this.getChildValue(b)=="true"},read_ol_displayInLayerSwitcher:function(a,b){a.options.displayInLayerSwitcher=this.getChildValue(b)=="true"},read_wmc_Server:function(a,b){a.params.version=b.getAttribute("version");this.runChildNodes(a,b)},read_wmc_FormatList:function(a,b){this.runChildNodes(a,b)},read_wmc_Format:function(a,b){var c=this.getChildValue(b);a.formats.push(c);if(b.getAttribute("current")=="1"){a.params.format=c}},read_wmc_StyleList:function(a,b){this.runChildNodes(a,b)},read_wmc_Style:function(a,b){var c={};this.runChildNodes(c,b);if(b.getAttribute("current")=="1"){if(c.href){a.params.sld=c.href}else if(c.body){a.params.sld_body=c.body}else{a.params.styles=c.name}}a.styles.push(c)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_wmc_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,this.namespaces.xlink,"href")},read_wmc_Name:function(a,b){var c=this.getChildValue(b);if(c){a.name=c}},read_wmc_Title:function(a,b){var c=this.getChildValue(b);if(c){a.title=c}},read_wmc_MetadataURL:function(a,b){var c={};var d=b.getElementsByTagName("OnlineResource");if(d.length>0){this.read_wmc_OnlineResource(c,d[0])}a.options.metadataURL=c.href},read_wmc_Abstract:function(a,b){var c=this.getChildValue(b);if(c){a["abstract"]=c}},read_wmc_LatLonBoundingBox:function(a,b){a.llbbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))]},read_wmc_LegendURL:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height")};var d=b.getElementsByTagName("OnlineResource");if(d.length>0){this.read_wmc_OnlineResource(c,d[0])}a.legend=c},write:function(a,b){var c=this.createElementDefaultNS("ViewContext");this.setAttributes(c,{version:this.VERSION,id:b&&typeof b.id=="string"?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);c.appendChild(this.write_wmc_General(a));c.appendChild(this.write_wmc_LayerList(a));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createElementDefaultNS:function(a,b,c){var d=this.createElementNS(this.namespaces[this.defaultPrefix],a);if(b){d.appendChild(this.createTextNode(b))}if(c){this.setAttributes(d,c)}return d},setAttributes:function(a,b){var c;for(var d in b){c=b[d].toString();if(c.match(/[A-Z]/)){this.setAttributeNS(a,null,d,c)}else{a.setAttribute(d,c)}}},write_wmc_General:function(a){var b=this.createElementDefaultNS("General");if(a.size){b.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}))}var c=a.bounds;b.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:c.left.toPrecision(10),miny:c.bottom.toPrecision(10),maxx:c.right.toPrecision(10),maxy:c.top.toPrecision(10),SRS:a.projection}));b.appendChild(this.createElementDefaultNS("Title",a.title));b.appendChild(this.write_ol_MapExtension(a));return b},write_ol_MapExtension:function(a){var b=this.createElementDefaultNS("Extension");var c=a.maxExtent;if(c){var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:c.left.toPrecision(10),miny:c.bottom.toPrecision(10),maxx:c.right.toPrecision(10),maxy:c.top.toPrecision(10)});b.appendChild(d)}return b},write_wmc_LayerList:function(a){var b=this.createElementDefaultNS("LayerList");var c;for(var d=0,e=a.layers.length;d<e;++d){c=a.layers[d];if(c instanceof OpenLayers.Layer.WMS){b.appendChild(this.write_wmc_Layer(c))}}return b},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.params["LAYERS"]));b.appendChild(this.createElementDefaultNS("Title",a.name));if(a.metadataURL){b.appendChild(this.write_wmc_MetadataURL(a))}b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));b.appendChild(this.write_wmc_LayerExtension(a));return b},write_wmc_LayerExtension:function(a){var b=this.createElementDefaultNS("Extension");var c=a.maxExtent;var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:c.left.toPrecision(10),miny:c.bottom.toPrecision(10),maxx:c.right.toPrecision(10),maxy:c.top.toPrecision(10)});b.appendChild(d);var e=a.params["TRANSPARENT"];if(e){var f=this.createElementNS(this.namespaces.ol,"ol:transparent");f.appendChild(this.createTextNode(e));b.appendChild(f)}var g=["numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var h;for(var i=0,j=g.length;i<j;++i){h=this.createOLPropertyNode(a,g[i]);if(h){b.appendChild(h)}}return b},createOLPropertyNode:function(a,b){var c=null;if(a[b]!=null){c=this.createElementNS(this.namespaces.ol,"ol:"+b);c.appendChild(this.createTextNode(a[b].toString()))}return c},write_wmc_Server:function(a){var b=this.createElementDefaultNS("Server");this.setAttributes(b,{service:"OGC:WMS",version:a.params["VERSION"]});b.appendChild(this.write_wmc_OnlineResource(a.url));return b},write_wmc_MetadataURL:function(a){var b=this.createElementDefaultNS("MetadataURL");b.appendChild(this.write_wmc_OnlineResource(a.metadataURL));return b},write_wmc_FormatList:function(a){var b=this.createElementDefaultNS("FormatList");b.appendChild(this.createElementDefaultNS("Format",a.params["FORMAT"],{current:"1"}));return b},write_wmc_StyleList:function(a){var b=this.createElementDefaultNS("StyleList");var c=this.createElementDefaultNS("Style",null,{current:"1"});if(a.params["SLD"]){var d=this.createElementDefaultNS("SLD");var e=this.write_wmc_OnlineResource(a.params["SLD"]);d.appendChild(e);c.appendChild(d)}else if(a.params["SLD_BODY"]){var d=this.createElementDefaultNS("SLD");var f=a.params["SLD_BODY"];var g=OpenLayers.Format.XML.prototype.read.apply(this,[f]);var h=g.documentElement;if(d.ownerDocument&&d.ownerDocument.importNode){h=d.ownerDocument.importNode(h,true)}d.appendChild(h);c.appendChild(d)}else{var i=a.params["STYLES"]?a.params["STYLES"]:this.defaultStyleName;c.appendChild(this.createElementDefaultNS("Name",i));c.appendChild(this.createElementDefaultNS("Title",this.defaultStyleTitle))}b.appendChild(c);return b},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=a.documentElement;var c=b.childNodes;var d=[];for(var e=0;e<c.length;++e){childNode=c[e];nodeName=childNode.nodeName;if(nodeName=="LayerDescription"){var f="";var g="";var h="";if(childNode.getAttribute("owsType")){f=childNode.getAttribute("owsType");g=childNode.getAttribute("owsURL")}else{if(childNode.getAttribute("wfs")!=""){f="WFS";g=childNode.getAttribute("wfs")}else if(childNode.getAttribute("wcs")!=""){f="WCS";g=childNode.getAttribute("wcs")}}query=childNode.getElementsByTagName("Query");if(query.length>0){h=query[0].getAttribute("typeName");if(!h){h=query[0].getAttribute("typename")}}d.push({owsType:f,owsURL:g,typeName:h})}}return d},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var b={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,b,{keyMask:this.keyMask})},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a)}},startBox:function(a){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE["Popup"]-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x;var c=this.dragHandler.start.y;var d=Math.abs(b-a.x);var e=Math.abs(c-a.y);this.zoomBox.style.width=Math.max(1,d)+"px";this.zoomBox.style.height=Math.max(1,e)+"px";this.zoomBox.style.left=a.x<b?a.x+"px":b+"px";this.zoomBox.style.top=a.y<c?a.y+"px":c+"px";var f=this.getBoxCharacteristics();if(f.newBoxModel){if(a.x>b){this.zoomBox.style.width=Math.max(1,d-f.xOffset)+"px"}if(a.y>c){this.zoomBox.style.height=Math.max(1,e-f.yOffset)+"px"}}},endBox:function(a){var b;if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var c=this.dragHandler.start;var d=Math.min(c.y,a.y);var e=Math.max(c.y,a.y);var f=Math.min(c.x,a.x);var g=Math.max(c.x,a.x);b=new OpenLayers.Bounds(f,e,g,d)}else{b=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true}else{return false}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var b=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var c=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:a,yOffset:b,newBoxModel:c}}return this.boxCharacteristics},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(a,b,c){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});OpenLayers.Handler.prototype.initialize.apply(this,[a,b,c]);this.options=c?c:new Object},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b={displayInLayerSwitcher:false,calculateInRange:function(){return true}};this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy()}}this.layer=null;this.feature=null;a=true}return a},down:function(a){this.fixedRadius=!!this.radius;var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}if(this.persist){this.clear()}this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.map.getLonLatFromPixel(a.xy);var c=new OpenLayers.Geometry.Point(b.lon,b.lat);if(this.irregular){var d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,d)}else if(this.fixedRadius){this.origin=c}else{this.calculateAngle(c,a);this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin))}this.modifyGeometry();if(this.irregular){var e=c.x-this.origin.x;var f=c.y-this.origin.y;var g;if(f==0){g=e/(this.radius*Math.sqrt(2))}else{g=e/f}this.feature.geometry.resize(1,this.origin,g);this.feature.geometry.move(e/2,f/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize();if(this.start==this.last){this.callback("done",[a.xy])}},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-1/2);if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c,d;var e=this.feature.geometry.components[0];if(e.components.length!=this.sides+1){this.createGeometry();e=this.feature.geometry.components[0]}for(var f=0;f<this.sides;++f){d=e.components[f];a=this.angle+f*2*Math.PI/this.sides;d.x=this.origin.x+this.radius*Math.cos(a);d.y=this.origin.y+this.radius*Math.sin(a);d.clearBounds()}},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else{this.angle=c}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer.renderer.clear();this.layer.destroyFeatures()},callback:function(a,b){if(this.callbacks[a]){this.callbacks[a].apply(this.control,[this.feature.geometry.clone()])}if(!this.persist&&(a=="done"||a=="cancel")){this.clear()}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.Util.getBrowserName()=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(a){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane);this.pane=null}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var a=this.map.getSize();var b=Math.min(a.w,300);var c=Math.min(a.h,200);var d=new OpenLayers.Size(b,c);var e=new OpenLayers.Pixel(a.w/2,a.h/2);var f=e.add(-d.w/2,-d.h/2);var g=OpenLayers.Util.createDiv(this.name+"_warning",f,d,null,null,null,"auto");g.style.padding="7px";g.style.backgroundColor="yellow";g.innerHTML=this.getWarningHTML();this.div.appendChild(g)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var d=this.map.getCenter();var e=this.map.getZoom();if(d!=null){var f=this.getMapObjectCenter();var g=this.getOLLonLatFromMapObjectLonLat(f);var h=this.getMapObjectZoom();var i=this.getOLZoomFromMapObjectZoom(h);if(!d.equals(g)||!(e==i)){if(c&&this.dragPanMapObject&&this.smoothDragPan){var j=this.map.getViewPortPxFromLonLat(g);var k=this.map.getViewPortPxFromLonLat(d);this.dragPanMapObject(k.x-j.x,j.y-k.y)}else{var l=this.getMapObjectLonLatFromOLLonLat(d);var m=this.getMapObjectZoomFromOLZoom(e);this.setMapObjectCenter(l,m,c)}}}}},getLonLatFromViewPortPx:function(a){var b=null;if(this.mapObject!=null&&this.getMapObjectCenter()!=null){var c=this.getMapObjectPixelFromOLPixel(a);var d=this.getMapObjectLonLatFromMapObjectPixel(c);b=this.getOLLonLatFromMapObjectLonLat(d)}return b},getViewPortPxFromLonLat:function(a){var b=null;if(this.mapObject!=null&&this.getMapObjectCenter()!=null){var c=this.getMapObjectLonLatFromOLLonLat(a);var d=this.getMapObjectPixelFromMapObjectLonLat(c);b=this.getOLPixelFromMapObjectPixel(d)}return b},getOLLonLatFromMapObjectLonLat:function(a){var b=null;if(a!=null){var c=this.getLongitudeFromMapObjectLonLat(a);var d=this.getLatitudeFromMapObjectLonLat(a);b=new OpenLayers.LonLat(c,d)}return b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;if(a!=null){b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)}return b},getOLPixelFromMapObjectPixel:function(a){var b=null;if(a!=null){var c=this.getXFromMapObjectPixel(a);var d=this.getYFromMapObjectPixel(a);b=new OpenLayers.Pixel(c,d)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;if(a!=null){b=this.getMapObjectPixelFromXY(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var a=new Array("minZoomLevel","maxZoomLevel","numZoomLevels");for(var b=0,c=a.length;b<c;b++){var d=a[b];this[d]=this.options[d]!=null?this.options[d]:this.map[d]}if(this.minZoomLevel==null||this.minZoomLevel<this.MIN_ZOOM_LEVEL){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var e;var f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(this.options.numZoomLevels==null&&this.options.maxZoomLevel!=null||this.numZoomLevels==null&&this.maxZoomLevel!=null){e=this.maxZoomLevel-this.minZoomLevel+1}else{e=this.numZoomLevels}if(e!=null){this.numZoomLevels=Math.min(e,f)}else{this.numZoomLevels=f}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var g=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++){this.resolutions[g++]=this.RESOLUTIONS[b]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}else{var a=null;var b=this.map.getSize();var c=this.getExtent();if(b!=null&&c!=null){a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h)}return a}},getExtent:function(){var a=null;var b=this.map.getSize();var c=new OpenLayers.Pixel(0,0);var d=this.getLonLatFromViewPortPx(c);var e=new OpenLayers.Pixel(b.w,b.h);var f=this.getLonLatFromViewPortPx(e);if(d!=null&&f!=null){a=new OpenLayers.Bounds(d.lon,f.lat,f.lon,d.lat)}return a},getZoomForResolution:function(a){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)}},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=a-this.minZoomLevel}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=a+this.minZoomLevel}return b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(a,b,c,d){var e=arguments;e=[a,d];OpenLayers.Layer.prototype.initialize.apply(this,e);this.url=b;this.params=OpenLayers.Util.extend({},c)},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);return this.redraw()},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(a,b){var c=1;for(var d=0,e=a.length;d<e;d++){c*=a.charCodeAt(d)*this.URL_HASH_FACTOR;c-=Math.floor(c)}return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url;var d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);if(c instanceof Array){c=this.selectUrl(e,c)}var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d){if(g.toUpperCase()in f){delete d[g]}}e=OpenLayers.Util.getParameterString(d);var h=c;if(e!=""){var i=c.charAt(c.length-1);if(i=="&"||i=="?"){h+=e}else{if(c.indexOf("?")==-1){h+="?"+e}else{h+="&"+e}}}return h},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b;this.extent=c;this.maxExtent=c;this.size=d;OpenLayers.Layer.prototype.initialize.apply(this,[a,e]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.options)}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=this.tile==null;if(b||d){this.setTileSize();var e=new OpenLayers.LonLat(this.extent.left,this.extent.top);var f=this.map.getLayerPxFromLonLat(e);if(d){this.tile=new OpenLayers.Tile.Image(this,f,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=f.clone()}this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution();var b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=0,c=this.markers.length;b<c;b++){this.markers[b].setOpacity(this.opacity)}}},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var d=0,e=this.markers.length;d<e;d++){this.drawMarker(this.markers[d])}this.drawn=true}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a)}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);a.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null){a.display(false)}else{if(!a.isDrawn()){var c=a.draw(b);this.div.appendChild(c)}else if(a.icon){a.icon.moveTo(b)}}},getDataExtent:function(){var a=null;if(this.markers&&this.markers.length>0){var a=new OpenLayers.Bounds;for(var b=0,c=this.markers.length;b<c;b++){var d=this.markers[b];a.extend(d.lonlat)}}return a},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;if(this.sphericalMercator){a=this.map.calculateBounds()}else{a=OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return a},initMercatorParameters:function(){this.RESOLUTIONS=[];var a=156543.0339;for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=a/Math.pow(2,b)}this.units="m";this.projection="EPSG:900913"},forwardMercator:function(a,b){var c=a*20037508.34/180;var d=Math.log(Math.tan((90+b)*Math.PI/360))/(Math.PI/180);d=d*20037508.34/180;return new OpenLayers.LonLat(c,d)},inverseMercator:function(a,b){var c=a/20037508.34*180;var d=b/20037508.34*180;d=180/Math.PI*(2*Math.atan(Math.exp(d*Math.PI/180))-Math.PI/2);return new OpenLayers.LonLat(c,d)},projectForward:function(a){var b=OpenLayers.Layer.SphericalMercator.forwardMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a},projectInverse:function(a){var b=OpenLayers.Layer.SphericalMercator.inverseMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a}};OpenLayers.Projection.addTransform("EPSG:4326","EPSG:900913",OpenLayers.Layer.SphericalMercator.projectForward);OpenLayers.Projection.addTransform("EPSG:900913","EPSG:4326",OpenLayers.Layer.SphericalMercator.projectInverse);OpenLayers.Tile.WFS=OpenLayers.Class(OpenLayers.Tile,{features:null,url:null,request:null,initialize:function(a,b,c,d,e){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=d;this.features=[]},destroy:function(){OpenLayers.Tile.prototype.destroy.apply(this,arguments);this.destroyAllFeatures();this.features=null;this.url=null;if(this.request){this.request.abort();this.request=null}},clear:function(){this.destroyAllFeatures()},draw:function(){if(OpenLayers.Tile.prototype.draw.apply(this,arguments)){if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.loadFeaturesForRegion(this.requestSuccess)}},loadFeaturesForRegion:function(a,b){if(this.request){this.request.abort()}this.request=OpenLayers.Request.GET({url:this.url,success:a,failure:b,scope:this})},requestSuccess:function(a){if(this.features){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(this.layer.vectorMode){this.layer.addFeatures(this.layer.formatObject.read(b))}else{var c=new OpenLayers.Format.XML;if(typeof b=="string"){b=c.read(b)}var d=c.getElementsByTagNameNS(b,"http://www.opengis.net/gml","featureMember");this.addResults(d)}}if(this.events){this.events.triggerEvent("loadend")}this.request=null},addResults:function(a){for(var b=0;b<a.length;b++){var c=new this.layer.featureClass(this.layer,a[b]);this.features.push(c)}},destroyAllFeatures:function(){while(this.features.length>0){var a=this.features.shift();a.destroy()}},CLASS_NAME:"OpenLayers.Tile.WFS"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],featureAdded:function(){},handlerOptions:null,initialize:function(a,b,c){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks);this.layer=a;var d=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(d){this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":d})})}this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);var c=this.layer.events.triggerEvent("sketchcomplete",{feature:b});if(c!==false){b.state=OpenLayers.State.INSERT;this.layer.addFeatures([b]);this.featureAdded(b);this.events.triggerEvent("featureadded",{feature:b})}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["measure","measurepartial"],handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,initialize:function(a,b){this.EVENT_TYPES=OpenLayers.Control.Measure.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[b]);this.callbacks=OpenLayers.Util.extend({done:this.measureComplete,point:this.measurePartial},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new a(this,this.callbacks,this.handlerOptions)},cancel:function(){this.handler.cancel()},updateHandler:function(a,b){var c=this.active;if(c){this.deactivate()}this.handler=new a(this,this.callbacks,b);if(c){this.activate()}},measureComplete:function(a){if(this.delayedTrigger){window.clearTimeout(this.delayedTrigger)}this.measure(a,"measure")},measurePartial:function(a,b){this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.measure(b,"measurepartial")},this),this.partialDelay)},measure:function(a,b){var c,d;if(a.CLASS_NAME.indexOf("LineString")>-1){c=this.getBestLength(a);d=1}else{c=this.getBestArea(a);d=2}this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){var b=this.displaySystemUnits[this.displaySystem];var c,d;for(var e=0,f=b.length;e<f;++e){c=b[e];d=this.getArea(a,c);if(d>1){break}}return[d,c]},getArea:function(a,b){var c,d;if(this.geodesic){c=a.getGeodesicArea(this.map.getProjectionObject());d="m"}else{c=a.getArea();d=this.map.getUnits()}var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=Math.pow(f/e,2)}return c},getBestLength:function(a){var b=this.displaySystemUnits[this.displaySystem];var c,d;for(var e=0,f=b.length;e<f;++e){c=b[e];d=this.getLength(a,c);if(d>1){break}}return[d,c]},getLength:function(a,b){var c,d;if(this.geodesic){c=a.getGeodesicLength(this.map.getProjectionObject());d="m"}else{c=a.getLength();d=this.map.getUnits()}var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=f/e}return c},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){if(!this.out){var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var c=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));var d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat)}else{var e=Math.abs(a.right-a.left);var f=Math.abs(a.top-a.bottom);var g=Math.min(this.map.size.h/f,this.map.size.w/e);var h=this.map.getExtent();var i=this.map.getLonLatFromPixel(a.getCenterPixel());var j=i.lon-h.getWidth()/2*g;var k=i.lon+h.getWidth()/2*g;var l=i.lat-h.getHeight()/2*g;var m=i.lat+h.getHeight()/2*g;var d=new OpenLayers.Bounds(j,l,k,m)}var n=this.map.getZoom();this.map.zoomToExtent(d);if(n==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(n+(this.out?-1:1))}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(a),this.map.getZoom()+1)}else{this.map.setCenter(this.map.getLonLatFromPixel(a),this.map.getZoom()-1)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(a){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(a){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c,d;var e=this.regExes.typeStr.exec(a);if(e){c=e[1].toLowerCase();d=e[2];if(this.parse[c]){b=this.parse[c].apply(this,[d])}if(this.internalProjection&&this.externalProjection){if(b&&b.CLASS_NAME=="OpenLayers.Feature.Vector"){b.geometry.transform(this.externalProjection,this.internalProjection)}else if(b&&c!="geometrycollection"&&typeof b=="object"){for(var f=0,g=b.length;f<g;f++){var h=b[f];h.geometry.transform(this.externalProjection,this.internalProjection)}}}}return b},write:function(a){var b,c,d,e,f;if(a.constructor==Array){b=a;f=true}else{b=[a];f=false}var g=[];if(f){g.push("GEOMETRYCOLLECTION(")}for(var h=0,i=b.length;h<i;++h){if(f&&h>0){g.push(",")}c=b[h].geometry;d=c.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[d]){return null}if(this.internalProjection&&this.externalProjection){c=c.clone();c.transform(this.internalProjection,this.externalProjection)}e=this.extract[d].apply(this,[c]);g.push(d.toUpperCase()+"("+e+")")}if(f){g.push(")")}return g.join("")},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.point.apply(this,[a.components[c]]))}return b.join(",")},linestring:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.point.apply(this,[a.components[c]]))}return b.join(",")},multilinestring:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")")}return b.join(",")},polygon:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")")}return b.join(",")},multipolygon:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")")}return b.join(",")}},parse:{point:function(a){var b=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(a){var b=OpenLayers.String.trim(a).split(",");var c=[];for(var d=0,e=b.length;d<e;++d){c.push(this.parse.point.apply(this,[b[d]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(c))},linestring:function(a){var b=OpenLayers.String.trim(a).split(",");var c=[];for(var d=0,e=b.length;d<e;++d){c.push(this.parse.point.apply(this,[b[d]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(c))},multilinestring:function(a){var b;var c=OpenLayers.String.trim(a).split(this.regExes.parenComma);var d=[];for(var e=0,f=c.length;e<f;++e){b=c[e].replace(this.regExes.trimParens,"$1");d.push(this.parse.linestring.apply(this,[b]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(d))},polygon:function(a){var b,c,d;var e=OpenLayers.String.trim(a).split(this.regExes.parenComma);var f=[];for(var g=0,h=e.length;g<h;++g){b=e[g].replace(this.regExes.trimParens,"$1");c=this.parse.linestring.apply(this,[b]).geometry;d=new OpenLayers.Geometry.LinearRing(c.components);f.push(d)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f))},multipolygon:function(a){var b;var c=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma);var d=[];for(var e=0,f=c.length;e<f;++e){b=c[e].replace(this.regExes.trimParens,"$1");d.push(this.parse.polygon.apply(this,[b]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(d))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");var b=OpenLayers.String.trim(a).split("|");var c=[];for(var d=0,e=b.length;d<e;++d){c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[b[d]]))}return c}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(a,b){a.options.maxScale=this.getChildValue(b)},read_sld_MaxScaleDenominator:function(a,b){a.options.minScale=this.getChildValue(b)},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale){var c=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");c.appendChild(this.createTextNode(a.maxScale.toPrecision(10)));b.insertBefore(c,b.childNodes[3])}if(a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale){var d=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");d.appendChild(this.createTextNode(a.minScale.toPrecision(10)));b.insertBefore(d,b.childNodes[4])}return b},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(a){var b=a.bounds;var c=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(b.left,b.top));var d=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(b.right,b.bottom));if(d==null||c==null){a.display(false)}else{var e=new OpenLayers.Size(Math.max(1,d.x-c.x),Math.max(1,d.y-c.y));var f=a.draw(c,e);if(!a.drawn){this.div.appendChild(f);a.drawn=true}}},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a);if(a.div!=null&&a.div.parentNode==this.div){this.div.removeChild(a.div)}},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(a,b,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]);this.location=b;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this});this.loaded=true}},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadRSS()}},parseData:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=OpenLayers.Format.XML.prototype.read(a.responseText)}if(this.useFeedTitle){var c=null;try{c=b.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(d){c=b.getElementsByTagName("title")[0].firstChild.nodeValue}if(c){this.setName(c)}}var e={};OpenLayers.Util.extend(e,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){e.externalProjection=this.projection;e.internalProjection=this.map.getProjectionObject()}var f=new OpenLayers.Format.GeoRSS(e);var g=f.read(b);for(var h=0,i=g.length;h<i;h++){var j={};var k=g[h];if(!k.geometry){continue}var l=k.attributes.title?k.attributes.title:"Untitled";var m=k.attributes.description?k.attributes.description:"No description.";var n=k.attributes.link?k.attributes.link:"";var o=k.geometry.getBounds().getCenterLonLat();j.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();j.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(l||m){j.title=l;j.description=m;var p='<div class="olLayerGeoRSSClose">[x]</div>';p+='<div class="olLayerGeoRSSTitle">';if(n){p+='<a class="link" href="'+n+'" target="_blank">'}p+=l;if(n){p+="</a>"}p+="</div>";p+='<div style="" class="olLayerGeoRSSDescription">';p+=m;p+="</div>";j["popupContentHTML"]=p}var k=new OpenLayers.Feature(this,o,j);this.features.push(k);var q=k.createMarker();q.events.register("click",k,this.markerClick);this.addMarker(q)}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=!b?this:null;for(var c=0,d=this.layer.map.popups.length;c<d;c++){this.layer.map.removePopup(this.layer.map.popups[c])}if(!b){var e=this.createPopup();OpenLayers.Event.observe(e.div,"click",OpenLayers.Function.bind(function(){for(var a=0,b=this.layer.map.popups.length;a<b;a++){this.layer.map.removePopup(this.layer.map.popups[a])}},this));this.layer.map.addPopup(e)}OpenLayers.Event.stop(a)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:19,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20],type:null,sphericalMercator:false,dragObject:null,termsOfUse:null,poweredBy:null,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);this.addContainerPxFunction();if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{this.mapObject=new GMap2(this.div);if(typeof this.mapObject.getDragObject=="function"){this.dragObject=this.mapObject.getDragObject()}else{this.dragPanMapObject=null}this.termsOfUse=this.div.lastChild;this.div.removeChild(this.termsOfUse);if(this.isFixed){this.map.viewPortDiv.appendChild(this.termsOfUse)}else{this.map.layerContainerDiv.appendChild(this.termsOfUse)}this.termsOfUse.style.zIndex="1100";this.termsOfUse.style.display=this.div.style.display;this.termsOfUse.style.right="";this.termsOfUse.style.bottom="";this.termsOfUse.className="olLayerGoogleCopyright";this.poweredBy=this.div.lastChild;this.div.removeChild(this.poweredBy);if(this.isFixed){this.map.viewPortDiv.appendChild(this.poweredBy)}else{this.map.layerContainerDiv.appendChild(this.poweredBy)}this.poweredBy.style.zIndex="1100";this.poweredBy.style.display=this.div.style.display;this.poweredBy.style.right="";this.poweredBy.style.bottom="";this.poweredBy.className="olLayerGooglePoweredBy gmnoprint"}catch(a){OpenLayers.Console.error(a)}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);if(this.type!=null){this.map.events.register("moveend",this,this.setMapType)}},setMapType:function(){if(this.mapObject.getCenter()!=null){if(OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)==-1){this.mapObject.addMapType(this.type)}this.mapObject.setMapType(this.type);this.map.events.unregister("moveend",this,this.setMapType)}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var a=this;var b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b);delete a._resized;a.mapObject.checkResize();a.moveTo(a.map.getCenter(),a.map.getZoom())})}this._resized=true}},display:function(a){OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments);this.termsOfUse.style.display=this.div.style.display;this.poweredBy.style.display=this.div.style.display},removeMap:function(a){if(this.termsOfUse&&this.termsOfUse.parentNode){this.termsOfUse.parentNode.removeChild(this.termsOfUse);this.termsOfUse=null}if(this.poweredBy&&this.poweredBy.parentNode){this.poweredBy.parentNode.removeChild(this.poweredBy);this.poweredBy=null}OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;if(a!=null){var c=a.getSouthWest();var d=a.getNorthEast();if(this.sphericalMercator){c=this.forwardMercator(c.lng(),c.lat());d=this.forwardMercator(d.lng(),d.lat())}else{c=new OpenLayers.LonLat(c.lng(),c.lat());d=new OpenLayers.LonLat(d.lng(),d.lat())}b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}return b},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(a!=null){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left);var d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new GLatLngBounds(new GLatLng(c.lat,c.lon),new GLatLng(d.lat,d.lon))}return b},addContainerPxFunction:function(){if(typeof GMap2!="undefined"&&!GMap2.prototype.fromLatLngToContainerPixel){GMap2.prototype.fromLatLngToContainerPixel=function(a){var b=this.fromLatLngToDivPixel(a);var c=this.getContainer().firstChild.firstChild;b.x+=c.offsetLeft;b.y+=c.offsetTop;return b}}},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){var b=this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat();return b},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new GLatLng(d.lat,d.lon)}else{c=new GLatLng(b,a)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(a,b,c,d){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[]},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;a<b;a++){var c=this.grid[a];for(var d=0,e=c.length;d<e;d++){var f=c[d];this.removeTileMonitoringHooks(f);f.destroy()}}this.grid=[]}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},moveTo:function(a,b,c){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);a=a||this.map.getExtent();if(a!=null){var d=!this.grid.length||b;var e=this.getTilesBounds();if(this.singleTile){if(d||!c&&!e.containsBounds(a)){this.initSingleTile(a)}}else{if(d||!e.containsBounds(a,true)){this.initGriddedTiles(a)}else{this.moveGriddedTiles(a)}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize().clone();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be "+"removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds()},getTilesBounds:function(){var a=null;if(this.grid.length){var b=this.grid.length-1;var c=this.grid[b][0];var d=this.grid[0].length-1;var e=this.grid[0][d];a=new OpenLayers.Bounds(c.bounds.left,c.bounds.bottom,e.bounds.right,e.bounds.top)}return a},initSingleTile:function(a){var b=a.getCenterLonLat();var c=a.getWidth()*this.ratio;var d=a.getHeight()*this.ratio;var e=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2);var f=new OpenLayers.LonLat(e.left,e.top);var g=this.map.getLayerPxFromLonLat(f);if(!this.grid.length){this.grid[0]=[]}var h=this.grid[0][0];if(!h){h=this.addTile(e,g);this.addTileMonitoringHooks(h);h.draw();this.grid[0][0]=h}else{h.moveTo(e,g)}this.removeExcessTiles(1,1)},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w;var e=c*this.tileSize.h;var f=a.left-b.left;var g=Math.floor(f/d)-this.buffer;var h=f/d-g;var i=-h*this.tileSize.w;var j=b.left+g*d;var k=a.top-(b.bottom+e);var l=Math.ceil(k/e)+this.buffer;var m=l-k/e;var n=-m*this.tileSize.h;var o=b.bottom+l*e;return{tilelon:d,tilelat:e,tileoffsetlon:j,tileoffsetlat:o,tileoffsetx:i,tileoffsety:n}},initGriddedTiles:function(a){var b=this.map.getSize();var c=Math.ceil(b.h/this.tileSize.h)+Math.max(1,2*this.buffer);var d=Math.ceil(b.w/this.tileSize.w)+Math.max(1,2*this.buffer);var e=this.maxExtent;var f=this.map.getResolution();var g=this.calculateGridLayout(a,e,f);var h=Math.round(g.tileoffsetx);var i=Math.round(g.tileoffsety);var j=g.tileoffsetlon;var k=g.tileoffsetlat;var l=g.tilelon;var m=g.tilelat;this.origin=new OpenLayers.Pixel(h,i);var n=h;var o=j;var p=0;var q=parseInt(this.map.layerContainerDiv.style.left);var r=parseInt(this.map.layerContainerDiv.style.top);do{var s=this.grid[p++];if(!s){s=[];this.grid.push(s)}j=o;h=n;var t=0;do{var u=new OpenLayers.Bounds(j,k,j+l,k+m);var v=h;v-=q;var w=i;w-=r;var x=new OpenLayers.Pixel(v,w);var y=s[t++];if(!y){y=this.addTile(u,x);this.addTileMonitoringHooks(y);s.push(y)}else{y.moveTo(u,x,false)}j+=l;h+=this.tileSize.w}while(j<=a.right+l*this.buffer||t<d);k-=m;i+=this.tileSize.h}while(k>=a.bottom-m*this.buffer||p<c);this.removeExcessTiles(p,t);this.spiralTileLoad()},spiralTileLoad:function(){var a=[];var b=["right","down","left","up"];var c=0;var d=-1;var e=OpenLayers.Util.indexOf(b,"right");var f=0;while(f<b.length){var g=c;var h=d;switch(b[e]){case"right":h++;break;case"down":g++;break;case"left":h--;break;case"up":g--;break}var i=null;if(g<this.grid.length&&g>=0&&h<this.grid[0].length&&h>=0){i=this.grid[g][h]}if(i!=null&&!i.queued){a.unshift(i);i.queued=true;f=0;c=g;d=h}else{e=(e+1)%4;f++}}for(var j=0,k=a.length;j<k;j++){var i=a[j];i.draw();i.queued=false}},addTile:function(a,b){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(a){var b=this.buffer||1;while(true){var c=this.grid[0][0].position;var d=this.map.getViewPortPxFromLayerPx(c);if(d.x>-this.tileSize.w*(b-1)){this.shiftColumn(true)}else if(d.x<-this.tileSize.w*b){this.shiftColumn(false)}else if(d.y>-this.tileSize.h*(b-1)){this.shiftRow(true)}else if(d.y<-this.tileSize.h*b){this.shiftRow(false)}else{break}}},shiftRow:function(a){var b=a?0:this.grid.length-1;var c=this.grid;var d=c[b];var e=this.map.getResolution();var f=a?-this.tileSize.h:this.tileSize.h;var g=e*-f;var h=a?c.pop():c.shift();for(var i=0,j=d.length;i<j;i++){var k=d[i];var l=k.bounds.clone();var m=k.position.clone();l.bottom=l.bottom+g;l.top=l.top+g;m.y=m.y+f;h[i].moveTo(l,m)}if(a){c.unshift(h)}else{c.push(h)}},shiftColumn:function(a){var b=a?-this.tileSize.w:this.tileSize.w;var c=this.map.getResolution();var d=c*b;for(var e=0,f=this.grid.length;e<f;e++){var g=this.grid[e];var h=a?0:g.length-1;var i=g[h];var j=i.bounds.clone();var k=i.position.clone();j.left=j.left+d;j.right=j.right+d;k.x=k.x+b;var l=a?this.grid[e].pop():this.grid[e].shift();l.moveTo(j,k);if(a){g.unshift(l)}else{g.push(l)}}},removeExcessTiles:function(a,b){while(this.grid.length>a){var c=this.grid.pop();for(var d=0,e=c.length;d<e;d++){var f=c[d];this.removeTileMonitoringHooks(f);f.destroy()}}while(this.grid[0].length>b){for(var d=0,e=this.grid.length;d<e;d++){var c=this.grid[d];var f=c.pop();this.removeTileMonitoringHooks(f);f.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(a){var b=this.maxExtent;var c=this.getResolution();var d=c*this.tileSize.w;var e=c*this.tileSize.h;var f=this.getLonLatFromViewPortPx(a);var g=b.left+d*Math.floor((f.lon-b.left)/d);var h=b.bottom+e*Math.floor((f.lat-b.bottom)/e);return new OpenLayers.Bounds(g,h,g+d,h+e)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.MultiMap=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[9,1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20],type:null,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters();this.RESOLUTIONS.unshift(10)}},loadMapObject:function(){try{this.mapObject=new MultimapViewer(this.div)}catch(a){}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"MM",layerLib:"MultiMap"})},setMapObjectCenter:function(a,b){this.mapObject.goToPosition(a,b)},getMapObjectCenter:function(){return this.mapObject.getCurrentPosition()},getMapObjectZoom:function(){return this.mapObject.getZoomFactor()},getMapObjectLonLatFromMapObjectPixel:function(a){a.x=a.x-this.map.getSize().w/2;a.y=a.y-this.map.getSize().h/2;return this.mapObject.getMapPositionAt(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.geoPosToContainerPixels(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lon:a.lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lat:a.lat},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new MMLatLon(d.lat,d.lon)}else{c=new MMLatLon(b,a)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new MMPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.MultiMap"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=new Array},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var a=function(a){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this});this.loaded=true}}},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(a){var b=a.responseText;var c={};OpenLayers.Util.extend(c,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){c.externalProjection=this.projection;c.internalProjection=this.map.getProjectionObject()}var d=new OpenLayers.Format.Text(c);var e=d.read(b);for(var f=0,g=e.length;f<g;f++){var h={};var i=e[f];var j;var k,l;j=new OpenLayers.LonLat(i.geometry.x,i.geometry.y);if(i.style.graphicWidth&&i.style.graphicHeight){k=new OpenLayers.Size(i.style.graphicWidth,i.style.graphicHeight)}if(i.style.graphicXOffset!==undefined&&i.style.graphicYOffset!==undefined){l=new OpenLayers.Pixel(i.style.graphicXOffset,i.style.graphicYOffset)}if(i.style.externalGraphic!=null){h.icon=new OpenLayers.Icon(i.style.externalGraphic,k,l)}else{h.icon=OpenLayers.Marker.defaultIcon();if(k!=null){h.icon.setSize(k)}}if(i.attributes.title!=null&&i.attributes.description!=null){h["popupContentHTML"]="<h2>"+i.attributes.title+"</h2>"+"<p>"+i.attributes.description+"</p>"}h["overflow"]=i.attributes.overflow||"auto";var m=new OpenLayers.Feature(this,j,h);this.features.push(m);var n=m.createMarker();if(i.attributes.title!=null&&i.attributes.description!=null){n.events.register("click",m,this.markerClick)}this.addMarker(n)}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=!b?this:null;for(var c=0,d=this.layer.map.popups.length;c<d;c++){this.layer.map.removePopup(this.layer.map.popups[c])}if(!b){this.layer.map.addPopup(this.createPopup())}OpenLayers.Event.stop(a)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Layer.VirtualEarth=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20],type:null,sphericalMercator:false,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){var a=OpenLayers.Util.createDiv(this.name);var b=this.map.getSize();a.style.width=b.w+"px";a.style.height=b.h+"px";this.div.appendChild(a);try{this.mapObject=new VEMap(this.name)}catch(c){}if(this.mapObject!=null){try{this.mapObject.LoadMap(null,null,this.type,true);this.mapObject.AttachEvent("onmousedown",function(){return true})}catch(c){}this.mapObject.HideDashboard()}if(!this.mapObject||!this.mapObject.vemapcontrol||!this.mapObject.vemapcontrol.PanMap||typeof this.mapObject.vemapcontrol.PanMap!="function"){this.dragPanMapObject=null}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"VE",layerLib:"VirtualEarth"})},setMapObjectCenter:function(a,b){this.mapObject.SetCenterAndZoom(a,b)},getMapObjectCenter:function(){return this.mapObject.GetCenter()},dragPanMapObject:function(a,b){this.mapObject.vemapcontrol.PanMap(a,-b)},getMapObjectZoom:function(){return this.mapObject.GetZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return typeof VEPixel!="undefined"?this.mapObject.PixelToLatLong(a):this.mapObject.PixelToLatLong(a.x,a.y)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.LatLongToPixel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lon:a.Longitude},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lat:a.Latitude},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new VELatLong(d.lat,d.lon)}else{c=new VELatLong(b,a)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return typeof VEPixel!="undefined"?new VEPixel(a,b):new Msn.VE.Pixel(a,b)},CLASS_NAME:"OpenLayers.Layer.VirtualEarth"});OpenLayers.Layer.Yahoo=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20],type:null,sphericalMercator:false,initialize:function(a,b){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject=new YMap(this.div,this.type,a);this.mapObject.disableKeyControls();this.mapObject.disableDragMap();if(!this.mapObject.moveByXY||typeof this.mapObject.moveByXY!="function"){this.dragPanMapObject=null}}catch(b){}},onMapResize:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject.resizeTo(a)}catch(b){}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.fixYahooEventPane)},fixYahooEventPane:function(){var a=OpenLayers.Util.getElement("ygddfdiv");if(a!=null){if(a.parentNode!=null){a.parentNode.removeChild(a)}this.map.events.unregister("moveend",this,this.fixYahooEventPane)}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"Yahoo",layerLib:"Yahoo"})},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getOLZoomFromMapObjectZoom.apply(this,[a]);b=18-b}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getMapObjectZoomFromOLZoom.apply(this,[a]);b=18-b}return b},setMapObjectCenter:function(a,b){this.mapObject.drawZoomAndCenter(a,b)},getMapObjectCenter:function(){return this.mapObject.getCenterLatLon()},dragPanMapObject:function(a,b){this.mapObject.moveByXY({x:-a,y:b})},getMapObjectZoom:function(){return this.mapObject.getZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.convertXYLatLon(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.convertLatLonXY(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lon:a.Lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lat:a.Lat},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new YGeoPoint(d.lat,d.lon)}else{c=new YGeoPoint(b,a)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new YCoordPoint(a,b)},getMapObjectSizeFromOLSize:function(a){return new YSize(a.w,a.h)},CLASS_NAME:"OpenLayers.Layer.Yahoo"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,initialize:function(a){this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments)},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},read:function(a){a=OpenLayers.Util.applyDefaults(a,this.options);var b=a.readWithPOST!==undefined?a.readWithPOST:this.readWithPOST;var c=new OpenLayers.Protocol.Response({requestType:"read"});if(a.filter&&a.filter instanceof OpenLayers.Filter.Spatial){if(a.filter.type==OpenLayers.Filter.Spatial.BBOX){a.params=OpenLayers.Util.extend(a.params,{bbox:a.filter.value.toArray()})}}if(b){c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else{c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers})}return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)});return c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){var c=b.url||a.url||this.options.url;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"});d.priv=OpenLayers.Request.PUT({url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)});return d},handleUpdate:function(a,b){this.handleResponse(a,b)},"delete":function(a,b){var c=b.url||a.url||this.options.url;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"});d.priv=OpenLayers.Request.DELETE({url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers});return d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;if(b.callback){if(c.status>=200&&c.status<300){if(a.requestType!="delete"){a.features=this.parseFeatures(c)}a.code=OpenLayers.Protocol.Response.SUCCESS}else{a.code=OpenLayers.Protocol.Response.FAILURE}b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(a,b){function o(a){this.callUserCallback(a,b);l=l&&a.success();d++;if(d>=k){if(b.callback){m.code=l?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;b.callback.apply(b.scope,[m])}}}function n(a){var b=a.features?a.features.length:0;var c=new Array(b);for(var d=0;d<b;++d){c[d]=a.features[d].fid}m.insertIds=c;o.apply(this,[a])}b=OpenLayers.Util.applyDefaults(b,this.options);var c=[],d=0;var e={};e[OpenLayers.State.INSERT]=[];e[OpenLayers.State.UPDATE]=[];e[OpenLayers.State.DELETE]=[];var f,g,h=[];for(var i=0,j=a.length;i<j;++i){f=a[i];g=e[f.state];if(g){g.push(f);h.push(f)}}var k=(e[OpenLayers.State.INSERT].length>0?1:0)+e[OpenLayers.State.UPDATE].length+e[OpenLayers.State.DELETE].length;var l=true;var m=new OpenLayers.Protocol.Response({reqFeatures:h});var p=e[OpenLayers.State.INSERT];if(p.length>0){c.push(this.create(p,OpenLayers.Util.applyDefaults({callback:n,scope:this},b.create)))}p=e[OpenLayers.State.UPDATE];for(var i=p.length-1;i>=0;--i){c.push(this.update(p[i],OpenLayers.Util.applyDefaults({callback:o,scope:this},b.update)))}p=e[OpenLayers.State.DELETE];for(var i=p.length-1;i>=0;--i){c.push(this["delete"](p[i],OpenLayers.Util.applyDefaults({callback:o,scope:this},b["delete"])))}return c},abort:function(a){if(a){a.priv.abort()}},callUserCallback:function(a,b){var c=b[a.requestType];if(c&&c.callback){c.callback.call(c.scope,a)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Style=OpenLayers.Class({name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.rules=[];if(b&&b.rules){this.addRules(b.rules)}this.setDefaultStyle(a||OpenLayers.Feature.Vector.style["default"])},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++){this.rules[a].destroy();this.rules[a]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(a){var b=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a);var c=this.rules;var d,e;var f=[];var g=false;for(var h=0,i=c.length;h<i;h++){d=c[h];var j=d.evaluate(a);if(j){if(d instanceof OpenLayers.Rule&&d.elseFilter){f.push(d)}else{g=true;this.applySymbolizer(d,b,a)}}}if(g==false&&f.length>0){g=true;for(var h=0,i=f.length;h<i;h++){this.applySymbolizer(f[h],b,a)}}if(c.length>0&&g==false){b.display="none"}return b},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var e=a.symbolizer[d]||a.symbolizer;if(this.defaultsPerSymbolizer===true){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(e,{pointRadius:f.pointRadius});if(e.stroke===true||e.graphic===true){OpenLayers.Util.applyDefaults(e,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap})}if(e.fill===true||e.graphic===true){OpenLayers.Util.applyDefaults(e,{fillColor:f.fillColor,fillOpacity:f.fillOpacity})}if(e.graphic===true){OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(OpenLayers.Util.extend(b,e),c)},createLiterals:function(a,b){var c=this.context||b.attributes||b.data;for(var d in this.propertyStyles){a[d]=OpenLayers.Style.createLiteral(a[d],c,b)}return a},findPropertyStyles:function(){var a={};var b=this.defaultStyle;this.addPropertyStyles(a,b);var c=this.rules;var d,e;for(var f=0,g=c.length;f<g;f++){d=c[f].symbolizer;for(var h in d){e=d[h];if(typeof e=="object"){this.addPropertyStyles(a,e)}else{this.addPropertyStyles(a,d);break}}}return a},addPropertyStyles:function(a,b){var c;for(var d in b){c=b[d];if(typeof c=="string"&&c.match(/\$\{\w+\}/)){a[d]=true}}return a},addRules:function(a){this.rules=this.rules.concat(a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){var b=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var c=0,d=b.length;c<d;c++){if(a.CLASS_NAME.indexOf(b[c])!=-1){return b[c]}}},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(a,b,c){if(typeof a=="string"&&a.indexOf("${")!=-1){a=OpenLayers.String.format(a,b,[c]);a=isNaN(a)||!a?a:parseFloat(a)}return a};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text"];OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,zoomBox:null,zoomWheelEnabled:true,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();this.zoomBox.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=function(){return false}}var a={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown});this.activate()},defaultDblClick:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom+1)},defaultDblRightClick:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(b,this.map.zoom-1)},wheelChange:function(a,b){var c=this.map.getZoom()+b;if(!this.map.isValidZoomLevel(c)){return}var d=this.map.getSize();var e=d.w/2-a.xy.x;var f=a.xy.y-d.h/2;var g=this.map.baseLayer.getResolutionForZoom(c);var h=this.map.getLonLatFromPixel(a.xy);var i=new OpenLayers.LonLat(h.lon+e*g,h.lat+f*g);this.map.setCenter(i,c)},wheelUp:function(a){this.wheelChange(a,1)},wheelDown:function(a){this.wheelChange(a,-1)},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return true},clone:function(){return null},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){if(a){this.bounds=a.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(a){var b=this.getBounds();if(!b){this.setBounds(a)}else{this.bounds.extend(a)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(a,b){},getVertices:function(a){},atPoint:function(a,b,c){var d=false;var e=this.getBounds();if(e!=null&&a!=null){var f=b!=null?b:0;var g=c!=null?c:0;var h=new OpenLayers.Bounds(this.bounds.left-f,this.bounds.bottom-g,this.bounds.right+f,this.bounds.top+g);d=h.containsLonLat(a)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(a){var b=arguments.callee.format;if(!b){b=new OpenLayers.Format.WKT;arguments.callee.format=b}var c;var d=b.read(a);if(d instanceof OpenLayers.Feature.Vector){c=d.geometry}else if(d instanceof Array){var e=d.length;var f=new Array(e);for(var g=0;g<e;++g){f[g]=d[g].geometry}c=new OpenLayers.Geometry.Collection(f)}return c};OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point;var e=c&&c.tolerance;var f=false;var g=a.x1-b.x1;var h=a.y1-b.y1;var i=a.x2-a.x1;var j=a.y2-a.y1;var k=b.y2-b.y1;var l=b.x2-b.x1;var m=k*i-l*j;var n=l*h-k*g;var o=i*h-j*g;if(m==0){if(n==0&&o==0){f=true}}else{var p=n/m;var q=o/m;if(p>=0&&p<=1&&q>=0&&q<=1){if(!d){f=true}else{var r=a.x1+p*i;var s=a.y1+p*j;f=new OpenLayers.Geometry.Point(r,s)}}}if(e){var t;if(f){if(d){var u=[a,b];var v,r,s;outer:for(var w=0;w<2;++w){v=u[w];for(var x=1;x<3;++x){r=v["x"+x];s=v["y"+x];t=Math.sqrt(Math.pow(r-f.x,2)+Math.pow(s-f.y,2));if(t<e){f.x=r;f.y=s;break outer}}}}}else{var u=[a,b];var y,z,r,s,A,B;outer:for(var w=0;w<2;++w){y=u[w];z=u[(w+1)%2];for(var x=1;x<3;++x){A={x:y["x"+x],y:y["y"+x]};B=OpenLayers.Geometry.distanceToSegment(A,z);if(B.distance<e){if(d){f=new OpenLayers.Geometry.Point(A.x,A.y)}else{f=true}break outer}}}}}return f};OpenLayers.Geometry.distanceToSegment=function(a,b){var c=a.x;var d=a.y;var e=b.x1;var f=b.y1;var g=b.x2;var h=b.y2;var i=g-e;var j=h-f;var k=(i*(c-e)+j*(d-f))/(Math.pow(i,2)+Math.pow(j,2));var l,m;if(k<=0){l=e;m=f}else if(k>=1){l=g;m=h}else{l=e+k*i;m=f+k*j}return{distance:Math.sqrt(Math.pow(l-c,2)+Math.pow(m-d,2)),x:l,y:m}};OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if(d==null||!d.isBaseLayer){this.isBaseLayer=false}if(this.params.FORMAT=="jpg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(a){a=this.adjustBounds(a);var b=this.projection.getCode().split(":");var c=b[b.length-1];var d=this.getImageSize();var e={BBOX:a.toBBOX(),SIZE:d.w+","+d.h,F:"image",BBOXSR:c,IMAGESR:c};if(this.layerDefs){var f=[];var g;for(g in this.layerDefs){if(this.layerDefs.hasOwnProperty(g)){if(this.layerDefs[g]){f.push(g);f.push(":");f.push(this.layerDefs[g]);f.push(";")}}}if(f.length>0){e["LAYERDEFS"]=f.join("")}}var h=this.getFullRequestString(e);return h},setLayerFilter:function(a,b){if(!this.layerDefs){this.layerDefs={}}if(b){this.layerDefs[a]=b}else{delete this.layerDefs[a]}},clearLayerFilter:function(a){if(a){delete this.layerDefs[a]}else{delete this.layerDefs}},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a);var c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(a,b,c,d){var e=[];e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution();var c=Math.round(this.map.getScale()*1e4)/1e4;var d=Math.round(a.left/b);var e=-Math.round(a.top/b);return this.getFullRequestString({t:e,l:d,s:c})},addTile:function(a,b){var c=this.getURL(a);return new OpenLayers.Tile.Image(this,b,a,c,this.tileSize)},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w;var e=c*this.tileSize.h;var f=a.left;var g=Math.floor(f/d)-this.buffer;var h=f/d-g;var i=-h*this.tileSize.w;var j=g*d;var k=a.top;var l=Math.ceil(k/e)+this.buffer;var m=l-k/e;var n=-(m+1)*this.tileSize.h;var o=l*e;return{tilelon:d,tilelat:e,tileoffsetlon:j,tileoffsetlat:o,tileoffsetx:i,tileoffsety:n}},clone:function(a){if(a==null){a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getTileBounds:function(a){var b=this.getResolution();var c=b*this.tileSize.w;var d=b*this.tileSize.h;var e=this.getLonLatFromViewPortPx(a);var f=c*Math.floor(e.lon/c);var g=d*Math.floor(e.lat/d);return new OpenLayers.Bounds(f,g,f+c,g+d)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,useHttpTile:false,singleTile:false,useOverlay:false,useAsyncOverlay:true,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(d==null||d.isBaseLayer==null){this.isBaseLayer=this.transparent!="true"&&this.transparent!=true}if(d&&d.useOverlay!=null){this.useOverlay=d.useOverlay}if(this.singleTile){if(this.useOverlay){OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS);if(!this.useAsyncOverlay){this.params.version="1.0.0"}}else{OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS)}}else{if(this.useHttpTile){OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS)}else{OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS)}this.setTileSize(this.defaultSize)}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},getURL:function(a){var b;var c=a.getCenterLonLat();var d=this.map.getCurrentSize();if(this.singleTile){var e={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:d.h*this.ratio,setdisplaywidth:d.w*this.ratio,setviewcenterx:c.lon,setviewcentery:c.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var f={};f=OpenLayers.Util.extend(f,e);f.operation="GETVISIBLEMAPEXTENT";f.version="1.0.0";f.session=this.params.session;f.mapName=this.params.mapName;f.format="text/xml";b=this.getFullRequestString(f);OpenLayers.Request.GET({url:b,async:false})}b=this.getFullRequestString(e)}else{var g=this.map.getResolution();var h=Math.floor((a.left-this.maxExtent.left)/g);h=Math.round(h/this.tileSize.w);var i=Math.floor((this.maxExtent.top-a.top)/g);i=Math.round(i/this.tileSize.h);if(this.useHttpTile){b=this.getImageFilePath({tilecol:h,tilerow:i,scaleindex:this.resolutions.length-this.map.zoom-1})}else{b=this.getFullRequestString({tilecol:h,tilerow:i,scaleindex:this.resolutions.length-this.map.zoom-1})}}return b},getFullRequestString:function(a,b){var c=b==null?this.url:b;if(typeof c=="object"){c=c[Math.floor(Math.random()*c.length)]}var d=c;var e=OpenLayers.Util.extend({},this.params);e=OpenLayers.Util.extend(e,a);var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getArgs(c));for(var g in e){if(g.toUpperCase()in f){delete e[g]}}var h=OpenLayers.Util.getParameterString(e);h=h.replace(/,/g,"+");if(h!=""){var i=c.charAt(c.length-1);if(i=="&"||i=="?"){d+=h}else{if(c.indexOf("?")==-1){d+="?"+h}else{d+="&"+h}}}return d},getImageFilePath:function(a,b){var c=b==null?this.url:b;if(typeof c=="object"){c=c[Math.floor(Math.random()*c.length)]}var d=c;var e="";var f="";if(a.tilerow<0){e="-"}if(a.tilerow==0){e+="0"}else{e+=Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder}if(a.tilecol<0){f="-"}if(a.tilecol==0){f+="0"}else{f+=Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder}var g="/S"+Math.floor(a.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+e+"/C"+f+"/"+a.tilerow%this.params.tileRowsPerFolder+"_"+a.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;if(this.params.querystring){g+="?"+this.params.querystring}d+=g;return d},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w;var e=c*this.tileSize.h;var f=a.left-b.left;var g=Math.floor(f/d)-this.buffer;var h=f/d-g;var i=-h*this.tileSize.w;var j=b.left+g*d;var k=b.top-a.top+e;var l=Math.floor(k/e)-this.buffer;var m=l-k/e;var n=m*this.tileSize.h;var o=b.top-e*l;return{tilelon:d,tilelat:e,tileoffsetlon:j,tileoffsetlat:o,tileoffsetx:i,tileoffsety:n}},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(a,b,c,d){var e=[];e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(d==null||d.isBaseLayer==null){this.isBaseLayer=this.params.transparent!="true"&&this.params.transparent!=true}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},getURL:function(a){a=this.adjustBounds(a);var b=[a.left,a.bottom,a.right,a.top];var c=this.getImageSize();var d=this.getFullRequestString({mapext:b,imgext:b,map_size:[c.w,c.h],imgx:c.w/2,imgy:c.h/2,imgxy:[c.w,c.h]});return d},getFullRequestString:function(a,b){var c=b==null?this.url:b;var d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);if(c instanceof Array){c=this.selectUrl(e,c)}var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d){if(g.toUpperCase()in f){delete d[g]}}e=OpenLayers.Util.getParameterString(d);var h=c;e=e.replace(/,/g,"+");if(e!=""){var i=c.charAt(c.length-1);if(i=="&"||i=="?"){h+=e}else{if(c.indexOf("?")==-1){h+="?"+e}else{h+="&"+e}}}return h},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",isBaseLayer:true,tileOrigin:null,serverResolutions:null,initialize:function(a,b,c){var d=[];d.push(a,b,{},c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.TMS(this.name,this.url,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution();var c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));var d=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h));var e=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom();var f=this.serviceVersion+"/"+this.layername+"/"+e+"/"+c+"/"+d+"."+this.type;var g=this.url;if(g instanceof Array){g=this.selectUrl(f,g)}return g+f},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=this.extension=="jpg"?"jpeg":this.extension},clone:function(a){if(a==null){a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(a){function h(a,b){a=String(a);var c=[];for(var d=0;d<b;++d){c.push("0")}return c.join("").substring(0,b-a.length)+a}var b=this.map.getResolution();var c=this.maxExtent;var d=this.tileSize;var e=Math.round((a.left-c.left)/(b*d.w));var f=Math.round((a.bottom-c.bottom)/(b*d.h));var g=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom();var i=[this.layername,h(g,2),h(parseInt(e/1e6),3),h(parseInt(e/1e3)%1e3,3),h(parseInt(e)%1e3,3),h(parseInt(f/1e6),3),h(parseInt(f/1e3)%1e3,3),h(parseInt(f)%1e3,3)+"."+this.extension];var j=i.join("/");var k=this.url;if(k instanceof Array){k=this.selectUrl(j,k)}k=k.charAt(k.length-1)=="/"?k:k+"/";return k+j},addTile:function(a,b){var c=this.getURL(a);return new OpenLayers.Tile.Image(this,b,a,c,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if(d==null||!d.isBaseLayer){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize();var c={BBOX:this.encodeBBOX?a.toBBOX():a.toArray(),WIDTH:b.w,HEIGHT:b.h};var d=this.getFullRequestString(c);return d},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a);var c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},getFullRequestString:function(a,b){var c=this.map.getProjection();this.params.SRS=c=="none"?null:c;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:true,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f){this.lzd=c;this.zoomLevels=d;var g=[];g.push(a,b,e,f);OpenLayers.Layer.Grid.prototype.initialize.apply(this,g);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},getZoom:function(){var a=this.map.getZoom();var b=this.map.getMaxExtent();a=a-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2);return a},getURL:function(a){a=this.adjustBounds(a);var b=this.getZoom();var c=this.map.getMaxExtent();var d=this.lzd/Math.pow(2,this.getZoom());var e=Math.floor((a.left-c.left)/d);var f=Math.floor((a.bottom-c.bottom)/d);if(this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels){return this.getFullRequestString({L:b,X:e,Y:f})}else{return OpenLayers.Util.getImagesLocation()+"blank.gif"}},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,initialize:function(a,b,c){if(c&&c.sphericalMercator||this.sphericalMercator){c=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},c)}b=b||this.url;a=a||this.name;var d=[a,b,{},c];OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){if(a==null){a=new OpenLayers.Layer.XYZ(this.name,this.url,this.options)}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getURL:function(a){var b=this.map.getResolution();var c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w));var d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h));var e=this.map.getZoom();var f=Math.pow(2,e);var g=this.url;var h=""+c+d+e;if(g instanceof Array){g=this.selectUrl(h,g)}var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Protocol.SQL.Gears=OpenLayers.Class(OpenLayers.Protocol.SQL,{FID_PREFIX:"__gears_fid__",NULL_GEOMETRY:"__gears_null_geometry__",NULL_FEATURE_STATE:"__gears_null_feature_state__",jsonParser:null,wktParser:null,fidRegExp:null,saveFeatureState:true,typeOfFid:"string",db:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Protocol.SQL.prototype.initialize.apply(this,[a]);this.jsonParser=new OpenLayers.Format.JSON;this.wktParser=new OpenLayers.Format.WKT;this.fidRegExp=new RegExp("^"+this.FID_PREFIX);this.initializeDatabase()},initializeDatabase:function(){this.db=google.gears.factory.create("beta.database");this.db.open(this.databaseName);this.db.execute("CREATE TABLE IF NOT EXISTS "+this.tableName+" (fid TEXT UNIQUE, geometry TEXT, properties TEXT,"+"  state TEXT)")},destroy:function(){this.db.close();this.db=null;this.jsonParser=null;this.wktParser=null;OpenLayers.Protocol.SQL.prototype.destroy.apply(this)},supported:function(){return!!(window.google&&google.gears)},read:function(a){a=OpenLayers.Util.applyDefaults(a,this.options);var b,c=[];var d=this.db.execute("SELECT * FROM "+this.tableName);while(d.isValidRow()){b=this.unfreezeFeature(d);if(this.evaluateFilter(b,a.filter)){if(!a.noFeatureStateReset){b.state=null}c.push(b)}d.next()}d.close();var e=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"read",features:c});if(a&&a.callback){a.callback.call(a.scope,e)}return e},unfreezeFeature:function(a){var b;var c=a.fieldByName("geometry");if(c==this.NULL_GEOMETRY){b=new OpenLayers.Feature.Vector}else{b=this.wktParser.read(c)}b.attributes=this.jsonParser.read(a.fieldByName("properties"));b.fid=this.extractFidFromField(a.fieldByName("fid"));var d=a.fieldByName("state");if(d==this.NULL_FEATURE_STATE){d=null}b.state=d;return b},extractFidFromField:function(a){if(!a.match(this.fidRegExp)&&this.typeOfFid=="number"){a=parseFloat(a)}return a},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=this.createOrUpdate(a);c.requestType="create";if(b&&b.callback){b.callback.call(b.scope,c)}return c},update:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=this.createOrUpdate(a);c.requestType="update";if(b&&b.callback){b.callback.call(b.scope,c)}return c},createOrUpdate:function(a){if(!(a instanceof Array)){a=[a]}var b,c=a.length,d;var e=new Array(c);for(b=0;b<c;b++){d=a[b];var f=this.freezeFeature(d);this.db.execute("REPLACE INTO "+this.tableName+" (fid, geometry, properties, state)"+" VALUES (?, ?, ?, ?)",f);var g=d.clone();g.fid=this.extractFidFromField(f[0]);e[b]=g}return new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,features:e,reqFeatures:a})},freezeFeature:function(a){a.fid=a.fid!=null?""+a.fid:OpenLayers.Util.createUniqueID(this.FID_PREFIX);var b=a.geometry!=null?a.geometry.toString():this.NULL_GEOMETRY;var c=this.jsonParser.write(a.attributes);var d=this.getFeatureStateForFreeze(a);return[a.fid,b,c,d]},getFeatureStateForFreeze:function(a){var b;if(!this.saveFeatureState){b=this.NULL_FEATURE_STATE}else if(this.createdOffline(a)){b=OpenLayers.State.INSERT}else{b=a.state}return b},"delete":function(a,b){if(!(a instanceof Array)){a=[a]}b=OpenLayers.Util.applyDefaults(b,this.options);var c,d,e;for(c=0,d=a.length;c<d;c++){e=a[c];if(this.saveFeatureState&&!this.createdOffline(e)){var f=e.clone();f.fid=e.fid;if(f.geometry){f.geometry.destroy();f.geometry=null}f.state=e.state;this.createOrUpdate(f)}else{this.db.execute("DELETE FROM "+this.tableName+" WHERE fid = ?",[e.fid])}}var g=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"delete",reqFeatures:a});if(b&&b.callback){b.callback.call(b.scope,g)}return g},createdOffline:function(a){return typeof a.fid=="string"&&!!a.fid.match(this.fidRegExp)},commit:function(a,b){function g(a){if(++f<e){a.last=false}this.callUserCallback(b,a)}var c,d=[],e=0,f=0;var h,i=[],j=[],k=[];for(var l=a.length-1;l>=0;l--){h=a[l];switch(h.state){case OpenLayers.State.INSERT:i.push(h);break;case OpenLayers.State.UPDATE:j.push(h);break;case OpenLayers.State.DELETE:k.push(h);break}}if(i.length>0){e++;c=OpenLayers.Util.applyDefaults({callback:g,scope:this},b.create);d.push(this.create(i,c))}if(j.length>0){e++;c=OpenLayers.Util.applyDefaults({callback:g,scope:this},b.update);d.push(this.update(j,c))}if(k.length>0){e++;c=OpenLayers.Util.applyDefaults({callback:g,scope:this},b["delete"]);d.push(this["delete"](k,c))}return d},clear:function(){this.db.execute("DELETE FROM "+this.tableName)},callUserCallback:function(a,b){var c=a[b.requestType];if(c&&c.callback){c.callback.call(c.scope,b)}if(b.last&&a.callback){a.callback.call(a.scope)}},CLASS_NAME:"OpenLayers.Protocol.SQL.Gears"});OpenLayers.Rule=OpenLayers.Class({id:null,name:"default",title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null}this.symbolizer=null},evaluate:function(a){var b=this.getContext(a);var c=true;if(this.minScaleDenominator||this.maxScaleDenominator){var d=a.layer.map.getScale()}if(this.minScaleDenominator){c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)}if(c&&this.maxScaleDenominator){c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)}if(c&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){c=this.filter.evaluate(a)}else{c=this.filter.evaluate(b)}}return c},getContext:function(a){var b=this.context;if(!b){b=a.attributes||a.data}if(typeof this.context=="function"){b=this.context(a)}return b},clone:function(){var a=OpenLayers.Util.extend({},this);a.symbolizer={};for(var b in this.symbolizer){value=this.symbolizer[b];type=typeof value;if(type==="object"){a.symbolizer[b]=OpenLayers.Util.extend({},value)}else if(type==="string"){a.symbolizer[b]=value}}a.filter=this.filter&&this.filter.clone();a.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(a,b){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style["select"]),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style["temporary"]),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(a instanceof OpenLayers.Style){this.styles["default"]=a;this.styles["select"]=a;this.styles["temporary"]=a;this.styles["delete"]=a}else if(typeof a=="object"){for(var c in a){if(a[c]instanceof OpenLayers.Style){this.styles[c]=a[c]}else if(typeof a[c]=="object"){this.styles[c]=new OpenLayers.Style(a[c])}else{this.styles["default"]=new OpenLayers.Style(a);this.styles["select"]=new OpenLayers.Style(a);this.styles["temporary"]=new OpenLayers.Style(a);this.styles["delete"]=new OpenLayers.Style(a);break}}}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles){this.styles[a].destroy()}this.styles=null},createSymbolizer:function(a,b){if(!a){a=new OpenLayers.Feature.Vector}if(!this.styles[b]){b="default"}a.renderIntent=b;var c={};if(this.extendDefault&&b!="default"){c=this.styles["default"].createSymbolizer(a)}return OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[];for(var f in c){e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}))}this.styles[a].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){var b=false;switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var c=a[this.property];var d=this.value;if(!this.matchCase&&typeof c=="string"&&typeof d=="string"){b=c.toUpperCase()==d.toUpperCase()}else{b=c==d}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var c=a[this.property];var d=this.value;if(!this.matchCase&&typeof c=="string"&&typeof d=="string"){b=c.toUpperCase()!=d.toUpperCase()}else{b=c!=d}break;case OpenLayers.Filter.Comparison.LESS_THAN:b=a[this.property]<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:b=a[this.property]>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:b=a[this.property]<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:b=a[this.property]>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:b=a[this.property]>=this.lowerBoundary&&a[this.property]<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var e=new RegExp(this.value,"gi");b=e.test(a[this.property]);break}return b},value2regex:function(a,b,c){if(a=="."){var d="'.' is an unsupported wildCard character for "+"OpenLayers.Filter.Comparison";OpenLayers.Console.error(d);return null}a=a?a:"*";b=b?b:".";c=c?c:"!";this.value=this.value.replace(new RegExp("\\"+c+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+b,"g"),".");this.value=this.value.replace(new RegExp("\\"+a,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+a);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b);return this.value},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(a,b){return b?a:"!."});a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"!*"});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;b<c;b++){var d=a.fid||a.id;if(d==this.fids[b]){return true}}return false},clone:function(){var a=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var b=0,c=this.filters.length;b<c;b++){if(this.filters[b].evaluate(a)==false){return false}}return true;case OpenLayers.Filter.Logical.OR:for(var b=0,c=this.filters.length;b<c;b++){if(this.filters[b].evaluate(a)==true){return true}}return false;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}},clone:function(){var a=[];for(var b=0,c=this.filters.length;b<c;++b){a.push(this.filters[b].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){var b=false;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){c=this.value.toGeometry()}if(a.geometry.intersects(c)){b=true}}break;default:OpenLayers.Console.error(OpenLayers.i18n("filterEvaluateNotImplemented"));break}return b},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a)}},destroy:function(){this.components.length=0;this.components=null},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){var a=[];for(var b=0,c=this.components.length;b<c;b++){a.push(this.components[b].toShortString())}return a.join(",")},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var a=1,b=this.components.length;a<b;a++){this.extendBounds(this.components[a].getBounds())}}},addComponents:function(a){if(!(a instanceof Array)){a=[a]}for(var b=0,c=a.length;b<c;b++){this.addComponent(a[b])}},addComponent:function(a,b){var c=false;if(a){if(this.componentTypes==null||OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME)>-1){if(b!=null&&b<this.components.length){var d=this.components.slice(0,b);var e=this.components.slice(b,this.components.length);d.push(a);this.components=d.concat(e)}else{this.components.push(a)}a.parent=this;this.clearBounds();c=true}}return c},removeComponents:function(a){if(!(a instanceof Array)){a=[a]}for(var b=a.length-1;b>=0;--b){this.removeComponent(a[b])}},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds()},getLength:function(){var a=0;for(var b=0,c=this.components.length;b<c;b++){a+=this.components[b].getLength()}return a},getArea:function(){var a=0;for(var b=0,c=this.components.length;b<c;b++){a+=this.components[b].getArea()}return a},getGeodesicArea:function(a){var b=0;for(var c=0,d=this.components.length;c<d;c++){b+=this.components[c].getGeodesicArea(a)}return b},getCentroid:function(){return this.components.length&&this.components[0].getCentroid()},getGeodesicLength:function(a){var b=0;for(var c=0,d=this.components.length;c<d;c++){b+=this.components[c].getGeodesicLength(a)}return b},move:function(a,b){for(var c=0,d=this.components.length;c<d;c++){this.components[c].move(a,b)}},rotate:function(a,b){for(var c=0,d=this.components.length;c<d;++c){this.components[c].rotate(a,b)}},resize:function(a,b,c){for(var d=0;d<this.components.length;++d){this.components[d].resize(a,b,c)}return this},distanceTo:function(a,b){var c=!(b&&b.edge===false);var d=c&&b&&b.details;var e,f;var g=Number.POSITIVE_INFINITY;for(var h=0,i=this.components.length;h<i;++h){e=this.components[h].distanceTo(a,b);distance=d?e.distance:e;if(distance<g){g=distance;f=e;if(g==0){break}}}return f},equals:function(a){var b=true;if(!a||!a.CLASS_NAME||this.CLASS_NAME!=a.CLASS_NAME){b=false}else if(!(a.components instanceof Array)||a.components.length!=this.components.length){b=false}else{for(var c=0,d=this.components.length;c<d;++c){if(!this.components[c].equals(a.components[c])){b=false;break}}}return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},intersects:function(a){var b=false;for(var c=0,d=this.components.length;c<d;++c){b=a.intersects(this.components[c]);if(b){break}}return b},getVertices:function(a){var b=[];for(var c=0,d=this.components.length;c<d;++c){Array.prototype.push.apply(b,this.components[c].getVertices(a))}return b},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c=!(b&&b.edge===false);var d=c&&b&&b.details;var e,f,g,h,i,j;if(a instanceof OpenLayers.Geometry.Point){f=this.x;g=this.y;h=a.x;i=a.y;e=Math.sqrt(Math.pow(f-h,2)+Math.pow(g-i,2));j=!d?e:{x0:f,y0:g,x1:h,y1:i,distance:e}}else{j=a.distanceTo(this,b);if(d){j={x0:j.x1,y0:j.y1,x1:j.x0,y1:j.y0,distance:j.distance}}}return j},equals:function(a){var b=false;if(a!=null){b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)}return b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b);var d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d);this.y=b.y+c*Math.sin(d);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){c=c==undefined?1:c;this.x=b.x+a*c*(this.x-b.x);this.y=b.y+a*(this.y-b.y);this.clearBounds();return this},intersects:function(a){var b=false;if(a.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.equals(a)}else{b=a.intersects(this)}return b},transform:function(a,b){if(a&&b){OpenLayers.Projection.transform(this,a,b);this.bounds=null}return this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(a,b,c,d){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=a;this.y=b;this.width=c;this.height=d},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var a=2*this.width+2*this.height;return a},getArea:function(){var a=this.width*this.height;return a},CLASS_NAME:"OpenLayers.Geometry.Rectangle"});OpenLayers.Geometry.Surface=OpenLayers.Class(OpenLayers.Geometry,{initialize:function(){OpenLayers.Geometry.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.Surface"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(a,b,c,d){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution();var c=Math.round(this.map.getScale()*1e4)/1e4;var d=Math.round(a.left/b);var e=-Math.round(a.top/b);var f=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;var g=Math.floor(e/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;var h=this.url;if(h instanceof Array){h=this.selectUrl(paramsString,h)}var i=[h,"/",this.params.map,"/",c,"/",this.params.g.replace(/\s/g,"_"),"/def/t",g,"/l",f,"/t",e,"l",d,".",this.extension];return i.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Layer.MapServer.Untiled=OpenLayers.Class(OpenLayers.Layer.MapServer,{singleTile:true,initialize:function(a,b,c,d){OpenLayers.Layer.MapServer.prototype.initialize.apply(this,arguments);var e="The OpenLayers.Layer.MapServer.Untiled class is deprecated and "+"will be removed in 3.0. Instead, you should use the "+"normal OpenLayers.Layer.MapServer class, passing it the option "+"'singleTile' as true.";OpenLayers.Console.warn(e)},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer.Untiled(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.MapServer.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.MapServer.Untiled"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(a,b){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var c=0,d=this.strategies.length;c<d;c++){this.strategies[c].setLayer(this)}}},destroy:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;b<c;b++){a=this.strategies[b];if(a.autoDestroy){a.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},refresh:function(a){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",a)}},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;a++){var c=OpenLayers.Renderer[this.renderers[a]];if(c&&c.prototype.supported()){this.renderer=new c(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}},afterAdd:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;b<c;b++){a=this.strategies[b];if(a.autoActivate){a.activate()}}}},removeMap:function(a){if(this.strategies){var b,c,d;for(c=0,d=this.strategies.length;c<d;c++){b=this.strategies[c];if(b.autoActivate){b.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=true;if(!c){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var e=this.map.getExtent();d=this.renderer.setExtent(e,b);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft}if(!b&&d){for(var f in this.unrenderedFeatures){var g=this.unrenderedFeatures[f];this.drawFeature(g)}}}if(!this.drawn||b||!d){this.drawn=true;var g;for(var f=0,h=this.features.length;f<h;f++){this.renderer.locked=f!==h-1;g=this.features[f];this.drawFeature(g)}}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;if(b!=this.renderer.root.style.display){this.renderer.root.style.display=b}},addFeatures:function(a,b){if(!(a instanceof Array)){a=[a]}var c=!b||!b.silent;if(c){var d={features:a};var e=this.events.triggerEvent("beforefeaturesadded",d);if(e===false){return}a=d.features}for(var f=0,g=a.length;f<g;f++){if(f!=a.length-1){this.renderer.locked=true}else{this.renderer.locked=false}var h=a[f];if(this.geometryType&&!(h.geometry instanceof this.geometryType)){var i=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw i}this.features.push(h);h.layer=this;if(!h.style&&this.style){h.style=OpenLayers.Util.extend({},this.style)}if(c){if(this.events.triggerEvent("beforefeatureadded",{feature:h})===false){continue}this.preFeatureInsert(h)}this.drawFeature(h);if(c){this.events.triggerEvent("featureadded",{feature:h});this.onFeatureInsert(h)}}if(c){this.events.triggerEvent("featuresadded",{features:a})}},removeFeatures:function(a,b){if(!a||a.length===0){return}if(!(a instanceof Array)){a=[a]}if(a===this.features){a=a.slice()}var c=!b||!b.silent;for(var d=a.length-1;d>=0;d--){if(d!=0&&a[d-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var e=a[d];delete this.unrenderedFeatures[e.id];if(c){this.events.triggerEvent("beforefeatureremoved",{feature:e})}this.features=OpenLayers.Util.removeItem(this.features,e);e.layer=null;if(e.geometry){this.renderer.eraseFeatures(e)}if(OpenLayers.Util.indexOf(this.selectedFeatures,e)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,e)}if(c){this.events.triggerEvent("featureremoved",{feature:e})}}if(c){this.events.triggerEvent("featuresremoved",{features:a})}},destroyFeatures:function(a,b){var c=a==undefined;if(c){a=this.features}if(a){this.removeFeatures(a,b);for(var d=a.length-1;d>=0;d--){a[d].destroy()}}},drawFeature:function(a,b){if(!this.drawn){return}if(typeof b!="object"){if(!b&&a.state===OpenLayers.State.DELETE){b="delete"}var c=b||a.renderIntent;b=a.style||this.style;if(!b){b=this.styleMap.createSymbolizer(a,c)}}if(!this.renderer.drawFeature(a,b)){this.unrenderedFeatures[a.id]=a}else{delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null}var b=this.renderer.getFeatureIdFromEvent(a);return this.getFeatureById(b)},getFeatureById:function(a){var b=null;for(var c=0,d=this.features.length;c<d;++c){if(this.features[c].id==a){b=this.features[c];break}}return b},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var a=null;if(this.features&&this.features.length>0){a=new OpenLayers.Bounds;for(var b=0,c=this.features.length;b<c;b++){a.extend(this.features[b].geometry.getBounds())}}return a},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:true,initialize:function(a,b,c,d){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var e="The OpenLayers.Layer.WMS.Untiled class is deprecated and "+"will be removed in 3.0. Instead, you should use the "+"normal OpenLayers.Layer.WMS class, passing it the option "+"'singleTile' as true.";OpenLayers.Console.warn(e)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.WMS.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,EVENT_TYPES:["featureselected","featureunselected","clickout","beforefeatureselected","hoverfeature","outfeature"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.GetFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.features={};this.handlers={};if(this.click){this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectSingle},this.handlerOptions.click||{})}if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))}if(this.hover){this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250}))}},activate:function(){if(!this.active){for(var a in this.handlers){this.handlers[a].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var a in this.handlers){this.handlers[a].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b;for(var c=this.features.length-1;c>=0;--c){b=this.features[c];if(!a||a.except!=b){this.unselect(b)}}},selectSingle:function(a){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,{single:true})},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var c=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));var d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.setModifiers(this.handlers.box.dragHandler.evt);this.request(d)}},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:true,hover:true})},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);this.hoverResponse=null}},request:function(a,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:a});var d=this.protocol.read({maxFeatures:b.single==true?this.maxFeatures:undefined,filter:c,callback:function(c){if(c.code==1){if(c.features.length){if(b.single==true){this.selectBestFeature(c.features,a.getCenterLonLat(),b)}else{this.select(c.features)}}else if(b.hover){this.hoverSelect()}else{this.events.triggerEvent("clickout");if(this.clickout){this.unselectAll()}}}OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});if(b.hover==true){this.hoverResponse=d}},selectBestFeature:function(a,b,c){c=c||{};if(a.length){var d=new OpenLayers.Geometry.Point(b.lon,b.lat);var e,f,g;var h=Number.MAX_VALUE;for(var i=0;i<a.length;++i){e=a[i];if(e.geometry){g=d.distanceTo(e.geometry,{edge:false});if(g<h){h=g;f=e;if(h==0){break}}}}if(c.hover==true){this.hoverSelect(f)}else{this.select(f||a)}}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()}if(!(a instanceof Array)){a=[a]}var b;for(var c=0,d=a.length;c<d;++c){b=a[c];if(this.features[b.fid||b.id]){if(this.modifiers.toggle){this.unselect(this.features[b.fid||b.id])}}else{cont=this.events.triggerEvent("beforefeatureselected",{feature:b});if(cont!==false){this.features[b.fid||b.id]=b;this.events.triggerEvent("featureselected",{feature:b})}}}},hoverSelect:function(a){var b=a?a.fid||a.id:null;var c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;if(c&&c!=b){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});this.hoverFeature=null}if(b&&b!=c){this.events.triggerEvent("hoverfeature",{feature:a});this.hoverFeature=a}},unselect:function(a){delete this.features[a.fid||a.id];this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features){this.unselect(this.features[a])}},setMap:function(a){for(var b in this.handlers){this.handlers[b].setMap(a)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2);var c=a.add(this.clickTolerance/2,-this.clickTolerance/2);var d=this.map.getLonLatFromPixel(b);var e=this.map.getLonLatFromPixel(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesnap","snap","unsnap"],DEFAULTS:{tolerance:10,node:true,edge:true,vertex:true},greedy:true,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.layer){this.setLayer(this.options.layer)}var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);this.setTargets(this.options.targets);if(this.targets.length===0&&this.layer){this.addTargetLayer(this.layer)}this.geoToleranceCache={}},setLayer:function(a){if(this.active){this.deactivate();this.layer=a;this.activate()}else{this.layer=a}},setTargets:function(a){this.targets=[];if(a&&a.length){var b;for(var c=0,d=a.length;c<d;++c){b=a[c];if(b instanceof OpenLayers.Layer.Vector){this.addTargetLayer(b)}else{this.addTarget(b)}}}},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=a.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)},removeTargetLayer:function(a){var b;for(var c=this.targets.length-1;c>=0;--c){b=this.targets[c];if(b.layer===a){this.removeTarget(b)}}},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}this.feature=null;this.point=null;return a},onSketchModified:function(a){this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){var c={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null};var d=false;var e,f;for(var g=0,h=this.targets.length;g<h;++g){f=this.targets[g];e=this.testTarget(f,b);if(e){if(this.greedy){c=e;c.target=f;d=true;break}else{if(e.rank<c.rank||e.rank===c.rank&&e.dist<c.dist){c=e;c.target=f;d=true}}}}if(d){var i=this.events.triggerEvent("beforesnap",{point:a,x:c.x,y:c.y,distance:c.dist,layer:c.target.layer,snapType:this.precedence[c.rank]});if(i!==false){a.x=c.x;a.y=c.y;this.point=a;this.events.triggerEvent("snap",{point:a,snapType:this.precedence[c.rank],layer:c.target.layer,distance:c.dist})}else{d=false}}if(this.point&&!d){a.x=b.x;a.y=b.y;this.point=null;this.events.triggerEvent("unsnap",{point:a})}},testTarget:function(a,b){var c={node:this.getGeoTolerance(a.nodeTolerance),vertex:this.getGeoTolerance(a.vertexTolerance),edge:this.getGeoTolerance(a.edgeTolerance)};var d=Math.max(c.node,c.vertex,c.edge);var e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY};var f=false;var g=a.layer.features;var h,i,j,k,l,m,n;var o=this.precedence.length;var p=new OpenLayers.LonLat(b.x,b.y);for(var q=0,r=g.length;q<r;++q){h=g[q];if(h!==this.feature&&!h._sketch&&h.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(h.attributes))){if(h.atPoint(p,d,d)){for(var s=0,t=Math.min(e.rank+1,o);s<t;++s){i=this.precedence[s];if(a[i]){if(i==="edge"){l=h.geometry.distanceTo(b,{details:true});m=l.distance;if(m<=c[i]&&m<e.dist){e={rank:s,dist:m,x:l.x0,y:l.y0};f=true;break}}else{j=h.geometry.getVertices(i==="node");n=false;for(var u=0,v=j.length;u<v;++u){k=j[u];m=k.distanceTo(b);if(m<=c[i]&&(s<e.rank||s===e.rank&&m<e.dist)){e={rank:s,dist:m,x:k.x,y:k.y};f=true;n=true}}if(n){break}}}}}}}return f?e:null},getGeoTolerance:function(a){var b=this.layer.map.getResolution();if(b!==this.resolution){this.resolution=b;this.geoToleranceCache={}}var c=this.geoToleranceCache[a];if(c===undefined){c=a*b;this.geoToleranceCache[a]=c}return c},destroy:function(){if(this.active){this.deactivate()}delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(a,b){var c=b&&b.version||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=c){var d=OpenLayers.Format.Filter["v"+c.replace(/\./g,"_")];if(!d){throw"Can't find a Filter parser for version "+c}this.parser=new d(this.options)}return this.parser.write(a)},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=this.version;if(!b){b=this.defaultVersion}if(!this.parser||this.parser.VERSION!=b){var c=OpenLayers.Format.Filter["v"+b.replace(/\./g,"_")];if(!c){throw"Can't find a Filter parser for version "+b}this.parser=new c(this.options)}var d=this.parser.read(a);return d},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,namedLayersAsArray:false,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(a,b){var c=b&&b.version||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=c){var d=OpenLayers.Format.SLD["v"+c.replace(/\./g,"_")];if(!d){throw"Can't find a SLD parser for version "+c}this.parser=new d(this.options)}var e=this.parser.write(a);return OpenLayers.Format.XML.prototype.write.apply(this,[e])},read:function(a,b){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var c=a.documentElement;var d=this.version;if(!d){d=c.getAttribute("version");if(!d){d=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=d){var e=OpenLayers.Format.SLD["v"+d.replace(/\./g,"_")];if(!e){throw"Can't find a SLD parser for version "+d}this.parser=new e(this.options)}var f=this.parser.read(a,b);return f},CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:true,initialize:function(a){a=a||{};if(a.extractStyles!==false){a.defaultStyle={externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}}OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b=a.split("\n");var c;var d=[];for(var e=0;e<b.length-1;e++){var f=b[e].replace(/^\s*/,"").replace(/\s*$/,"");if(f.charAt(0)!="#"){if(!c){c=f.split("\t")}else{var g=f.split("\t");var h=new OpenLayers.Geometry.Point(0,0);var i={};var j=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null;var k,l,m,n;var o=false;for(var p=0;p<g.length;p++){if(g[p]){if(c[p]=="point"){var q=g[p].split(",");h.y=parseFloat(q[0]);h.x=parseFloat(q[1]);o=true}else if(c[p]=="lat"){h.y=parseFloat(g[p]);o=true}else if(c[p]=="lon"){h.x=parseFloat(g[p]);o=true}else if(c[p]=="title")i["title"]=g[p];else if(c[p]=="image"||c[p]=="icon"&&j){j["externalGraphic"]=g[p]}else if(c[p]=="iconSize"&&j){var r=g[p].split(",");j["graphicWidth"]=parseFloat(r[0]);j["graphicHeight"]=parseFloat(r[1])}else if(c[p]=="iconOffset"&&j){var s=g[p].split(",");j["graphicXOffset"]=parseFloat(s[0]);j["graphicYOffset"]=parseFloat(s[1])}else if(c[p]=="description"){i["description"]=g[p]}else if(c[p]=="overflow"){i["overflow"]=g[p]}else{i[c[p]]=g[p]}}}if(o){if(this.internalProjection&&this.externalProjection){h.transform(this.externalProjection,this.internalProjection)}var t=new OpenLayers.Feature.Vector(h,i,j);d.push(t)}}}}return d},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(a,b,c){if(!(c&&c.layerOptions&&c.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:function(){return true}},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}if(this.drawing){this.cancel()}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false)}this.layer=null;return true},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures()}this.point=null},finalize:function(a){var b=a?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(b,[this.geometryClone()]);if(a||!this.persist){this.destroyFeature()}},cancel:function(){this.finalize(true)},click:function(a){OpenLayers.Event.stop(a);return false},dblclick:function(a){OpenLayers.Event.stop(a);return false},modifyFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPoint([a])}return a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){if(!this.checkModifiers(a)){return true}if(this.lastDown&&this.lastDown.equals(a.xy)){return true}this.drawing=true;if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature(a.xy)}else{this.modifyFeature(a.xy)}this.lastDown=a.xy;return false},mousemove:function(a){if(this.drawing){this.modifyFeature(a.xy)}return true},mouseup:function(a){if(this.drawing){this.finalize();return false}else{return true}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Layer.GML=OpenLayers.Class(OpenLayers.Layer.Vector,{loaded:false,format:null,formatOptions:null,initialize:function(a,b,c){var d=[];d.push(a,c);OpenLayers.Layer.Vector.prototype.initialize.apply(this,d);this.url=b},setVisibility:function(a,b){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},moveTo:function(a,b,c){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},loadGML:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.url,success:this.requestSuccess,failure:this.requestFailure,scope:this});this.loaded=true}},setUrl:function(a){this.url=a;this.destroyFeatures();this.loaded=false;this.loadGML()},requestSuccess:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}var c={};OpenLayers.Util.extend(c,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){c.externalProjection=this.projection;c.internalProjection=this.map.getProjectionObject()}var d=this.format?new this.format(c):new OpenLayers.Format.GML(c);this.addFeatures(d.read(b));this.events.triggerEvent("loadend")},requestFailure:function(a){OpenLayers.Console.userError(OpenLayers.i18n("errorLoadingGML",{url:this.url}));this.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Layer.GML"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,initialize:function(a,b){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},addNodes:function(a){if(a.length<2){OpenLayers.Console.error("At least two point features have to be added to create"+"a line from");return}var b=new Array(a.length-1);var c,d,e;for(var f=0,g=a.length;f<g;f++){c=a[f];e=c.geometry;if(!e){var h=c.lonlat;e=new OpenLayers.Geometry.Point(h.lon,h.lat)}else if(e.CLASS_NAME!="OpenLayers.Geometry.Point"){OpenLayers.Console.error("Only features with point geometries are supported.");return}if(f>0){var i=this.dataFrom!=null?a[f+this.dataFrom].data||a[f+this.dataFrom].attributes:null;var j=new OpenLayers.Geometry.LineString([d,e]);b[f-1]=new OpenLayers.Feature.Vector(j,i)}d=e}this.addFeatures(b)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(a,b){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(a){var b=this.layers;var c;for(var d=0;d<b.length;d++){c=b[d].getFeatureFromEvent(a);if(c){return c}}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var a;for(var b=0;b<this.map.layers.length;++b){a=this.map.layers[b];if(OpenLayers.Util.indexOf(this.layers,a)!=-1){a.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var a;for(var b=0;b<this.layers.length;++b){a=this.layers[b];if(this.renderer&&a.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(a.renderer)}}},handleChangeLayer:function(a){var b=a.layer;if(a.property=="order"&&OpenLayers.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Layer.WFS=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.Layer.Markers,{isBaseLayer:false,tile:null,ratio:2,DEFAULT_PARAMS:{service:"WFS",version:"1.0.0",request:"GetFeature"},featureClass:null,format:null,formatObject:null,formatOptions:null,vectorMode:true,encodeBBOX:false,extractAttributes:false,initialize:function(a,b,c,d){if(d==undefined){d={}}if(d.featureClass||!OpenLayers.Layer.Vector||!OpenLayers.Feature.Vector){this.vectorMode=false}OpenLayers.Util.extend(d,{reportError:false});var e=[];e.push(a,d);OpenLayers.Layer.Vector.prototype.initialize.apply(this,e);if(!this.renderer||!this.vectorMode){this.vectorMode=false;if(!d.featureClass){d.featureClass=OpenLayers.Feature.WFS}OpenLayers.Layer.Markers.prototype.initialize.apply(this,e)}if(this.params&&this.params.typename&&!this.options.typename){this.options.typename=this.params.typename}if(!this.options.geometry_column){this.options.geometry_column="the_geom"}this.params=OpenLayers.Util.applyDefaults(c,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.url=b},destroy:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments)}if(this.tile){this.tile.destroy()}this.tile=null;this.ratio=null;this.featureClass=null;this.format=null;if(this.formatObject&&this.formatObject.destroy){this.formatObject.destroy()}this.formatObject=null;this.formatOptions=null;this.vectorMode=null;this.encodeBBOX=null;this.extractAttributes=null},setMap:function(a){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);var b={extractAttributes:this.extractAttributes};OpenLayers.Util.extend(b,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){b.externalProjection=this.projection;b.internalProjection=this.map.getProjectionObject()}this.formatObject=this.format?new this.format(b):new OpenLayers.Format.GML(b)}else{OpenLayers.Layer.Markers.prototype.setMap.apply(this,arguments)}},moveTo:function(a,b,c){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments)}if(c){return false}if(b){if(this.vectorMode){this.renderer.clear()}}if(this.options.minZoomLevel){OpenLayers.Console.warn(OpenLayers.i18n("minZoomLevelError"));if(this.map.getZoom()<this.options.minZoomLevel){return null}}if(a==null){a=this.map.getExtent()}var d=this.tile==null;var e=!d&&!this.tile.bounds.containsBounds(a);if(b||d||!c&&e){var f=a.getCenterLonLat();var g=a.getWidth()*this.ratio;var h=a.getHeight()*this.ratio;var i=new OpenLayers.Bounds(f.lon-g/2,f.lat-h/2,f.lon+g/2,f.lat+h/2);var j=this.map.getSize();j.w=j.w*this.ratio;j.h=j.h*this.ratio;var k=new OpenLayers.LonLat(i.left,i.top);var l=this.map.getLayerPxFromLonLat(k);var m=this.getFullRequestString();var n=null;var o=this.params.filter||this.params.FILTER;if(o){n={FILTER:o}}else{n={BBOX:this.encodeBBOX?i.toBBOX():i.toArray()}}if(this.map&&!this.projection.equals(this.map.getProjectionObject())){var p=i.clone();p.transform(this.map.getProjectionObject(),this.projection);if(!o){n.BBOX=this.encodeBBOX?p.toBBOX():p.toArray()}}m+="&"+OpenLayers.Util.getParameterString(n);if(!this.tile){this.tile=new OpenLayers.Tile.WFS(this,l,i,m,j);this.addTileMonitoringHooks(this.tile);this.tile.draw()}else{if(this.vectorMode){this.destroyFeatures();this.renderer.clear()}else{this.clearMarkers()}this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;this.tile=new OpenLayers.Tile.WFS(this,l,i,m,j);this.addTileMonitoringHooks(this.tile);this.tile.draw()}}},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("loadstart")}};a.events.register("loadstart",a,a.onLoadStart);a.onLoadEnd=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("tileloaded");this.layer.events.triggerEvent("loadend")}};a.events.register("loadend",a,a.onLoadEnd);a.events.register("unload",a,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:a})},onMapResize:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.onMapResize.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.onMapResize.apply(this,arguments)}},display:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.display.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.display.apply(this,arguments)}},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a);var c=[b];return OpenLayers.Layer.HTTPRequest.prototype.mergeNewParams.apply(this,c)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WFS(this.name,this.url,this.params,this.options)}if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.clone.apply(this,[a])}else{a=OpenLayers.Layer.Markers.prototype.clone.apply(this,[a])}return a},getFullRequestString:function(a,b){var c=this.projection.getCode()||this.map.getProjection();this.params.SRS=c=="none"?null:c;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},commit:function(){if(!this.writer){var a={};if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.writer=new OpenLayers.Format.WFS(a,this)}var b=this.writer.write(this.features);OpenLayers.Request.POST({url:this.url,data:b,success:this.commitSuccess,failure:this.commitFailure,scope:this})},commitSuccess:function(a){var b=a.responseText;if(b.indexOf("SUCCESS")!=-1){this.commitReport(OpenLayers.i18n("commitSuccess",{response:b}));for(var c=0;c<this.features.length;c++){this.features[c].state=null}}else if(b.indexOf("FAILED")!=-1||b.indexOf("Exception")!=-1){this.commitReport(OpenLayers.i18n("commitFailed",{response:b}))}},commitFailure:function(a){},commitReport:function(a,b){OpenLayers.Console.userError(a)},refresh:function(){if(this.tile){if(this.vectorMode){this.renderer.clear();this.features.length=0}else{this.clearMarkers();this.markers.length=0}this.tile.draw()}},getDataExtent:function(){var a;if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.getDataExtent.apply(this)}else{a=OpenLayers.Layer.Markers.prototype.getDataExtent.apply(this)}return a},setOpacity:function(a){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setOpacity.apply(this,[a])}else{OpenLayers.Layer.Markers.prototype.setOpacity.apply(this,[a])}},CLASS_NAME:"OpenLayers.Layer.WFS"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({moveend:this.update,scope:this});this.layer.events.on({refresh:this.update,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({moveend:this.update,scope:this});this.layer.events.un({refresh:this.update,scope:this})}return a},update:function(a){var b=this.getMapBounds();if(a&&a.force||this.invalidBounds(b)){this.calculateBounds(b);this.resolution=this.layer.map.getResolution();this.triggerRead()}},getMapBounds:function(){var a=this.layer.map.getExtent();if(!this.layer.projection.equals(this.layer.map.getProjectionObject())){a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return a},invalidBounds:function(a){if(!a){a=this.getMapBounds()}var b=!this.bounds||!this.bounds.containsBounds(a);if(!b&&this.resFactor){var c=this.resolution/this.layer.map.getResolution();b=c>=this.resFactor||c<=1/this.resFactor}return b},calculateBounds:function(a){if(!a){a=this.getMapBounds()}var b=a.getCenterLonLat();var c=a.getWidth()*this.ratio;var d=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2)},triggerRead:function(){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read({filter:this.createFilter(),callback:this.merge,scope:this})},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})}return a},merge:function(a){this.layer.destroyFeatures();var b=a.features;if(b&&b.length>0){var c=this.layer.projection;var d=this.layer.map.getProjectionObject();if(!d.equals(c)){var e;for(var f=0,g=b.length;f<g;++f){e=b[f].geometry;if(e){e.transform(c,d)}}}this.layer.addFeatures(b)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[b]);if(this.scope===null){this.scope=this}if(a instanceof Array){this.layers=a;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})}else{this.layer=a}var c={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){c.over=this.overFeature;c.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b=this.layers||[this.layer];var c,d;for(var e=0;e<b.length;++e){c=b[e];for(var f=c.selectedFeatures.length-1;f>=0;--f){d=c.selectedFeatures[f];if(!a||a.except!=d){this.unselect(d)}}}},clickFeature:function(a){if(!this.hover){var b=OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1;if(b){if(this.toggleSelect()){this.unselect(a)}else if(!this.multipleSelect()){this.unselectAll({except:a})}}else{if(!this.multipleSelect()){this.unselectAll({except:a})}this.select(a)}}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(a){var b=a.layer;if(this.hover){if(this.highlightOnly){this.highlight(a)}else if(OpenLayers.Util.indexOf(b.selectedFeatures,a)==-1){this.select(a)}}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(a._lastHighlighter==this.id){if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);if(b){b.highlight(a)}}else{this.unhighlight(a)}}}else{this.unselect(a)}}},highlight:function(a){var b=a.layer;var c=this.events.triggerEvent("beforefeaturehighlighted",{feature:a});if(c!==false){a._prevHighlighter=a._lastHighlighter;a._lastHighlighter=this.id;var d=this.selectStyle||this.renderIntent;b.drawFeature(a,d);this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;a._lastHighlighter=a._prevHighlighter;delete a._prevHighlighter;b.drawFeature(a,a.style||a.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a){var b=this.onBeforeSelect.call(this.scope,a);var c=a.layer;if(b!==false){b=c.events.triggerEvent("beforefeatureselected",{feature:a});if(b!==false){c.selectedFeatures.push(a);this.highlight(a);c.events.triggerEvent("featureselected",{feature:a});this.onSelect.call(this.scope,a)}}},unselect:function(a){var b=a.layer;this.unhighlight(a);OpenLayers.Util.removeItem(b.selectedFeatures,a);b.events.triggerEvent("featureunselected",{feature:a});this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var c=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));var d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);if(!this.multipleSelect()){this.unselectAll()}var e=this.multiple;this.multiple=true;var f=this.layers||[this.layer];var g;for(var h=0;h<f.length;++h){g=f[h];for(var i=0,j=g.features.length;i<j;++i){var k=g.features[i];if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME)>-1){if(d.toGeometry().intersects(k.geometry)){if(OpenLayers.Util.indexOf(g.selectedFeatures,k)==-1){this.select(k)}}}}}this.multiple=e}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};this.readers.ogc["Filter"].apply(this,[a,b]);return b.filter},readers:{ogc:{Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c);if(c.fids.length>0){b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids})}else if(c.filters.length>0){b.filter=c.filters[0]}},FeatureId:function(a,b){var c=a.getAttribute("fid");if(c){b.fids.push(c)}},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(a,c);b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c);b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard");var e=a.getAttribute("singleChar");var f=a.getAttribute("escape");c.value2regex(d,e,f);b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a))},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(a))},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(a))},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units")}}},readSpatial:function(a,b,c){var d=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,d);d.value=d.components[0];delete d.components;b.filters.push(d)},readOgcExpression:function(a){var b={};this.readChildNodes(a,b);var c=b.value;if(!c){c=this.getChildValue(a)}return c},write:function(a){return this.writers.ogc["Filter"].apply(this,[a])},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");var c=a.CLASS_NAME.split(".").pop();if(c=="FeatureId"){for(var d=0;d<a.fids.length;++d){this.writeNode("FeatureId",a.fids[d],b)}}else{this.writeNode(this.getFilterType(a),a,b)}return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){var b=this.createElementNSPlus("ogc:And");var c;for(var d=0;d<a.filters.length;++d){c=a.filters[d];this.writeNode(this.getFilterType(c),c,b)}return b},Or:function(a){var b=this.createElementNSPlus("ogc:Or");var c;for(var d=0;d<a.filters.length;++d){c=a.filters[d];this.writeNode(this.getFilterType(c),c,b)}return b},Not:function(a){var b=this.createElementNSPlus("ogc:Not");var c=a.filters[0];this.writeNode(this.getFilterType(c),c,b);return b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode("Literal",a.lowerBoundary,b);return b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b){throw"Filter writing not supported for rule type: "+a.type}return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var a=0;if(this.components&&this.components.length>1){for(var b=1,c=this.components.length;b<c;b++){a+=this.components[b-1].distanceTo(this.components[b])}}return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");if(!c.equals(a)){b=this.clone().transform(a,c)}}var d=0;if(b.components&&b.components.length>1){var e,f;for(var g=1,h=b.components.length;g<h;g++){e=b.components[g-1];f=b.components[g];d+=OpenLayers.Util.distVincenty({lon:e.x,lat:e.y},{lon:f.x,lat:f.y})}}return d*1e3},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,mode:null,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){this.layer=a;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer());this.virtualStyle.fillOpacity=.3;this.virtualStyle.strokeOpacity=.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[b]);if(!(this.deleteCodes instanceof Array)){this.deleteCodes=[this.deleteCodes]}var c=this;var d={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.selectControl=new OpenLayers.Control.SelectFeature(a,d);var e={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(a,b){c.dragStart.apply(c,[a,b])},onDrag:function(a,b){c.dragVertex.apply(c,[a,b])},onComplete:function(a){c.dragComplete.apply(c,[a])}};this.dragControl=new OpenLayers.Control.DragFeature(a,e);var f={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,f)}},destroy:function(){this.layer=null;this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.selectControl.activate()&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var a=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();if(this.feature&&this.feature.geometry&&this.feature.layer){this.selectControl.unselect.apply(this.selectControl,[this.feature])}this.selectControl.deactivate();this.handlers.keyboard.deactivate();a=true}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){this.feature=a;this.modified=false;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified});this.modified=false},dragStart:function(a,b){if(a!=this.feature&&!a.geometry.parent&&a!=this.dragHandle&&a!=this.radiusHandle){if(this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)!=-1){this.selectControl.clickFeature.apply(this.selectControl,[a]);this.dragControl.overFeature.apply(this.dragControl,[a]);this.dragControl.lastPixel=b;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=b;this.dragControl.handlers.drag.last=b}}},dragVertex:function(a,b){this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=a){this.feature=a}this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b})}else{if(a._index){a.geometry.parent.addComponent(a.geometry,a._index);delete a._index;OpenLayers.Util.removeItem(this.virtualVertices,a);this.vertices.push(a)}else if(a==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else if(a!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b})}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.selectControl.renderIntent)}this.layer.drawFeature(a)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if(this.mode&OpenLayers.Control.ModifyFeature.DRAG){this.collectDragHandle()}if(this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)){this.collectRadiusHandle()}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,b)!=-1){var c=this.dragControl.feature;if(c&&OpenLayers.Util.indexOf(this.vertices,c)!=-1&&!this.dragControl.handlers.drag.dragging&&c.geometry.parent){c.geometry.parent.removeComponent(c.geometry);this.layer.drawFeature(this.feature,this.selectControl.renderIntent);this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){function b(c){var d,e,f,g;if(c.CLASS_NAME=="OpenLayers.Geometry.Point"){e=new OpenLayers.Feature.Vector(c);e._sketch=true;a.vertices.push(e)}else{var h=c.components.length;if(c.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){h-=1}for(d=0;d<h;++d){f=c.components[d];if(f.CLASS_NAME=="OpenLayers.Geometry.Point"){e=new OpenLayers.Feature.Vector(f);e._sketch=true;a.vertices.push(e)}else{b(f)}}if(c.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(d=0,g=c.components.length;d<g-1;++d){var i=c.components[d];var j=c.components[d+1];if(i.CLASS_NAME=="OpenLayers.Geometry.Point"&&j.CLASS_NAME=="OpenLayers.Geometry.Point"){var k=(i.x+j.x)/2;var l=(i.y+j.y)/2;var m=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k,l),null,a.virtualStyle);m.geometry.parent=c;m._index=d+1;m._sketch=true;a.virtualVertices.push(m)}}}}}this.vertices=[];this.virtualVertices=[];var a=this;b.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var a=this.feature.geometry;var b=a.getBounds().getCenterLonLat();var c=new OpenLayers.Geometry.Point(b.lon,b.lat);var d=new OpenLayers.Feature.Vector(c);c.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);a.move(b,c)};d._sketch=true;this.dragHandle=d;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var a=this.feature.geometry;var b=a.getBounds();var c=b.getCenterLonLat();var d=new OpenLayers.Geometry.Point(c.lon,c.lat);var e=new OpenLayers.Geometry.Point(b.right,b.bottom);var f=new OpenLayers.Feature.Vector(e);var g=this.mode&OpenLayers.Control.ModifyFeature.RESIZE;var h=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE;var i=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;e.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var e=this.x-d.x;var f=this.y-d.y;var j=e-b;var k=f-c;if(i){var l=Math.atan2(k,j);var m=Math.atan2(f,e);var n=m-l;n*=180/Math.PI;a.rotate(n,d)}if(g){var o,p;if(h){o=f/k;p=e/j/o}else{var q=Math.sqrt(j*j+k*k);var r=Math.sqrt(e*e+f*f);o=r/q}a.resize(o,d,p)}};f._sketch=true;this.radiusHandle=f;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(a){this.selectControl.setMap(a);this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(a){if(this.components&&this.components.length>2){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}},intersects:function(a){var b=false;var c=a.CLASS_NAME;if(c=="OpenLayers.Geometry.LineString"||c=="OpenLayers.Geometry.LinearRing"||c=="OpenLayers.Geometry.Point"){var d=this.getSortedSegments();var e;if(c=="OpenLayers.Geometry.Point"){e=[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]}else{e=a.getSortedSegments()}var f,g,h,i,j,k,l,m;outer:for(var n=0,o=d.length;n<o;++n){f=d[n];g=f.x1;h=f.x2;i=f.y1;j=f.y2;inner:for(var p=0,q=e.length;p<q;++p){k=e[p];if(k.x1>h){break}if(k.x2<g){continue}l=k.y1;m=k.y2;if(Math.min(l,m)>Math.max(i,j)){continue}if(Math.max(l,m)<Math.min(i,j)){continue}if(OpenLayers.Geometry.segmentsIntersect(f,k)){b=true;break outer}}}}else{b=a.intersects(this)}return b},getSortedSegments:function(){function d(a,b){return a.x1-b.x1}var a=this.components.length-1;var b=new Array(a);for(var c=0;c<a;++c){point1=this.components[c];point2=this.components[c+1];if(point1.x<point2.x){b[c]={x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}}else{b[c]={x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y}}}return b.sort(d)},splitWithSegment:function(a,b){var c=!(b&&b.edge===false);var d=b&&b.tolerance;var e=[];var f=this.getVertices();var g=[];var h=[];var i=false;var j,k,l;var m,n,o;var p={point:true,tolerance:d};var q=null;for(var r=0,s=f.length-2;r<=s;++r){j=f[r];g.push(j.clone());k=f[r+1];o={x1:j.x,y1:j.y,x2:k.x,y2:k.y};l=OpenLayers.Geometry.segmentsIntersect(a,o,p);if(l instanceof OpenLayers.Geometry.Point){if(l.x===a.x1&&l.y===a.y1||l.x===a.x2&&l.y===a.y2||l.equals(j)||l.equals(k)){n=true}else{n=false}if(n||c){if(!l.equals(h[h.length-1])){h.push(l.clone())}if(r===0){if(l.equals(j)){continue}}if(l.equals(k)){continue}i=true;if(!l.equals(j)){g.push(l)}e.push(new OpenLayers.Geometry.LineString(g));g=[l.clone()]}}}if(i){g.push(k.clone());e.push(new OpenLayers.Geometry.LineString(g))}if(h.length>0){var t=a.x1<a.x2?1:-1;var u=a.y1<a.y2?1:-1;q={lines:e,points:h.sort(function(a,b){return t*a.x-t*b.x||u*a.y-u*b.y})}}return q},split:function(a,b){var c=null;var d=b&&b.mutual;var e,f,g,h;if(a instanceof OpenLayers.Geometry.LineString){var i=this.getVertices();var j,k,l,m,n,o;var p=[];g=[];for(var q=0,r=i.length-2;q<=r;++q){j=i[q];k=i[q+1];l={x1:j.x,y1:j.y,x2:k.x,y2:k.y};h=h||[a];if(d){p.push(j.clone())}for(var s=0;s<h.length;++s){m=h[s].splitWithSegment(l,b);if(m){n=m.lines;if(n.length>0){n.unshift(s,1);Array.prototype.splice.apply(h,n);s+=n.length-2}if(d){for(var t=0,u=m.points.length;t<u;++t){o=m.points[t];if(!o.equals(j)){p.push(o);g.push(new OpenLayers.Geometry.LineString(p));if(o.equals(k)){p=[]}else{p=[o.clone()]}}}}}}}if(d&&g.length>0&&p.length>0){p.push(k.clone());g.push(new OpenLayers.Geometry.LineString(p))}}else{c=a.splitWith(this,b)}if(h&&h.length>1){f=true}else{h=[]}if(g&&g.length>1){e=true}else{g=[]}if(f||e){if(d){c=[g,h]}else{c=h}}return c},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){var b;if(a===true){b=[this.components[0],this.components[this.components.length-1]]}else if(a===false){b=this.components.slice(1,this.components.length-1)}else{b=this.components.slice()}return b},distanceTo:function(a,b){var c=!(b&&b.edge===false);var d=c&&b&&b.details;var e,f={};var g=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){var h=this.getSortedSegments();var i=a.x;var j=a.y;var k;for(var l=0,m=h.length;l<m;++l){k=h[l];e=OpenLayers.Geometry.distanceToSegment(a,k);if(e.distance<g){g=e.distance;f=e;if(g===0){break}}else{if(k.x2>i&&(j>k.y1&&j<k.y2||j<k.y1&&j>k.y2)){break}}}if(d){f={distance:f.distance,x0:f.x,y0:f.y,x1:i,y1:j}}else{f=f.distance}}else if(a instanceof OpenLayers.Geometry.LineString){var n=this.getSortedSegments();var o=a.getSortedSegments();var p,q,r,s,t;var u=o.length;var v={point:true};outer:for(var l=0,m=n.length;l<m;++l){p=n[l];s=p.x1;t=p.y1;for(var w=0;w<u;++w){q=o[w];r=OpenLayers.Geometry.segmentsIntersect(p,q,v);if(r){g=0;f={distance:0,x0:r.x,y0:r.y,x1:r.x,y1:r.y};break outer}else{e=OpenLayers.Geometry.distanceToSegment({x:s,y:t},q);if(e.distance<g){g=e.distance;f={distance:g,x0:s,y0:t,x1:e.x,y1:e.y}}}}}if(!d){f=f.distance}if(g!==0){if(p){e=a.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),b);var x=d?e.distance:e;if(x<g){if(d){f={distance:g,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0}}else{f=x}}}}}else{f=a.distanceTo(this,b);if(d){f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0}}}return f},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=[];if(this.extractTracks){var c=a.getElementsByTagName("trk");for(var d=0,e=c.length;d<e;d++){var f={};if(this.extractAttributes){f=this.parseAttributes(c[d])}var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,"trkseg");for(var h=0,i=g.length;h<i;h++){var j=this.extractSegment(g[h],"trkpt");b.push(new OpenLayers.Feature.Vector(j,f))}}}if(this.extractRoutes){var k=a.getElementsByTagName("rte");for(var l=0,m=k.length;l<m;l++){var f={};if(this.extractAttributes){f=this.parseAttributes(k[l])}var n=this.extractSegment(k[l],"rtept");b.push(new OpenLayers.Feature.Vector(n,f))}}if(this.extractWaypoints){var o=a.getElementsByTagName("wpt");for(var p=0,e=o.length;p<e;p++){var f={};if(this.extractAttributes){f=this.parseAttributes(o[p])}var q=new OpenLayers.Geometry.Point(o[p].getAttribute("lon"),o[p].getAttribute("lat"));b.push(new OpenLayers.Feature.Vector(q,f))}}if(this.internalProjection&&this.externalProjection){for(var r=0,s=b.length;r<s;r++){b[r].geometry.transform(this.externalProjection,this.internalProjection)}}return b},extractSegment:function(a,b){var c=this.getElementsByTagNameNS(a,a.namespaceURI,b);var d=[];for(var e=0,f=c.length;e<f;e++){d.push(new OpenLayers.Geometry.Point(c[e].getAttribute("lon"),c[e].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(d)},parseAttributes:function(a){var b={};var c=a.firstChild;while(c){if(c.nodeType==1){var d=c.firstChild;if(d.nodeType==3||d.nodeType==4){name=c.prefix?c.nodeName.split(":")[1]:c.nodeName;if(name!="trkseg"&&name!="rtept"){b[name]=d.nodeValue}}}c=c.nextSibling}return b},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(a,b){var c=false;var d=this.components.pop();if(b!=null||!a.equals(d)){c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var e=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]);return c},removeComponent:function(a){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b])}},move:function(a,b){for(var c=0,d=this.components.length;c<d-1;c++){this.components[c].move(a,b)}},rotate:function(a,b){for(var c=0,d=this.components.length;c<d-1;++c){this.components[c].rotate(a,b)}},resize:function(a,b,c){for(var d=0,e=this.components.length;d<e-1;++d){this.components[d].resize(a,b,c)}return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d-1;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},getCentroid:function(){if(this.components&&this.components.length>2){var a=0;var b=0;for(var c=0;c<this.components.length-1;c++){var d=this.components[c];var e=this.components[c+1];a+=(d.x+e.x)*(d.x*e.y-e.x*d.y);b+=(d.y+e.y)*(d.x*e.y-e.x*d.y)}var f=-1*this.getArea();var g=a/(6*f);var h=b/(6*f)}return new OpenLayers.Geometry.Point(g,h)},getArea:function(){var a=0;if(this.components&&this.components.length>2){var b=0;for(var c=0,d=this.components.length;c<d-1;c++){var e=this.components[c];var f=this.components[c+1];b+=(e.x+f.x)*(f.y-e.y)}a=-b/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");if(!c.equals(a)){b=this.clone().transform(a,c)}}var d=0;var e=b.components&&b.components.length;if(e>2){var f,g;for(var h=0;h<e-1;h++){f=b.components[h];g=b.components[h+1];d+=OpenLayers.Util.rad(g.x-f.x)*(2+Math.sin(OpenLayers.Util.rad(f.y))+Math.sin(OpenLayers.Util.rad(g.y)))}d=d*6378137*6378137/2}return d},containsPoint:function(a){function f(a,b,c,d,e){return((b-d)*a+(d*c-b*e))/(c-e)}var b=OpenLayers.Number.limitSigDigs;var c=14;var d=b(a.x,c);var e=b(a.y,c);var g=this.components.length-1;var h,i,j,k,l,m,n,o;var p=0;for(var q=0;q<g;++q){h=this.components[q];j=b(h.x,c);k=b(h.y,c);i=this.components[q+1];l=b(i.x,c);m=b(i.y,c);if(k==m){if(e==k){if(j<=l&&d>=j&&d<=l||j>=l&&d<=j&&d>=l){p=-1;break}}continue}n=b(f(e,j,k,l,m),c);if(n==d){if(k<m&&e>=k&&e<=m||k>m&&e<=k&&e>=m){p=-1;break}}if(n<=d){continue}if(j!=l&&(n<Math.min(j,l)||n>Math.max(j,l))){continue}if(k<m&&e>=k&&e<m||k>m&&e<k&&e>=m){++p}}var r=p==-1?1:!!(p&1);return r},intersects:function(a){var b=false;if(a.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(a)}else if(a.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=a.intersects(this)}else if(a.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a])}else{for(var c=0,d=a.components.length;c<d;++c){b=a.components[c].intersects(this);if(b){break}}}return b},getVertices:function(a){return a===true?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},split:function(a,b){var c=null;var d=b&&b.mutual;var e,f,g,h,i;var j=[];var k=[a];for(var l=0,m=this.components.length;l<m;++l){f=this.components[l];h=false;for(var n=0;n<k.length;++n){e=f.split(k[n],b);if(e){if(d){g=e[0];for(var o=0,p=g.length;o<p;++o){if(o===0&&j.length){j[j.length-1].addComponent(g[o])}else{j.push(new OpenLayers.Geometry.MultiLineString([g[o]]))}}h=true;e=e[1]}if(e.length){e.unshift(n,1);Array.prototype.splice.apply(k,e);break}}}if(!h){if(j.length){j[j.length-1].addComponent(f.clone())}else{j=[new OpenLayers.Geometry.MultiLineString(f.clone())]}}}if(j&&j.length>1){h=true}else{j=[]}if(k&&k.length>1){i=true}else{k=[]}if(h||i){if(d){c=[j,k]}else{c=k}}return c},splitWith:function(a,b){var c=null;var d=b&&b.mutual;var e,f,g,h,i,j,k;if(a instanceof OpenLayers.Geometry.LineString){k=[];j=[a];for(var l=0,m=this.components.length;l<m;++l){i=false;f=this.components[l];for(var n=0;n<j.length;++n){e=j[n].split(f,b);if(e){if(d){g=e[0];if(g.length){g.unshift(n,1);Array.prototype.splice.apply(j,g);n+=g.length-2}e=e[1];if(e.length===0){e=[f.clone()]}}for(var o=0,p=e.length;o<p;++o){if(o===0&&k.length){k[k.length-1].addComponent(e[o])}else{k.push(new OpenLayers.Geometry.MultiLineString([e[o]]))}}i=true}}if(!i){if(k.length){k[k.length-1].addComponent(f.clone())}else{k=[new OpenLayers.Geometry.MultiLineString([f.clone()])]}}}}else{c=a.split(this)}if(j&&j.length>1){h=true}else{j=[]}if(k&&k.length>1){i=true}else{k=[]}if(h||i){if(d){c=[j,k]}else{c=k}}return c},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(a,b,c){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature()},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiLineString([a])}return a},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy)){return false}if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature(a.xy)}else if(this.lastUp==null||!this.lastUp.equals(a.xy)){this.addPoint(a.xy)}this.mouseDown=true;this.lastDown=a.xy;this.drawing=true;return false},mousemove:function(a){if(this.drawing){if(this.mouseDown&&this.freehandMode(a)){this.addPoint(a.xy)}else{this.modifyFeature(a.xy)}}return true},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){this.removePoint();this.finalize()}else{if(this.lastUp==null){this.addPoint(a.xy)}this.lastUp=a.xy}return false}return true},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesplit","split","aftersplit"],layer:null,source:null,sourceOptions:null,tolerance:null,edge:true,deferDelete:false,mutual:true,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.source){this.setSource(this.options.source)}},setSource:function(a){if(this.active){this.deactivate();if(this.handler){this.handler.destroy();delete this.handler}this.source=a;this.activate()}else{this.source=a}},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(!this.source){if(!this.handler){this.handler=new OpenLayers.Handler.Path(this,{done:function(a){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(a)})}},{layerOptions:this.sourceOptions})}this.handler.activate()}else if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.source&&this.source.events){this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}return a},onSketchComplete:function(a){this.feature=null;return!this.considerSplit(a.feature)},afterFeatureModified:function(a){if(a.modified){var b=a.feature;if(b.geometry instanceof OpenLayers.Geometry.LineString||b.geometry instanceof OpenLayers.Geometry.MultiLineString){this.feature=a.feature;this.considerSplit(a.feature)}}},removeByGeometry:function(a,b){for(var c=0,d=a.length;c<d;++c){if(a[c].geometry===b){a.splice(c,1);break}}},isEligible:function(a){return a.state!==OpenLayers.State.DELETE&&(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString)&&this.feature!==a&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes))},considerSplit:function(a){sourceSplit=false;targetSplit=false;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes)){var b=this.layer&&this.layer.features||[];var c,d,e,f;var g=[],h=[];var i=this.layer===this.source&&this.mutual;var j={edge:this.edge,tolerance:this.tolerance,mutual:i};var k=[a.geometry];var l,m;var n,o;for(var p=0,q=b.length;p<q;++p){l=b[p];if(this.isEligible(l)){m=[l.geometry];for(var r=0;r<k.length;++r){n=k[r];for(var s=0;s<m.length;++s){c=m[s];if(n.getBounds().intersectsBounds(c.getBounds())){d=n.split(c,j);if(d){f=this.events.triggerEvent("beforesplit",{source:a,target:l});if(f!==false){if(i){o=d[0];if(o.length>1){o.unshift(r,1);Array.prototype.splice.apply(k,o);r+=o.length-3}d=d[1]}if(d.length>1){d.unshift(s,1);Array.prototype.splice.apply(m,d);s+=d.length-3}}}}}}if(m&&m.length>1){this.geomsToFeatures(l,m);this.events.triggerEvent("split",{original:l,features:m});Array.prototype.push.apply(g,m);h.push(l);targetSplit=true}}}if(k&&k.length>1){this.geomsToFeatures(a,k);this.events.triggerEvent("split",{original:a,features:k});Array.prototype.push.apply(g,k);h.push(a);sourceSplit=true}if(sourceSplit||targetSplit){if(this.deferDelete){var t,u=[];for(var p=0,q=h.length;p<q;++p){t=h[p];if(t.state===OpenLayers.State.INSERT){u.push(t)}else{t.state=OpenLayers.State.DELETE;this.layer.drawFeature(t)}}this.layer.destroyFeatures(u,{silent:true});for(var p=0,q=g.length;p<q;++p){g[p].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(h,{silent:true})}this.layer.addFeatures(g,{silent:true});this.events.triggerEvent("aftersplit",{source:a,features:g})}}return sourceSplit},geomsToFeatures:function(a,b){var c=a.clone();delete c.geometry;var d;for(var e=0,f=b.length;e<f;++e){d=c.clone();d.geometry=b[e];d.state=OpenLayers.State.INSERT;b[e]=d}},destroy:function(){if(this.active){this.deactivate()}OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var a=0;if(this.components&&this.components.length>0){a+=Math.abs(this.components[0].getArea());for(var b=1,c=this.components.length;b<c;b++){a-=Math.abs(this.components[b].getArea())}}return a},getGeodesicArea:function(a){var b=0;if(this.components&&this.components.length>0){b+=Math.abs(this.components[0].getGeodesicArea(a));for(var c=1,d=this.components.length;c<d;c++){b-=Math.abs(this.components[c].getGeodesicArea(a))}}return b},containsPoint:function(a){var b=this.components.length;var c=false;if(b>0){c=this.components[0].containsPoint(a);if(c!==1){if(c&&b>1){var d;for(var e=1;e<b;++e){d=this.components[e].containsPoint(a);if(d){if(d===1){c=1}else{c=false}break}}}}}return c},intersects:function(a){var b=false;var c,d;if(a.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(a)}else if(a.CLASS_NAME=="OpenLayers.Geometry.LineString"||a.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(c=0,d=this.components.length;c<d;++c){b=a.intersects(this.components[c]);if(b){break}}if(!b){for(c=0,d=a.components.length;c<d;++c){b=this.containsPoint(a.components[c]);if(b){break}}}}else{for(c=0,d=a.components.length;c<d;++c){b=this.intersects(a.components[c]);if(b){break}}}if(!b&&a.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var e=this.components[0];for(c=0,d=e.components.length;c<d;++c){b=a.containsPoint(e.components[c]);if(b){break}}}return b},distanceTo:function(a,b){var c=!(b&&b.edge===false);var d;if(!c&&this.intersects(a)){d=0}else{d=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])}return d},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-1/2);if(d){e+=d/180*Math.PI}var f,g,h;var i=[];for(var j=0;j<c;++j){f=e+j*2*Math.PI/c;g=a.x+b*Math.cos(f);h=a.y+b*Math.sin(f);i.push(new OpenLayers.Geometry.Point(g,h))}var k=new OpenLayers.Geometry.LinearRing(i);return new OpenLayers.Geometry.Polygon([k])};OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,"point");var c=this.getElementsByTagNameNS(a,this.geons,"lat");var d=this.getElementsByTagNameNS(a,this.geons,"long");var e=this.getElementsByTagNameNS(a,this.georssns,"line");var f=this.getElementsByTagNameNS(a,this.georssns,"polygon");var g=this.getElementsByTagNameNS(a,this.georssns,"where");var h=this.getElementsByTagNameNS(a,this.georssns,"box");if(b.length>0||c.length>0&&d.length>0){var i;if(b.length>0){i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/);if(i.length!=2){i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{i=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)]}var j=new OpenLayers.Geometry.Point(parseFloat(i[1]),parseFloat(i[0]))}else if(e.length>0){var k=OpenLayers.String.trim(this.concatChildValues(e[0])).split(/\s+/);var l=[];var b;for(var m=0,n=k.length;m<n;m+=2){b=new OpenLayers.Geometry.Point(parseFloat(k[m+1]),parseFloat(k[m]));l.push(b)}j=new OpenLayers.Geometry.LineString(l)}else if(f.length>0){var k=OpenLayers.String.trim(this.concatChildValues(f[0])).split(/\s+/);var l=[];var b;for(var m=0,n=k.length;m<n;m+=2){b=new OpenLayers.Geometry.Point(parseFloat(k[m+1]),parseFloat(k[m]));l.push(b)}j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}else if(g.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var o=this.gmlParser.parseFeature(g[0]);j=o.geometry}else if(h.length>0){var k=OpenLayers.String.trim(h[0].firstChild.nodeValue).split(/\s+/);var l=[];var b;if(k.length>3){b=new OpenLayers.Geometry.Point(parseFloat(k[1]),parseFloat(k[0]));l.push(b);b=new OpenLayers.Geometry.Point(parseFloat(k[1]),parseFloat(k[2]));l.push(b);b=new OpenLayers.Geometry.Point(parseFloat(k[3]),parseFloat(k[2]));l.push(b);b=new OpenLayers.Geometry.Point(parseFloat(k[3]),parseFloat(k[0]));l.push(b);b=new OpenLayers.Geometry.Point(parseFloat(k[1]),parseFloat(k[0]));l.push(b)}j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}if(j&&this.internalProjection&&this.externalProjection){j.transform(this.externalProjection,this.internalProjection)}return j},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a);var c=this.getChildValue(a,"*","title",this.featureTitle);var d=this.getChildValue(a,"*","description",this.getChildValue(a,"*","content",this.getChildValue(a,"*","summary",this.featureDescription)));var e=this.getChildValue(a,"*","link");if(!e){try{e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")}catch(f){e=null}}var g=this.getChildValue(a,"*","id",null);var h={title:c,description:d,link:e};var i=new OpenLayers.Feature.Vector(b,h);i.fid=g;return i},getChildValue:function(a,b,c,d){var e;var f=this.getElementsByTagNameNS(a,b,c);if(f&&f[0]&&f[0].firstChild&&f[0].firstChild.nodeValue){e=f[0].firstChild.nodeValue}else{e=d==undefined?"":d}return e},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=null;b=this.getElementsByTagNameNS(a,"*","item");if(b.length==0){b=this.getElementsByTagNameNS(a,"*","entry")}var c=b.length;var d=new Array(c);for(var e=0;e<c;e++){d[e]=this.createFeatureFromItem(b[e])}return d},write:function(a){var b;if(a instanceof Array){b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;c<d;c++){b.appendChild(this.createFeatureXML(a[c]))}}else{b=this.createFeatureXML(a)}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry);var c=this.createElementNS(this.rssns,"item");var d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:""));c.appendChild(d);c.appendChild(e);if(a.attributes.link){var f=this.createElementNS(this.rssns,"link");f.appendChild(this.createTextNode(a.attributes.link));c.appendChild(f)}for(var g in a.attributes){if(g=="link"||g=="title"||g=="description"){continue}var h=this.createTextNode(a.attributes[g]);var i=g;if(g.search(":")!=-1){i=g.split(":")[1]}var j=this.createElementNS(this.featureNS,"feature:"+i);j.appendChild(h);c.appendChild(j)}c.appendChild(b);return c},buildGeometryNode:function(a){if(this.internalProjection&&this.externalProjection){a=a.clone();a.transform(this.internalProjection,this.externalProjection)}var b;if(a.CLASS_NAME=="OpenLayers.Geometry.Polygon"){b=this.createElementNS(this.georssns,"georss:polygon");b.appendChild(this.buildCoordinatesNode(a.components[0]))}else if(a.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=this.createElementNS(this.georssns,"georss:line");b.appendChild(this.buildCoordinatesNode(a))}else if(a.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.createElementNS(this.georssns,"georss:point");b.appendChild(this.buildCoordinatesNode(a))}else{throw"Couldn't parse "+a.CLASS_NAME}return b},buildCoordinatesNode:function(a){var b=null;if(a.components){b=a.components}var c;if(b){var d=b.length;var e=new Array(d);for(var f=0;f<d;f++){e[f]=b[f].y+" "+b[f].x}c=e.join(" ")}else{c=a.y+" "+a.x}return this.createTextNode(c)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:true,extractStyles:false,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){this.features=[];this.styles={};this.fetched={};var b={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(a,b)},parseData:function(a,b){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var c=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var d=0,e=c.length;d<e;++d){var f=c[d];var g=this.getElementsByTagNameNS(a,"*",f);if(g.length==0){continue}switch(f.toLowerCase()){case"link":case"networklink":this.parseLinks(g,b);break;case"style":if(this.extractStyles){this.parseStyles(g,b)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(g,b)}break;case"placemark":this.parseFeatures(g,b);break}}return this.features},parseLinks:function(a,b){if(b.depth>=this.maxDepth){return false}var c=OpenLayers.Util.extend({},b);c.depth++;for(var d=0,e=a.length;d<e;d++){var f=this.parseProperty(a[d],"*","href");if(f&&!this.fetched[f]){this.fetched[f]=true;var g=this.fetchLink(f);if(g){this.parseData(g,c)}}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:false});if(b){return b.responseText}},parseStyles:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=this.parseStyle(a[c]);if(e){styleName=(b.styleBaseUrl||"")+"#"+e.id;this.styles[styleName]=e}}},parseStyle:function(a){var b={};var c=["LineStyle","PolyStyle","IconStyle","BalloonStyle"];var d,e,f,g;for(var h=0,i=c.length;h<i;++h){d=c[h];styleTypeNode=this.getElementsByTagNameNS(a,"*",d)[0];if(!styleTypeNode){continue}switch(d.toLowerCase()){case"linestyle":var j=this.parseProperty(styleTypeNode,"*","color");if(j){var k=j.toString().match(this.regExes.kmlColor);var l=k[1];b["strokeOpacity"]=parseInt(l,16)/255;var m=k[2];var n=k[3];var o=k[4];b["strokeColor"]="#"+o+n+m}var p=this.parseProperty(styleTypeNode,"*","width");if(p){b["strokeWidth"]=p};case"polystyle":var j=this.parseProperty(styleTypeNode,"*","color");if(j){var k=j.toString().match(this.regExes.kmlColor);var l=k[1];b["fillOpacity"]=parseInt(l,16)/255;var m=k[2];var n=k[3];var o=k[4];b["fillColor"]="#"+o+n+m}var q=this.parseProperty(styleTypeNode,"*","fill");if(q=="0"){b["fillColor"]="none"}break;case"iconstyle":var r=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1);var p=32*r;var s=32*r;var t=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];if(t){var u=this.parseProperty(t,"*","href");if(u){var v=this.parseProperty(t,"*","w");var w=this.parseProperty(t,"*","h");var x="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(u,x)&&!v&&!w){v=64;w=64;r=r/2}v=v||w;w=w||v;if(v){p=parseInt(v)*r}if(w){s=parseInt(w)*r}var k=u.match(this.regExes.kmlIconPalette);if(k){var y=k[1];var z=k[2];var A=this.parseProperty(t,"*","x");var B=this.parseProperty(t,"*","y");var C=A?A/32:0;var D=B?7-B/32:7;var E=D*8+C;u="http://maps.google.com/mapfiles/kml/pal"+y+"/icon"+E+z}b["graphicOpacity"]=1;b["externalGraphic"]=u}}var F=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0];if(F){var A=parseFloat(F.getAttribute("x"));var B=parseFloat(F.getAttribute("y"));var G=F.getAttribute("xunits");if(G=="pixels"){b["graphicXOffset"]=-A*r}else if(G=="insetPixels"){b["graphicXOffset"]=-p+A*r}else if(G=="fraction"){b["graphicXOffset"]=-p*A}var H=F.getAttribute("yunits");if(H=="pixels"){b["graphicYOffset"]=-s+B*r+1}else if(H=="insetPixels"){b["graphicYOffset"]=-(B*r)+1}else if(H=="fraction"){b["graphicYOffset"]=-s*(1-B)+1}}b["graphicWidth"]=p;b["graphicHeight"]=s;break;case"balloonstyle":var I=OpenLayers.Util.getXmlNodeValue(styleTypeNode);if(I){b["balloonStyle"]=I.replace(this.regExes.straightBracket,"${$1}")}break;default:}}if(!b["strokeColor"]&&b["fillColor"]){b["strokeColor"]=b["fillColor"]}var J=a.getAttribute("id");if(J&&b){b.id=J}return b},parseStyleMaps:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];var f=this.getElementsByTagNameNS(e,"*","Pair");var g=e.getAttribute("id");for(var h=0,i=f.length;h<i;h++){var j=f[h];var k=this.parseProperty(j,"*","key");var l=this.parseProperty(j,"*","styleUrl");if(l&&k=="normal"){this.styles[(b.styleBaseUrl||"")+"#"+g]=this.styles[(b.styleBaseUrl||"")+l]}if(l&&k=="highlight"){};}}},parseFeatures:function(a,b){var c=new Array(a.length);for(var d=0,e=a.length;d<e;d++){var f=a[d];var g=this.parseFeature.apply(this,[f]);if(g){if(this.extractStyles&&g.attributes&&g.attributes.styleUrl){g.style=this.getStyle(g.attributes.styleUrl,b)}if(this.extractStyles){var h=this.getElementsByTagNameNS(f,"*","Style")[0];if(h){var i=this.parseStyle(h);if(i){g.style=OpenLayers.Util.extend(g.style,i)}}}c[d]=g}else{throw"Bad Placemark: "+d}}this.features=this.features.concat(c)},parseFeature:function(a){var b=["MultiGeometry","Polygon","LineString","Point"];var c,d,e,f;for(var g=0,h=b.length;g<h;++g){c=b[g];this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns;d=this.getElementsByTagNameNS(a,this.internalns,c);if(d.length>0){var f=this.parseGeometry[c.toLowerCase()];if(f){e=f.apply(this,[d[0]]);if(this.internalProjection&&this.externalProjection){e.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:c}))}break}}var i;if(this.extractAttributes){i=this.parseAttributes(a)}var j=new OpenLayers.Feature.Vector(e,i);var k=a.getAttribute("id")||a.getAttribute("name");if(k!=null){j.fid=k}return j},getStyle:function(a,b){var c=OpenLayers.Util.removeTail(a);var d=OpenLayers.Util.extend({},b);d.depth++;d.styleBaseUrl=c;if(!this.styles[a]&&!OpenLayers.String.startsWith(a,"#")&&d.depth<=this.maxDepth&&!this.fetched[c]){var e=this.fetchLink(c);if(e){this.parseData(e,d)}}var f=OpenLayers.Util.extend({},this.styles[a]);return f},parseGeometry:{point:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"coordinates");var c=[];if(b.length>0){var d=b[0].firstChild.nodeValue;d=d.replace(this.regExes.removeSpace,"");c=d.split(",")}var e=null;if(c.length>1){if(c.length==2){c[2]=null}e=new OpenLayers.Geometry.Point(c[0],c[1],c[2])}else{throw"Bad coordinate string: "+d}return e},linestring:function(a,b){var c=this.getElementsByTagNameNS(a,this.internalns,"coordinates");var d=null;if(c.length>0){var e=this.getChildValue(c[0]);e=e.replace(this.regExes.trimSpace,"");e=e.replace(this.regExes.trimComma,",");var f=e.split(this.regExes.splitSpace);var g=f.length;var h=new Array(g);var i,j;for(var k=0;k<g;++k){i=f[k].split(",");j=i.length;if(j>1){if(i.length==2){i[2]=null}h[k]=new OpenLayers.Geometry.Point(i[0],i[1],i[2])}else{throw"Bad LineString point coordinates: "+f[k]}}if(g){if(b){d=new OpenLayers.Geometry.LinearRing(h)}else{d=new OpenLayers.Geometry.LineString(h)}}else{throw"Bad LineString coordinates: "+e}}return d},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"LinearRing");var c=b.length;var d=new Array(c);if(c>0){var e;for(var f=0,g=b.length;f<g;++f){e=this.parseGeometry.linestring.apply(this,[b[f],true]);if(e){d[f]=e}else{throw"Bad LinearRing geometry: "+f}}}return new OpenLayers.Geometry.Polygon(d)},multigeometry:function(a){var b,c;var d=[];var e=a.childNodes;for(var f=0,g=e.length;f<g;++f){b=e[f];if(b.nodeType==1){var h=b.prefix?b.nodeName.split(":")[1]:b.nodeName;var c=this.parseGeometry[h.toLowerCase()];if(c){d.push(c.apply(this,[b]))}}}return new OpenLayers.Geometry.Collection(d)}},parseAttributes:function(a){var b={};var c=a.getElementsByTagName("ExtendedData");if(c.length){b=this.parseExtendedData(c[0])}var d,e,f;var g=a.childNodes;for(var h=0,i=g.length;h<i;++h){d=g[h];if(d.nodeType==1){e=d.childNodes;if(e.length==1||e.length==3){var f;switch(e.length){case 1:f=e[0];break;case 3:default:f=e[1];break}if(f.nodeType==3||f.nodeType==4){var j=d.prefix?d.nodeName.split(":")[1]:d.nodeName;var k=OpenLayers.Util.getXmlNodeValue(f);if(k){k=k.replace(this.regExes.trimSpace,"");b[j]=k}}}}}return b},parseExtendedData:function(a){var b={};var c=a.getElementsByTagName("Data");for(var d=0,e=c.length;d<e;d++){var f=c[d];var g=f.getAttribute("name");var h={};var i=f.getElementsByTagName("value");if(i.length){h["value"]=this.getChildValue(i[0])}var j=f.getElementsByTagName("displayName");if(j.length){h["displayName"]=this.getChildValue(j[0])}b[g]=h}return b},parseProperty:function(a,b,c){var d;var e=this.getElementsByTagNameNS(a,b,c);try{d=OpenLayers.Util.getXmlNodeValue(e[0])}catch(f){d=null}return d},write:function(a){if(!(a instanceof Array)){a=[a]}var b=this.createElementNS(this.kmlns,"kml");var c=this.createFolderXML();for(var d=0,e=a.length;d<e;++d){c.appendChild(this.createPlacemarkXML(a[d]))}b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var a=this.createElementNS(this.kmlns,"name");var b=this.createTextNode(this.foldersName);a.appendChild(b);var c=this.createElementNS(this.kmlns,"description");var d=this.createTextNode(this.foldersDesc);c.appendChild(d);var e=this.createElementNS(this.kmlns,"Folder");e.appendChild(a);e.appendChild(c);return e},createPlacemarkXML:function(a){var b=this.createElementNS(this.kmlns,"name");var c=a.attributes.name?a.attributes.name:a.id;b.appendChild(this.createTextNode(c));var d=this.createElementNS(this.kmlns,"description");var e=a.attributes.description?a.attributes.description:this.placemarksDesc;d.appendChild(this.createTextNode(e));var f=this.createElementNS(this.kmlns,"Placemark");if(a.fid!=null){f.setAttribute("id",a.fid)}f.appendChild(b);f.appendChild(d);var g=this.buildGeometryNode(a.geometry);f.appendChild(g);return f},buildGeometryNode:function(a){if(this.internalProjection&&this.externalProjection){a=a.clone();a.transform(this.internalProjection,this.externalProjection)}var b=a.CLASS_NAME;var c=b.substring(b.lastIndexOf(".")+1);var d=this.buildGeometry[c.toLowerCase()];var e=null;if(d){e=d.apply(this,[a])}return e},buildGeometry:{point:function(a){var b=this.createElementNS(this.kmlns,"Point");b.appendChild(this.buildCoordinatesNode(a));return b},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(a){var b=this.createElementNS(this.kmlns,"LineString");b.appendChild(this.buildCoordinatesNode(a));return b},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(a){var b=this.createElementNS(this.kmlns,"LinearRing");b.appendChild(this.buildCoordinatesNode(a));return b},polygon:function(a){var b=this.createElementNS(this.kmlns,"Polygon");var c=a.components;var d,e,f;for(var g=0,h=c.length;g<h;++g){f=g==0?"outerBoundaryIs":"innerBoundaryIs";d=this.createElementNS(this.kmlns,f);e=this.buildGeometry.linearring.apply(this,[c[g]]);d.appendChild(e);b.appendChild(d)}return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(a){var b=this.createElementNS(this.kmlns,"MultiGeometry");var c;for(var d=0,e=a.components.length;d<e;++d){c=this.buildGeometryNode.apply(this,[a.components[d]]);if(c){b.appendChild(c)}}return b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.kmlns,"coordinates");var c;var d=a.components;if(d){var e;var f=d.length;var g=new Array(f);for(var h=0;h<f;++h){e=d[h];g[h]=e.x+","+e.y}c=g.join(" ")}else{c=a.x+","+a.y}var i=this.createTextNode(c);b.appendChild(i);return b},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(a){var b={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};b=OpenLayers.Util.extend(b,a);var c={};for(var d=0;d<b.interestingTagsExclude.length;d++){c[b.interestingTagsExclude[d]]=true}b.interestingTagsExclude=c;var e={};for(var d=0;d<b.areaTags.length;d++){e[b.areaTags[d]]=true}b.areaTags=e;OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=this.getNodes(a);var c=this.getWays(a);var d=new Array(c.length);for(var e=0;e<c.length;e++){var f=new Array(c[e].nodes.length);var g=this.isWayArea(c[e])?1:0;for(var h=0;h<c[e].nodes.length;h++){var i=b[c[e].nodes[h]];var j=new OpenLayers.Geometry.Point(i.lon,i.lat);j.osm_id=parseInt(c[e].nodes[h]);f[h]=j;i.used=true}var k=null;if(g){k=new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(f))}else{k=new OpenLayers.Geometry.LineString(f)}if(this.internalProjection&&this.externalProjection){k.transform(this.externalProjection,this.internalProjection)}var l=new OpenLayers.Feature.Vector(k,c[e].tags);l.osm_id=parseInt(c[e].id);l.fid="way."+l.osm_id;d[e]=l}for(var m in b){var i=b[m];if(!i.used||this.checkTags){var n=null;if(this.checkTags){var o=this.getTags(i.node,true);if(i.used&&!o[1]){continue}n=o[0]}else{n=this.getTags(i.node)}var l=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(i["lon"],i["lat"]),n);if(this.internalProjection&&this.externalProjection){l.geometry.transform(this.externalProjection,this.internalProjection)}l.osm_id=parseInt(m);l.fid="node."+l.osm_id;d.push(l)}i.node=null}return d},getNodes:function(a){var b=a.getElementsByTagName("node");var c={};for(var d=0;d<b.length;d++){var e=b[d];var f=e.getAttribute("id");c[f]={lat:e.getAttribute("lat"),lon:e.getAttribute("lon"),node:e}}return c},getWays:function(a){var b=a.getElementsByTagName("way");var c=[];for(var d=0;d<b.length;d++){var e=b[d];var f={id:e.getAttribute("id")};f.tags=this.getTags(e);var g=e.getElementsByTagName("nd");f.nodes=new Array(g.length);for(var h=0;h<g.length;h++){f.nodes[h]=g[h].getAttribute("ref")}c.push(f)}return c},getTags:function(a,b){var c=a.getElementsByTagName("tag");var d={};var e=false;for(var f=0;f<c.length;f++){var g=c[f].getAttribute("k");d[g]=c[f].getAttribute("v");if(b){if(!this.interestingTagsExclude[g]){e=true}}}return b?[d,e]:d},isWayArea:function(a){var b=false;var c=false;if(a.nodes[0]==a.nodes[a.nodes.length-1]){b=true}if(this.checkTags){for(var d in a.tags){if(this.areaTags[d]){c=true;break}}}return b&&(this.checkTags?c:true)},write:function(a){if(!(a instanceof Array)){a=[a]}this.osm_id=1;this.created_nodes={};var b=this.createElementNS(null,"osm");b.setAttribute("version","0.5");b.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;c>=0;c--){var d=this.createFeatureNodes(a[c]);for(var e=0;e<d.length;e++){b.appendChild(d[e])}}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureNodes:function(a){var b=[];var c=a.geometry.CLASS_NAME;var d=c.substring(c.lastIndexOf(".")+1);d=d.toLowerCase();var e=this.createXML[d];if(e){b=e.apply(this,[a])}return b},createXML:{point:function(a){var b=null;var c=a.geometry?a.geometry:a;var d=false;if(a.osm_id){b=a.osm_id;if(this.created_nodes[b]){d=true}}else{b=-this.osm_id;this.osm_id++}if(d){e=this.created_nodes[b]}else{var e=this.createElementNS(null,"node")}this.created_nodes[b]=e;e.setAttribute("id",b);e.setAttribute("lon",c.x);e.setAttribute("lat",c.y);if(a.attributes){this.serializeTags(a,e)}this.setState(a,e);return d?[]:[e]},linestring:function(a){var b=[];var c=a.geometry;if(a.osm_id){id=a.osm_id}else{id=-this.osm_id;this.osm_id++}var d=this.createElementNS(null,"way");d.setAttribute("id",id);for(var e=0;e<c.components.length;e++){var f=this.createXML["point"].apply(this,[c.components[e]]);if(f.length){f=f[0];var g=f.getAttribute("id");b.push(f)}else{g=c.components[e].osm_id;f=this.created_nodes[g]}this.setState(a,f);var h=this.createElementNS(null,"nd");h.setAttribute("ref",g);d.appendChild(h)}this.serializeTags(a,d);b.push(d);return b},polygon:function(a){var b=OpenLayers.Util.extend({area:"yes"},a.attributes);var c=new OpenLayers.Feature.Vector(a.geometry.components[0],b);c.osm_id=a.osm_id;return this.createXML["linestring"].apply(this,[c])}},serializeTags:function(a,b){for(var c in a.attributes){var d=this.createElementNS(null,"tag");d.setAttribute("k",c);d.setAttribute("v",a.attributes[c]);b.appendChild(d)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:c="modify";case OpenLayers.State.DELETE:c="delete"}if(c){b.setAttribute("action",c)}}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(a,b,c){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPolygon([a])}return a},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation]);var c=[new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"})];this.addControls(c)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(a){this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(a){if(a.requesttype=="feature"){this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys);this.addCoordSys(b.filtercoordsys,a.filterCoordSys);if(a.polygon){b.isspatial=true;b.spatialfilter.polygon=a.polygon}else if(a.envelope){b.isspatial=true;b.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0};this.parseEnvelope(b.spatialfilter.envelope,a.envelope)}}else if(a.requesttype=="image"){this.request.get_feature=null;var c=this.request.get_image.properties;this.parseEnvelope(c.envelope,a.envelope);this.addLayers(c.layerlist,a.layers);this.addImageSize(c.imagesize,a.tileSize);this.addCoordSys(c.featurecoordsys,a.featureCoordSys);this.addCoordSys(c.filtercoordsys,a.filterCoordSys)}else{this.request=null}}OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(a,b){if(b&&b.length==4){a.minx=b[0];a.miny=b[1];a.maxx=b[2];a.maxy=b[3]}},addLayers:function(a,b){for(var c=0,d=b.length;c<d;c++){a.push(b[c])}},addImageSize:function(a,b){if(b!==null){a.width=b.w;a.height=b.h;a.printwidth=b.w;a.printheight=b.h}},addCoordSys:function(a,b){if(typeof b=="string"){a.id=parseInt(b);a.string=b}else if(typeof b=="object"&&b.proj!==null){a.id=b.proj.srsProjNumber;a.string=b.proj.srsCode}else{a=b}},iserror:function(a){var b=null;if(!a){b=this.response.error!==""}else{a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);var c=a.documentElement.getElementsByTagName("ERROR");b=c!==null&&c.length>0}return b},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=null;if(a&&a.documentElement){if(a.documentElement.nodeName=="ARCXML"){b=a.documentElement}else{b=a.documentElement.getElementsByTagName("ARCXML")[0]}}if(!b){var c,d;try{c=a.firstChild.nodeValue;d=a.firstChild.childNodes[1].firstChild.nodeValue}catch(e){}throw{message:"Error parsing the ArcXML request",error:c,source:d}}var f=this.parseResponse(b);return f},write:function(a){if(!a){a=this.request}var b=this.createElementNS("","ARCXML");b.setAttribute("version","1.1");var c=this.createElementNS("","REQUEST");if(a.get_image!=null){var d=this.createElementNS("","GET_IMAGE");c.appendChild(d);var e=this.createElementNS("","PROPERTIES");d.appendChild(e);var f=a.get_image.properties;if(f.featurecoordsys!=null){var g=this.createElementNS("","FEATURECOORDSYS");e.appendChild(g);if(f.featurecoordsys.id===0){g.setAttribute("string",f.featurecoordsys["string"])}else{g.setAttribute("id",f.featurecoordsys.id)}}if(f.filtercoordsys!=null){var h=this.createElementNS("","FILTERCOORDSYS");e.appendChild(h);if(f.filtercoordsys.id===0){h.setAttribute("string",f.filtercoordsys.string)}else{h.setAttribute("id",f.filtercoordsys.id)}}if(f.envelope!=null){var i=this.createElementNS("","ENVELOPE");e.appendChild(i);i.setAttribute("minx",f.envelope.minx);i.setAttribute("miny",f.envelope.miny);i.setAttribute("maxx",f.envelope.maxx);i.setAttribute("maxy",f.envelope.maxy)}var j=this.createElementNS("","IMAGESIZE");e.appendChild(j);j.setAttribute("height",f.imagesize.height);j.setAttribute("width",f.imagesize.width);if(f.imagesize.height!=f.imagesize.printheight||f.imagesize.width!=f.imagesize.printwidth){j.setAttribute("printheight",f.imagesize.printheight);j.setArrtibute("printwidth",f.imagesize.printwidth)}if(f.background!=null){var k=this.createElementNS("","BACKGROUND");e.appendChild(k);k.setAttribute("color",f.background.color.r+","+f.background.color.g+","+f.background.color.b);if(f.background.transcolor!==null){k.setAttribute("transcolor",f.background.transcolor.r+","+f.background.transcolor.g+","+f.background.transcolor.b)}}if(f.layerlist!=null&&f.layerlist.length>0){var l=this.createElementNS("","LAYERLIST");e.appendChild(l);for(var m=0;m<f.layerlist.length;m++){var n=this.createElementNS("","LAYERDEF");l.appendChild(n);n.setAttribute("id",f.layerlist[m].id);n.setAttribute("visible",f.layerlist[m].visible);if(typeof f.layerlist[m].query=="object"){var o=f.layerlist[m].query;if(o.where.length<0){continue}var p=null;if(typeof o.spatialfilter=="boolean"&&o.spatialfilter){p=this.createElementNS("","SPATIALQUERY")}else{p=this.createElementNS("","QUERY")}p.setAttribute("where",o.where);if(typeof o.accuracy=="number"&&o.accuracy>0){p.setAttribute("accuracy",o.accuracy)}if(typeof o.featurelimit=="number"&&o.featurelimit<2e3){p.setAttribute("featurelimit",o.featurelimit)}if(typeof o.subfields=="string"&&o.subfields!="#ALL#"){p.setAttribute("subfields",o.subfields)}if(typeof o.joinexpression=="string"&&o.joinexpression.length>0){p.setAttribute("joinexpression",o.joinexpression)}if(typeof o.jointables=="string"&&o.jointables.length>0){p.setAttribute("jointables",o.jointables)}n.appendChild(p)}if(typeof f.layerlist[m].renderer=="object"){this.addRenderer(n,f.layerlist[m].renderer)}}}}else if(a.get_feature!=null){var d=this.createElementNS("","GET_FEATURES");d.setAttribute("outputmode","newxml");d.setAttribute("checkesc","true");if(a.get_feature.geometry){d.setAttribute("geometry",a.get_feature.geometry)}else{d.setAttribute("geometry","false")}if(a.get_feature.compact){d.setAttribute("compact",a.get_feature.compact)}if(a.get_feature.featurelimit=="number"){d.setAttribute("featurelimit",a.get_feature.featurelimit)}d.setAttribute("globalenvelope","true");c.appendChild(d);if(a.get_feature.layer!=null&&a.get_feature.layer.length>0){var q=this.createElementNS("","LAYER");q.setAttribute("id",a.get_feature.layer);d.appendChild(q)}var r=a.get_feature.query;if(r!=null){var s=null;if(r.isspatial){s=this.createElementNS("","SPATIALQUERY")}else{s=this.createElementNS("","QUERY")}d.appendChild(s);if(typeof r.accuracy=="number"){s.setAttribute("accuracy",r.accuracy)}if(r.featurecoordsys!=null){var t=this.createElementNS("","FEATURECOORDSYS");if(r.featurecoordsys.id==0){t.setAttribute("string",r.featurecoordsys.string)}else{t.setAttribute("id",r.featurecoordsys.id)}s.appendChild(t)}if(r.filtercoordsys!=null){var u=this.createElementNS("","FILTERCOORDSYS");if(r.filtercoordsys.id===0){u.setAttribute("string",r.filtercoordsys.string)}else{u.setAttribute("id",r.filtercoordsys.id)}s.appendChild(u)}if(r.buffer>0){var v=this.createElementNS("","BUFFER");v.setAttribute("distance",r.buffer);s.appendChild(v)}if(r.isspatial){var w=this.createElementNS("","SPATIALFILTER");w.setAttribute("relation",r.spatialfilter.relation);s.appendChild(w);if(r.spatialfilter.envelope){var x=this.createElementNS("","ENVELOPE");x.setAttribute("minx",r.spatialfilter.envelope.minx);x.setAttribute("miny",r.spatialfilter.envelope.miny);x.setAttribute("maxx",r.spatialfilter.envelope.maxx);x.setAttribute("maxy",r.spatialfilter.envelope.maxy);w.appendChild(x)}else if(typeof r.spatialfilter.polygon=="object"){w.appendChild(this.writePolygonGeometry(r.spatialfilter.polygon))}}if(r.where!=null&&r.where.length>0){s.setAttribute("where",r.where)}}}b.appendChild(c);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},addGroupRenderer:function(a,b){var c=this.createElementNS("","GROUPRENDERER");a.appendChild(c);for(var d=0;d<b.length;d++){var e=b[d];this.addRenderer(c,e)}},addRenderer:function(a,b){if(b instanceof Array){this.addGroupRenderer(a,b)}else{var c=this.createElementNS("",b.type.toUpperCase()+"RENDERER");a.appendChild(c);if(c.tagName=="VALUEMAPRENDERER"){this.addValueMapRenderer(c,b)}else if(c.tagName=="VALUEMAPLABELRENDERER"){this.addValueMapLabelRenderer(c,b)}else if(c.tagName=="SIMPLELABELRENDERER"){this.addSimpleLabelRenderer(c,b)}else if(c.tagName=="SCALEDEPENDENTRENDERER"){this.addScaleDependentRenderer(c,b)}}},addScaleDependentRenderer:function(a,b){if(typeof b.lower=="string"||typeof b.lower=="number"){a.setAttribute("lower",b.lower)}if(typeof b.upper=="string"||typeof b.upper=="number"){a.setAttribute("upper",b.upper)}this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(a,b){a.setAttribute("lookupfield",b.lookupfield);a.setAttribute("labelfield",b.labelfield);if(typeof b.exacts=="object"){for(var c=0,d=b.exacts.length;c<d;c++){var e=b.exacts[c];var f=this.createElementNS("","EXACT");if(typeof e.value=="string"){f.setAttribute("value",e.value)}if(typeof e.label=="string"){f.setAttribute("label",e.label)}if(typeof e.method=="string"){f.setAttribute("method",e.method)}a.appendChild(f);if(typeof e.symbol=="object"){var g=null;if(e.symbol.type=="text"){g=this.createElementNS("","TEXTSYMBOL")}if(g!=null){var h=this.fontStyleKeys;for(var i=0,j=h.length;i<j;i++){var k=h[i];if(e.symbol[k]){g.setAttribute(k,e.symbol[k])}}f.appendChild(g)}}}}},addValueMapRenderer:function(a,b){a.setAttribute("lookupfield",b.lookupfield);if(typeof b.ranges=="object"){for(var c=0,d=b.ranges.length;c<d;c++){var e=b.ranges[c];var f=this.createElementNS("","RANGE");f.setAttribute("lower",e.lower);f.setAttribute("upper",e.upper);a.appendChild(f);if(typeof e.symbol=="object"){var g=null;if(e.symbol.type=="simplepolygon"){g=this.createElementNS("","SIMPLEPOLYGONSYMBOL")}if(g!=null){if(typeof e.symbol.boundarycolor=="string"){g.setAttribute("boundarycolor",e.symbol.boundarycolor)}if(typeof e.symbol.fillcolor=="string"){g.setAttribute("fillcolor",e.symbol.fillcolor)}if(typeof e.symbol.filltransparency=="number"){g.setAttribute("filltransparency",e.symbol.filltransparency)}f.appendChild(g)}}}}else if(typeof b.exacts=="object"){for(var h=0,i=b.exacts.length;h<i;h++){var j=b.exacts[h];var k=this.createElementNS("","EXACT");if(typeof j.value=="string"){k.setAttribute("value",j.value)}if(typeof j.label=="string"){k.setAttribute("label",j.label)}if(typeof j.method=="string"){k.setAttribute("method",j.method)}a.appendChild(k);if(typeof j.symbol=="object"){var g=null;if(j.symbol.type=="simplemarker"){g=this.createElementNS("","SIMPLEMARKERSYMBOL")}if(g!=null){if(typeof j.symbol.antialiasing=="string"){g.setAttribute("antialiasing",j.symbol.antialiasing)}if(typeof j.symbol.color=="string"){g.setAttribute("color",j.symbol.color)}if(typeof j.symbol.outline=="string"){g.setAttribute("outline",j.symbol.outline)}if(typeof j.symbol.overlap=="string"){g.setAttribute("overlap",j.symbol.overlap)}if(typeof j.symbol.shadow=="string"){g.setAttribute("shadow",j.symbol.shadow)}if(typeof j.symbol.transparency=="number"){g.setAttribute("transparency",j.symbol.transparency)}if(typeof j.symbol.usecentroid=="string"){g.setAttribute("usecentroid",j.symbol.usecentroid)}if(typeof j.symbol.width=="number"){g.setAttribute("width",j.symbol.width)}k.appendChild(g)}}}}},addSimpleLabelRenderer:function(a,b){a.setAttribute("field",b.field);var c=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"];for(var d=0,e=c.length;d<e;d++){var f=c[d];if(b[f]){a.setAttribute(f,b[f])}}if(b.symbol.type=="text"){var g=b.symbol;var h=this.createElementNS("","TEXTSYMBOL");a.appendChild(h);var c=this.fontStyleKeys;for(var d=0,e=c.length;d<e;d++){var f=c[d];if(g[f]){h.setAttribute(f,b[f])}}}},writePolygonGeometry:function(a){if(!(a instanceof OpenLayers.Geometry.Polygon)){throw{message:"Cannot write polygon geometry to ArcXML with an "+a.CLASS_NAME+" object.",geometry:a}}var b=this.createElementNS("","POLYGON");for(var c=0,d=a.components.length;c<d;c++){var e=a.components[c];var f=this.createElementNS("","RING");for(var g=0,h=e.components.length;g<h;g++){var i=e.components[g];var j=this.createElementNS("","POINT");j.setAttribute("x",i.x);j.setAttribute("y",i.y);f.appendChild(j)}b.appendChild(f)}return b},parseResponse:function(a){if(typeof a=="string"){var b=new OpenLayers.Format.XML;a=b.read(a)}var c=new OpenLayers.Format.ArcXML.Response;var d=a.getElementsByTagName("ERROR");if(d!=null&&d.length>0){c.error=this.getChildValue(d,"Unknown error.")}else{var e=a.getElementsByTagName("RESPONSE");if(e==null||e.length==0){c.error="No RESPONSE tag found in ArcXML response.";return c}var f=e[0].firstChild.nodeName;if(f=="#text"){f=e[0].firstChild.nextSibling.nodeName}if(f=="IMAGE"){var g=a.getElementsByTagName("ENVELOPE");var h=a.getElementsByTagName("OUTPUT");if(g==null||g.length==0){c.error="No ENVELOPE tag found in ArcXML response."}else if(h==null||h.length==0){c.error="No OUTPUT tag found in ArcXML response."}else{var i=this.parseAttributes(g[0]);var j=this.parseAttributes(h[0]);if(typeof j.type=="string"){c.image={envelope:i,output:{type:j.type,data:this.getChildValue(h[0])}}}else{c.image={envelope:i,output:j}}}}else if(f=="FEATURES"){var k=e[0].getElementsByTagName("FEATURES");var l=k[0].getElementsByTagName("FEATURECOUNT");c.features.featurecount=l[0].getAttribute("count");if(c.features.featurecount>0){var m=k[0].getElementsByTagName("ENVELOPE");c.features.envelope=this.parseAttributes(m[0],typeof 0);var n=k[0].getElementsByTagName("FEATURE");for(var o=0;o<n.length;o++){var p=new OpenLayers.Feature.Vector;var q=n[o].getElementsByTagName("FIELD");for(var r=0;r<q.length;r++){var s=q[r].getAttribute("name");var t=q[r].getAttribute("value");p.attributes[s]=t}var u=n[o].getElementsByTagName("POLYGON");if(u.length>0){var v=u[0].getElementsByTagName("RING");var w=[];for(var x=0;x<v.length;x++){var y=[];y.push(this.parsePointGeometry(v[x]));var z=v[x].getElementsByTagName("HOLE");for(var A=0;A<z.length;A++){y.push(this.parsePointGeometry(z[A]))}z=null;w.push(new OpenLayers.Geometry.Polygon(y));y=null}v=null;if(w.length==1){p.geometry=w[0]}else{p.geometry=new OpenLayers.Geometry.MultiPolygon(w)}}c.features.feature.push(p)}}}else{c.error="Unidentified response type."}}return c},parseAttributes:function(a,b){var c={};for(var d=0;d<a.attributes.length;d++){if(b=="number"){c[a.attributes[d].nodeName]=parseFloat(a.attributes[d].nodeValue)}else{c[a.attributes[d].nodeName]=a.attributes[d].nodeValue}}return c},parsePointGeometry:function(a){var b=[];var c=a.getElementsByTagName("COORDS");if(c.length>0){var d=this.getChildValue(c[0]);d=d.split(/;/);for(var e=0;e<d.length;e++){var f=d[e].split(/ /);b.push(new OpenLayers.Geometry.Point(parseFloat(f[0]),parseFloat(f[1])))}c=null}else{var g=a.getElementsByTagName("POINT");if(g.length>0){for(var h=0;h<g.length;h++){b.push(new OpenLayers.Geometry.Point(parseFloat(g[h].getAttribute("x")),parseFloat(g[h].getAttribute("y"))))}}g=null}return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(a){var b={get_image:{properties:{background:null,draw:true,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:false},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:false,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,b)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(a){var b={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,b)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}var b=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName);var c=[];for(var d=0;d<b.length;d++){var e=this.parseFeature(b[d]);if(e){c.push(e)}}return c},parseFeature:function(a){var b=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope","Box"];var c,d,e,f;for(var g=0;g<b.length;++g){c=b[g];d=this.getElementsByTagNameNS(a,this.gmlns,c);if(d.length>0){var f=this.parseGeometry[c.toLowerCase()];if(f){e=f.apply(this,[d[0]]);if(this.internalProjection&&this.externalProjection){e.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:c}))}break}}var h;if(this.extractAttributes){h=this.parseAttributes(a)}var i=new OpenLayers.Feature.Vector(e,h);i.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};var j=a.firstChild;var k;while(j){if(j.nodeType==1){k=j.getAttribute("fid")||j.getAttribute("id");if(k){break}}j=j.nextSibling}i.fid=k;return i},parseGeometry:{point:function(a){var b,c;var d=[];var b=this.getElementsByTagNameNS(a,this.gmlns,"pos");if(b.length>0){c=b[0].firstChild.nodeValue;c=c.replace(this.regExes.trimSpace,"");d=c.split(this.regExes.splitSpace)}if(d.length==0){b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates");if(b.length>0){c=b[0].firstChild.nodeValue;c=c.replace(this.regExes.removeSpace,"");d=c.split(",")}}if(d.length==0){b=this.getElementsByTagNameNS(a,this.gmlns,"coord");if(b.length>0){var e=this.getElementsByTagNameNS(b[0],this.gmlns,"X");var f=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");if(e.length>0&&f.length>0){d=[e[0].firstChild.nodeValue,f[0].firstChild.nodeValue]}}}if(d.length==2){d[2]=null}if(this.xy){return new OpenLayers.Geometry.Point(d[0],d[1],d[2])}else{return new OpenLayers.Geometry.Point(d[1],d[0],d[2])}},multipoint:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Point");var c=[];if(b.length>0){var d;for(var e=0;e<b.length;++e){d=this.parseGeometry.point.apply(this,[b[e]]);if(d){c.push(d)}}}return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(a,b){var c,d;var e=[];var f=[];c=this.getElementsByTagNameNS(a,this.gmlns,"posList");if(c.length>0){d=this.getChildValue(c[0]);d=d.replace(this.regExes.trimSpace,"");e=d.split(this.regExes.splitSpace);var g=parseInt(c[0].getAttribute("dimension"));var h,i,j,k;for(var l=0;l<e.length/g;++l){h=l*g;i=e[h];j=e[h+1];k=g==2?null:e[h+2];if(this.xy){f.push(new OpenLayers.Geometry.Point(i,j,k))}else{f.push(new OpenLayers.Geometry.Point(j,i,k))}}}if(e.length==0){c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates");if(c.length>0){d=this.getChildValue(c[0]);d=d.replace(this.regExes.trimSpace,"");d=d.replace(this.regExes.trimComma,",");var m=d.split(this.regExes.splitSpace);for(var l=0;l<m.length;++l){e=m[l].split(",");if(e.length==2){e[2]=null}if(this.xy){f.push(new OpenLayers.Geometry.Point(e[0],e[1],e[2]))}else{f.push(new OpenLayers.Geometry.Point(e[1],e[0],e[2]))}}}}var n=null;if(f.length!=0){if(b){n=new OpenLayers.Geometry.LinearRing(f)}else{n=new OpenLayers.Geometry.LineString(f)}}return n},multilinestring:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LineString");var c=[];if(b.length>0){var d;for(var e=0;e<b.length;++e){d=this.parseGeometry.linestring.apply(this,[b[e]]);if(d){c.push(d)}}}return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing");var c=[];if(b.length>0){var d;for(var e=0;e<b.length;++e){d=this.parseGeometry.linestring.apply(this,[b[e],true]);if(d){c.push(d)}}}return new OpenLayers.Geometry.Polygon(c)},multipolygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Polygon");var c=[];if(b.length>0){var d;for(var e=0;e<b.length;++e){d=this.parseGeometry.polygon.apply(this,[b[e]]);if(d){c.push(d)}}}return new OpenLayers.Geometry.MultiPolygon(c)},envelope:function(a){var b=[];var c;var d;var e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(e.length>0){var f=[];if(e.length>0){c=e[0].firstChild.nodeValue;c=c.replace(this.regExes.trimSpace,"");f=c.split(this.regExes.splitSpace)}if(f.length==2){f[2]=null}if(this.xy){var g=new OpenLayers.Geometry.Point(f[0],f[1],f[2])}else{var g=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}}var h=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(h.length>0){var f=[];if(h.length>0){c=h[0].firstChild.nodeValue;c=c.replace(this.regExes.trimSpace,"");f=c.split(this.regExes.splitSpace)}if(f.length==2){f[2]=null}if(this.xy){var i=new OpenLayers.Geometry.Point(f[0],f[1],f[2])}else{var i=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}}if(g&&i){b.push(new OpenLayers.Geometry.Point(g.x,g.y));b.push(new OpenLayers.Geometry.Point(i.x,g.y));b.push(new OpenLayers.Geometry.Point(i.x,i.y));b.push(new OpenLayers.Geometry.Point(g.x,i.y));b.push(new OpenLayers.Geometry.Point(g.x,g.y));var j=new OpenLayers.Geometry.LinearRing(b);d=new OpenLayers.Geometry.Polygon([j])}return d}},parseAttributes:function(a){var b={};var c=a.firstChild;var d,e,f,g,h,i,j;while(c){if(c.nodeType==1){d=c.childNodes;for(e=0;e<d.length;++e){f=d[e];if(f.nodeType==1){g=f.childNodes;if(g.length==1){h=g[0];if(h.nodeType==3||h.nodeType==4){i=f.prefix?f.nodeName.split(":")[1]:f.nodeName;j=h.nodeValue.replace(this.regExes.trimSpace,"");b[i]=j}}else{b[f.nodeName.split(":").pop()]=null}}}break}c=c.nextSibling}return b},write:function(a){if(!(a instanceof Array)){a=[a]}var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var c=0;c<a.length;c++){b.appendChild(this.createFeatureXML(a[c]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=a.geometry;var c=this.buildGeometryNode(b);var d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);d.appendChild(c);var e=this.createElementNS(this.gmlns,"gml:"+this.featureName);var f=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var g=a.fid||a.id;f.setAttribute("fid",g);f.appendChild(d);for(var h in a.attributes){var i=this.createTextNode(a.attributes[h]);var j=h.substring(h.lastIndexOf(":")+1);var k=this.createElementNS(this.featureNS,this.featurePrefix+":"+j);k.appendChild(i);f.appendChild(k)}e.appendChild(f);return e},buildGeometryNode:function(a){if(this.externalProjection&&this.internalProjection){a=a.clone();a.transform(this.internalProjection,this.externalProjection)}var b=a.CLASS_NAME;var c=b.substring(b.lastIndexOf(".")+1);var d=this.buildGeometry[c.toLowerCase()];return d.apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");b.appendChild(this.buildCoordinatesNode(a));return b},multipoint:function(a){var b=this.createElementNS(this.gmlns,"gml:MultiPoint");var c=a.components;var d,e;for(var f=0;f<c.length;f++){d=this.createElementNS(this.gmlns,"gml:pointMember");e=this.buildGeometry.point.apply(this,[c[f]]);d.appendChild(e);b.appendChild(d)}return b},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");b.appendChild(this.buildCoordinatesNode(a));return b},multilinestring:function(a){var b=this.createElementNS(this.gmlns,"gml:MultiLineString");var c=a.components;var d,e;for(var f=0;f<c.length;++f){d=this.createElementNS(this.gmlns,"gml:lineStringMember");e=this.buildGeometry.linestring.apply(this,[c[f]]);d.appendChild(e);b.appendChild(d)}return b},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");b.appendChild(this.buildCoordinatesNode(a));return b},polygon:function(a){var b=this.createElementNS(this.gmlns,"gml:Polygon");var c=a.components;var d,e,f;for(var g=0;g<c.length;++g){f=g==0?"outerBoundaryIs":"innerBoundaryIs";d=this.createElementNS(this.gmlns,"gml:"+f);e=this.buildGeometry.linearring.apply(this,[c[g]]);d.appendChild(e);b.appendChild(d)}return b},multipolygon:function(a){var b=this.createElementNS(this.gmlns,"gml:MultiPolygon");var c=a.components;var d,e;for(var f=0;f<c.length;++f){d=this.createElementNS(this.gmlns,"gml:polygonMember");e=this.buildGeometry.polygon.apply(this,[c[f]]);d.appendChild(e);b.appendChild(d)}return b},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");b.appendChild(this.buildCoordinatesNode(a));return b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal",".");b.setAttribute("cs",",");b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds){c.push(a.left+","+a.bottom);c.push(a.right+","+a.top)}else{var d=a.components?a.components:[a];for(var e=0;e<d.length;e++){c.push(d[e].x+","+d[e].y)}}var f=this.createTextNode(c.join(" "));b.appendChild(f);return b},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{initialize:function(a){OpenLayers.Format.JSON.prototype.initialize.apply(this,[a])},read:function(a,b,c){b=b?b:"FeatureCollection";var d=null;var e=null;if(typeof a=="string"){e=OpenLayers.Format.JSON.prototype.read.apply(this,[a,c])}else{e=a}if(!e){OpenLayers.Console.error("Bad JSON: "+a)}else if(typeof e.type!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+a)}else if(this.isValidType(e,b)){switch(b){case"Geometry":try{d=this.parseGeometry(e)}catch(f){OpenLayers.Console.error(f)}break;case"Feature":try{d=this.parseFeature(e);d.type="Feature"}catch(f){OpenLayers.Console.error(f)}break;case"FeatureCollection":d=[];switch(e.type){case"Feature":try{d.push(this.parseFeature(e))}catch(f){d=null;OpenLayers.Console.error(f)}break;case"FeatureCollection":for(var g=0,h=e.features.length;g<h;++g){try{d.push(this.parseFeature(e.features[g]))}catch(f){d=null;OpenLayers.Console.error(f)}}break;default:try{var i=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(i))}catch(f){d=null;OpenLayers.Console.error(f)}}break}}return d},isValidType:function(a,b){var c=false;switch(b){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+a.type)}else{c=true}break;case"FeatureCollection":c=true;break;default:if(a.type==b){c=true}else{OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}}return c},parseFeature:function(a){var b,c,d,e;d=a.properties?a.properties:{};e=a.geometry&&a.geometry.bbox||a.bbox;try{c=this.parseGeometry(a.geometry)}catch(f){throw f}b=new OpenLayers.Feature.Vector(c,d);if(e){b.bounds=OpenLayers.Bounds.fromArray(e)}if(a.id){b.fid=a.id}return b},parseGeometry:function(a){if(a==null){return null}var b,c=false;if(a.type=="GeometryCollection"){if(!(a.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+a}var d=a.geometries.length;var e=new Array(d);for(var f=0;f<d;++f){e[f]=this.parseGeometry.apply(this,[a.geometries[f]])}b=new OpenLayers.Geometry.Collection(e);c=true}else{if(!(a.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+a}if(!this.parseCoords[a.type.toLowerCase()]){throw"Unsupported geometry type: "+a.type}try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(g){throw g}}if(this.internalProjection&&this.externalProjection&&!c){b.transform(this.externalProjection,this.internalProjection)}return b},parseCoords:{point:function(a){if(a.length!=2){throw"Only 2D points are supported: "+a}return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){var b=[];var c=null;for(var d=0,e=a.length;d<e;++d){try{c=this.parseCoords["point"].apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){var b=[];var c=null;for(var d=0,e=a.length;d<e;++d){try{c=this.parseCoords["point"].apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){var b=[];var c=null;for(var d=0,e=a.length;d<e;++d){try{c=this.parseCoords["linestring"].apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){var b=[];var c,d;for(var e=0,f=a.length;e<f;++e){try{d=this.parseCoords["linestring"].apply(this,[a[e]])}catch(g){throw g}c=new OpenLayers.Geometry.LinearRing(d.components);b.push(c)}return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){var b=[];var c=null;for(var d=0,e=a.length;d<e;++d){try{c=this.parseCoords["polygon"].apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(a instanceof Array){c.type="FeatureCollection";var d=a.length;c.features=new Array(d);for(var e=0;e<d;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector){var g="FeatureCollection only supports collections "+"of features: "+f;throw g}c.features[e]=this.extract.feature.apply(this,[f])}}else if(a.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){c=this.extract.geometry.apply(this,[a])}else if(a instanceof OpenLayers.Feature.Vector){c=this.extract.feature.apply(this,[a]);if(a.layer&&a.layer.projection){c.crs=this.createCRSObject(a)}}return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])},createCRSObject:function(a){var b=a.layer.projection.toString();var c={};if(b.match(/epsg:/i)){var d=parseInt(b.substring(b.indexOf(":")+1));if(d==4326){c={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{c={type:"EPSG",properties:{code:d}}}}return c},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]);return{type:"Feature",id:a.fid==null?a.id:a.fid,properties:a.attributes,geometry:b}},geometry:function(a){if(a==null){return null}if(this.internalProjection&&this.externalProjection){a=a.clone();a.transform(this.internalProjection,this.externalProjection)}var b=a.CLASS_NAME.split(".")[2];var c=this.extract[b.toLowerCase()].apply(this,[a]);var d;if(b=="Collection"){d={type:"GeometryCollection",geometries:c}}else{d={type:b,coordinates:c}}return d},point:function(a){return[a.x,a.y]},multipoint:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.point.apply(this,[a.components[c]]))}return b},linestring:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.point.apply(this,[a.components[c]]))}return b},multilinestring:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.linestring.apply(this,[a.components[c]]))}return b},polygon:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.linestring.apply(this,[a.components[c]]))}return b},multipolygon:function(a){var b=[];for(var c=0,d=a.components.length;c<d;++c){b.push(this.extract.polygon.apply(this,[a.components[c]]))}return b},collection:function(a){var b=a.components.length;var c=new Array(b);for(var d=0;d<b;++d){c[d]=this.extract.geometry.apply(this,[a.components[d]])}return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b=new OpenLayers.Format.ArcXML;var c=b.read(a);return c.features.feature}});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();if(a&&a.featureNS){this.setNamespace("feature",a.featureNS)}this.singleFeatureType=!a||typeof a.featureType==="string"},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b=[];this.readNode(a,{features:b});if(b.length==0){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length){for(var d=0,e=c.length;d<e;++d){this.readNode(c[d],{features:b})}}else{var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers");if(c.length){this.readNode(c[0],{features:b})}}}return b},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c);if(c.components&&c.components.length>0){b.bounds=c.components[0]}},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c);if(!b.components){b.components=[]}b.components.push(c.points[0])},coordinates:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);var e;var f=d.length;var g=new Array(f);for(var h=0;h<f;++h){e=d[h].split(",");if(this.xy){g[h]=new OpenLayers.Geometry.Point(e[0],e[1],e[2])}else{g[h]=new OpenLayers.Geometry.Point(e[1],e[0],e[2])}}b.points=g},coord:function(a,b){var c={};this.readChildNodes(a,c);if(!b.points){b.points=[]}b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,b){var c={};this.readChildNodes(a,c);if(!b.components){b.components=[]}b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readChildNodes(a,c);c.inner.unshift(c.outer);if(!b.components){b.components=[]}b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readChildNodes(a,c);b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c;var d=a.localName||a.nodeName.split(":").pop();if(!this.singleFeatureType&&OpenLayers.Util.indexOf(this.featureType,d)!=-1){c="_typeName"}else if(d==this.featureType){c="_typeName"}else{if(a.childNodes.length==0||a.childNodes.length==1&&a.firstChild.nodeType==3){if(this.extractAttributes){c="_attribute"}}else{c="_geometry"}}if(c){this.readers.feature[c].apply(this,[a,b])}},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c);if(c.name){c.attributes.name=c.name}var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);if(!this.singleFeatureType){d.type=a.nodeName.split(":").pop();d.namespace=a.namespaceURI}var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces["gml"],"id");if(e){d.fid=e}if(this.internalProjection&&this.externalProjection&&d.geometry){d.geometry.transform(this.externalProjection,this.internalProjection)}if(c.bounds){d.geometry.bounds=c.bounds}b.features.push(d)},_geometry:function(a,b){this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop();var d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(a){var b;if(a instanceof Array){b="featureMembers"}else{b="featureMember"}var c=this.writeNode("gml:"+b,a);this.setAttributeNS(c,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b},MultiPoint:function(a){var b=this.createElementNSPlus("gml:MultiPoint");for(var c=0;c<a.components.length;++c){this.writeNode("pointMember",a.components[c],b)}return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",a,b);return b},MultiLineString:function(a){var b=this.createElementNSPlus("gml:MultiLineString");for(var c=0;c<a.components.length;++c){this.writeNode("lineStringMember",a.components[c],b)}return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",a,b);return b},MultiPolygon:function(a){var b=this.createElementNSPlus("gml:MultiPolygon");for(var c=0;c<a.components.length;++c){this.writeNode("polygonMember",a.components[c],b)}return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",a,b);return b},GeometryCollection:function(a){var b=this.createElementNSPlus("gml:GeometryCollection");for(var c=0,d=a.components.length;c<d;++c){this.writeNode("geometryMember",a.components[c],b)}return b},geometryMember:function(a){var b=this.createElementNSPlus("gml:geometryMember");var c=this.writeNode("feature:_geometry",a);b.appendChild(c.firstChild);return b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});if(a.geometry){this.writeNode("feature:_geometry",a.geometry,b)}for(var c in a.attributes){var d=a.attributes[c];if(d!=null){this.writeNode("feature:_attribute",{name:c,value:d},b)}}return b},_geometry:function(a){if(this.externalProjection&&this.internalProjection){a=a.clone().transform(this.internalProjection,this.externalProjection)}var b=this.createElementNSPlus("feature:"+this.geometryName);var c=this.geometryTypes[a.CLASS_NAME];var d=this.writeNode("gml:"+c,a,b);if(this.srsName){d.setAttribute("srsName",this.srsName)}return b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){var b=this.createElementNSPlus("wfs:FeatureCollection");for(var c=0,d=a.length;c<d;++c){this.writeNode("gml:featureMember",a[c],b)}return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]);this.layer=b;if(this.layer.featureNS){this.featureNS=this.layer.featureNS}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column}if(this.layer.options.typename){this.featureName=this.layer.options.typename}},write:function(a){var b=this.createElementNS(this.wfsns,"wfs:Transaction");b.setAttribute("version","1.0.0");b.setAttribute("service","WFS");for(var c=0;c<a.length;c++){switch(a[c].state){case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]));break}}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry);var c=this.createElementNS(this.featureNS,"feature:"+this.geometryName);c.appendChild(b);var d=this.createElementNS(this.featureNS,"feature:"+this.featureName);d.appendChild(c);for(var e in a.attributes){var f=this.createTextNode(a.attributes[e]);var g=e;if(e.search(":")!=-1){g=e.split(":")[1]}var h=this.createElementNS(this.featureNS,"feature:"+g);h.appendChild(f);d.appendChild(h)}return d},insert:function(a){var b=this.createElementNS(this.wfsns,"wfs:Insert");b.appendChild(this.createFeatureXML(a));return b},update:function(a){if(!a.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"))}var b=this.createElementNS(this.wfsns,"wfs:Update");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName);b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,"wfs:Property");var d=this.createElementNS(this.wfsns,"wfs:Name");var e=this.createTextNode(this.geometryName);d.appendChild(e);c.appendChild(d);var f=this.createElementNS(this.wfsns,"wfs:Value");var g=this.buildGeometryNode(a.geometry);if(a.layer){g.setAttribute("srsName",a.layer.projection.getCode())}f.appendChild(g);c.appendChild(f);b.appendChild(c);for(var h in a.attributes){c=this.createElementNS(this.wfsns,"wfs:Property");d=this.createElementNS(this.wfsns,"wfs:Name");d.appendChild(this.createTextNode(h));c.appendChild(d);f=this.createElementNS(this.wfsns,"wfs:Value");f.appendChild(this.createTextNode(a.attributes[h]));c.appendChild(f);b.appendChild(c)}var i=this.createElementNS(this.ogcns,"ogc:Filter");var j=this.createElementNS(this.ogcns,"ogc:FeatureId");j.setAttribute("fid",a.fid);i.appendChild(j);b.appendChild(i);return b},remove:function(a){if(!a.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"));return false}var b=this.createElementNS(this.wfsns,"wfs:Delete");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName);b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter");var d=this.createElementNS(this.ogcns,"ogc:FeatureId");d.setAttribute("fid",a.fid);c.appendChild(d);b.appendChild(c);return b},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},tileSize:null,featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:true,name:"ArcIMS",isBaseLayer:true,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:true,async:true,name:"ArcIMS"},initialize:function(a,b,c){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:c.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]);if(this.transparent){if(!this.isBaseLayer){this.isBaseLayer=false}if(this.format=="image/jpeg"){this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}if(this.options.layers===null){this.options.layers=[]}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},getURL:function(a){var b="";a=this.adjustBounds(a);var c=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize}));var d=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:c.write(),async:false});if(d!=null){var e=d.responseXML;if(!e||!e.documentElement){e=d.responseText}var f=new OpenLayers.Format.ArcXML;var g=f.read(e);b=this.getUrlOrImage(g.image.output)}return b},getURLasync:function(a,b,c,d){a=this.adjustBounds(a);var e=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:true,data:e.write(),callback:function(a){var e=a.responseXML;if(!e||!e.documentElement){e=a.responseText}var f=new OpenLayers.Format.ArcXML;var g=f.read(e);b[c]=this.getUrlOrImage(g.image.output);d.apply(b)},scope:this})},getUrlOrImage:function(a){var b="";if(a.url){b=a.url}else if(a.data){b="data:image/"+a.type+";base64,"+a.data}return b},setLayerQuery:function(a,b){for(var c=0;c<this.options.layers.length;c++){if(a==this.options.layers[c].id){this.options.layers[c].query=b;return}}this.options.layers.push({id:a,visible:true,query:b})},getFeatureInfo:function(a,b,c){var d=c.buffer||1;var e=c.callback||function(){};var f=c.scope||window;var g={};OpenLayers.Util.extend(g,this.options);g.requesttype="feature";if(a instanceof OpenLayers.LonLat){g.polygon=null;g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]}else if(a instanceof OpenLayers.Geometry.Polygon){g.envelope=null;g.polygon=a}var h=new OpenLayers.Format.ArcXML(g);OpenLayers.Util.extend(h.request.get_feature,c);h.request.get_feature.layer=b.id;if(typeof b.query.accuracy=="number"){h.request.get_feature.query.accuracy=b.query.accuracy}else{var i=this.map.getCenter();var j=this.map.getViewPortPxFromLonLat(i);j.x++;var k=this.map.getLonLatFromPixel(j);h.request.get_feature.query.accuracy=k.lon-i.lon}h.request.get_feature.query.where=b.query.where;h.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:h.write(),callback:function(a){var b=h.parseResponse(a.responseText);if(!h.iserror()){e.call(f,b.features)}else{e.call(f,null)}}})},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c);b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c);b.inner.push(c.components[0])},Box:function(a,b){var c={};this.readChildNodes(a,c);if(!b.components){b.components=[]}var d=c.points[0];var e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))}},OpenLayers.Format.GML.Base.prototype.readers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.readers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.readers["wfs"]},write:function(a){var b;if(a instanceof Array){b="wfs:FeatureCollection"}else{b="gml:featureMember"}var c=this.writeNode(b,a);this.setAttributeNS(c,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[a],b);return b},coordinates:function(a){var b=a.length;var c=new Array(b);var d;for(var e=0;e<b;++e){d=a[e];if(this.xy){c[e]=d.x+","+d.y}else{c[e]=d.y+","+d.x}if(d.z!=undefined){c[e]+=","+d.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:b==1?c[0]:c.join(" ")})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",a.components,b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c){this.writeNode("innerBoundaryIs",a.components[c],b)}return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b},Box:function(a){var b=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b);if(this.srsName){b.setAttribute("srsName",this.srsName)}return b}},OpenLayers.Format.GML.Base.prototype.writers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.writers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.writers["wfs"]},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readChildNodes(a,c);if(!b.components){b.components=[]}b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c);if(c.points){Array.prototype.push.apply(b.points,c.points)}},pos:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");var d=c.split(this.regExes.splitSpace);var e;if(this.xy){e=new OpenLayers.Geometry.Point(d[0],d[1],d[2])}else{e=new OpenLayers.Geometry.Point(d[1],d[0],d[2])}b.points=[e]},posList:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");var d=c.split(this.regExes.splitSpace);var e=parseInt(a.getAttribute("dimension"))||2;var f,g,h,i;var j=d.length/e;var k=new Array(j);for(var l=0,m=d.length;l<m;l+=e){g=d[l];h=d[l+1];i=e==2?undefined:d[l+2];if(this.xy){k[l/e]=new OpenLayers.Geometry.Point(g,h,i)}else{k[l/e]=new OpenLayers.Geometry.Point(h,g,i)}}b.points=k},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c);b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c);b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readChildNodes(a,c);if(c.components.length>0){b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]}},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readChildNodes(a,c);if(c.components.length>0){b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]}},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:new Array(2)};this.readChildNodes(a,c);if(!b.components){b.components=[]}var d=c.points[0];var e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]);b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]);b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.readers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.readers["wfs"]},write:function(a){var b;if(a instanceof Array){b="featureMembers"}else{b="featureMember"}var c=this.writeNode("gml:"+b,a);this.setAttributeNS(c,this.namespaces["xsi"],"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){var b=this.createElementNSPlus("gml:featureMembers");for(var c=0,d=a.length;c<d;++c){this.writeNode("feature:_typeName",a[c],b)}return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");this.writeNode("pos",a,b);return b},pos:function(a){var b=this.xy?a.x+" "+a.y:a.y+" "+a.x;return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");this.writeNode("posList",a.components,b);return b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");this.writeNode("segments",a,b);return b},segments:function(a){var b=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",a,b);return b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",a.components,b);return b},posList:function(a){var b=a.length;var c=new Array(b);var d;for(var e=0;e<b;++e){d=a[e];if(this.xy){c[e]=d.x+" "+d.y}else{c[e]=d.y+" "+d.x}}return this.createElementNSPlus("gml:posList",{value:c.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");this.writeNode("patches",a,b);return b},patches:function(a){var b=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",a,b);return b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c){this.writeNode("interior",a.components[c],b)}return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c){this.writeNode("interior",a.components[c],b)}return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b},MultiCurve:function(a){var b=this.createElementNSPlus("gml:MultiCurve");for(var c=0,d=a.components.length;c<d;++c){this.writeNode("curveMember",a.components[c],b)}return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",a,b)}else{this.writeNode("LineString",a,b)}return b},MultiSurface:function(a){var b=this.createElementNSPlus("gml:MultiSurface");for(var c=0,d=a.components.length;c<d;++c){this.writeNode("surfaceMember",a.components[c],b)}return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",a,b)}else{this.writeNode("Polygon",a,b)}return b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",a,b);this.writeNode("upperCorner",a,b);if(this.srsName){b.setAttribute("srsName",this.srsName)}return b},lowerCorner:function(a){var b=this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left;return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=this.xy?a.right+" "+a.top:a.top+" "+a.right;return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers["gml"]),feature:OpenLayers.Format.GML.Base.prototype.writers["feature"],wfs:OpenLayers.Format.GML.Base.prototype.writers["wfs"]},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===true?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===false?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===true?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===false?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c);b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers["ogc"]),gml:OpenLayers.Format.GML.v2.prototype.readers["gml"],feature:OpenLayers.Format.GML.v2.prototype.readers["feature"]},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);if(a.projection){c.setAttribute("srsName",a.projection)}return b}},OpenLayers.Format.Filter.v1.prototype.writers["ogc"]),gml:OpenLayers.Format.GML.v2.prototype.writers["gml"],feature:OpenLayers.Format.GML.v2.prototype.writers["feature"]},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);this.writeNode("PropertyName",a,c);var d;if(a.value instanceof OpenLayers.Geometry){d=this.writeNode("feature:_geometry",a.value).firstChild}else{d=this.writeNode("gml:Box",a.value)}if(a.projection){d.setAttribute("srsName",a.projection)}c.appendChild(d);return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase");var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(c==="false"||c==="0")});this.readChildNodes(a,d);b.filters.push(d)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase");var d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(c==="false"||c==="0")});this.readChildNodes(a,d);b.filters.push(d)}},OpenLayers.Format.Filter.v1.prototype.readers["ogc"]),gml:OpenLayers.Format.GML.v3.prototype.readers["gml"],feature:OpenLayers.Format.GML.v3.prototype.readers["feature"]},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);if(a.projection){c.setAttribute("srsName",a.projection)}b.appendChild(c);return b}},OpenLayers.Format.Filter.v1.prototype.writers["ogc"]),gml:OpenLayers.Format.GML.v3.prototype.writers["gml"],feature:OpenLayers.Format.GML.v3.prototype.writers["feature"]},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);this.writeNode("PropertyName",a,c);var d;if(a.value instanceof OpenLayers.Geometry){d=this.writeNode("feature:_geometry",a.value).firstChild}else{d=this.writeNode("gml:Envelope",a.value)}if(a.projection){d.setAttribute("srsName",a.projection)}c.appendChild(d);return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a])},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={namedLayers:b.namedLayersAsArray===true?[]:{}};this.readChildNodes(a,c);return c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c={userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;d<e;++d){c.userStyles[d].layerName=c.name}if(b.namedLayers instanceof Array){b.namedLayers.push(c)}else{b.namedLayers[c.name]=c}},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:true,rules:[]};this.readChildNodes(a,c);var d=new OpenLayers.Style(this.defaultSymbolizer,c);b.userStyles.push(d)},IsDefault:function(a,b){if(this.getChildValue(a)=="1"){b.isDefault=true}},FeatureTypeStyle:function(a,b){var c={rules:[]};this.readChildNodes(a,c);b.rules=c.rules},Rule:function(a,b){var c=new OpenLayers.Rule;this.readChildNodes(a,c);b.rules.push(c)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c=b.symbolizer["Text"]||{};this.readChildNodes(a,c);b.symbolizer["Text"]=c},Label:function(a,b){var c={};this.readChildNodes(a,c);if(c.property){b.label="${"+c.property+"}"}else{var d=this.readOgcExpression(a);if(d){b.label=d}}},Font:function(a,b){this.readChildNodes(a,b)},Halo:function(a,b){var c={};this.readChildNodes(a,c);b.haloRadius=c.haloRadius;b.haloColor=c.fillColor;b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readOgcExpression(a);if(c!=null){b.haloRadius=c}},LineSymbolizer:function(a,b){var c=b.symbolizer["Line"]||{};this.readChildNodes(a,c);b.symbolizer["Line"]=c},PolygonSymbolizer:function(a,b){var c=b.symbolizer["Polygon"]||{};this.readChildNodes(a,c);b.symbolizer["Polygon"]=c},PointSymbolizer:function(a,b){var c=b.symbolizer["Point"]||{};this.readChildNodes(a,c);b.symbolizer["Point"]=c},Stroke:function(a,b){b.stroke=true;this.readChildNodes(a,b)},Fill:function(a,b){b.fill=true;this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name");var d=this.cssMap[c];if(d){var e=this.readOgcExpression(a);if(e){b[d]=e}}},Graphic:function(a,b){b.graphic=true;var c={};this.readChildNodes(a,c);var d=["strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var e,f;for(var g=0,h=d.length;g<h;++g){e=d[g];f=c[e];if(f!=undefined){b[e]=f}}if(c.opacity!=undefined){b.graphicOpacity=c.opacity}if(c.size!=undefined){b.pointRadius=c.size/2}if(c.href!=undefined){b.externalGraphic=c.href}if(c.rotation!=undefined){b.rotation=c.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readOgcExpression(a);if(c){b.opacity=c}},Size:function(a,b){var c=this.readOgcExpression(a);if(c){b.size=c}},Rotation:function(a,b){var c=this.readOgcExpression(a);if(c){b.rotation=c}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap){if(this.cssMap[c]==a){b=c;break}}return b},getGraphicFormat:function(a){var b,c;for(var d in this.graphicFormats){if(this.graphicFormats[d].test(a)){b=d;break}}return b||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a){var b=this.createElementNSPlus("StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(a.name){this.writeNode("Name",a.name,b)}if(a.title){this.writeNode("Title",a.title,b)}if(a.description){this.writeNode("Abstract",a.description,b)}if(a.namedLayers instanceof Array){for(var c=0,d=a.namedLayers.length;c<d;++c){this.writeNode("NamedLayer",a.namedLayers[c],b)}}else{for(var e in a.namedLayers){this.writeNode("NamedLayer",a.namedLayers[e],b)}}return b},Name:function(a){return this.createElementNSPlus("Name",{value:a})},Title:function(a){return this.createElementNSPlus("Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("Abstract",{value:a})},NamedLayer:function(a){var b=this.createElementNSPlus("NamedLayer");this.writeNode("Name",a.name,b);if(a.namedStyles){for(var c=0,d=a.namedStyles.length;c<d;++c){this.writeNode("NamedStyle",a.namedStyles[c],b)}}if(a.userStyles){for(var c=0,d=a.userStyles.length;c<d;++c){this.writeNode("UserStyle",a.userStyles[c],b)}}return b},NamedStyle:function(a){var b=this.createElementNSPlus("NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(a){var b=this.createElementNSPlus("UserStyle");if(a.name){this.writeNode("Name",a.name,b)}if(a.title){this.writeNode("Title",a.title,b)}if(a.description){this.writeNode("Abstract",a.description,b)}if(a.isDefault){this.writeNode("IsDefault",a.isDefault,b)}this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("IsDefault",{value:a?"1":"0"})},FeatureTypeStyle:function(a){var b=this.createElementNSPlus("FeatureTypeStyle");for(var c=0,d=a.rules.length;c<d;++c){this.writeNode("Rule",a.rules[c],b)}return b},Rule:function(a){var b=this.createElementNSPlus("Rule");if(a.name){this.writeNode("Name",a.name,b)}if(a.title){this.writeNode("Title",a.title,b)}if(a.description){this.writeNode("Abstract",a.description,b)}if(a.elseFilter){this.writeNode("ElseFilter",null,b)}else if(a.filter){this.writeNode("ogc:Filter",a.filter,b)}if(a.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",a.minScaleDenominator,b)}if(a.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b)}var c=OpenLayers.Style.SYMBOLIZER_PREFIXES;var d,e;for(var f=0,g=c.length;f<g;++f){d=c[f];e=a.symbolizer[d];if(e){this.writeNode(d+"Symbolizer",e,b)}}return b},ElseFilter:function(){return this.createElementNSPlus("ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("Stroke");if(a.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b)}if(a.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b)}if(a.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b)}return b},CssParameter:function(a){return this.createElementNSPlus("CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("TextSymbolizer");if(a.label!=null){this.writeNode("Label",a.label,b)}if(a.fontFamily!=null||a.fontSize!=null||a.fontWeight!=null||a.fontStyle!=null){this.writeNode("Font",a,b)}if(a.haloRadius!=null||a.haloColor!=null||a.haloOpacity!=null){this.writeNode("Halo",a,b)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode("Fill",a,b)}return b},Font:function(a){var b=this.createElementNSPlus("Font");if(a.fontFamily){this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b)}if(a.fontSize){this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b)}if(a.fontWeight){this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b)}if(a.fontStyle){this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b)}return b},Label:function(a){var b=this.createElementNSPlus("Label");var c=a.split("${");b.appendChild(this.createTextNode(c[0]));var d,e;for(var f=1,g=c.length;f<g;f++){d=c[f];e=d.indexOf("}");if(e>0){this.writeNode("ogc:PropertyName",{property:d.substring(0,e)},b);b.appendChild(this.createTextNode(d.substring(++e)))}else{b.appendChild(this.createTextNode("${"+d))}}return b},Halo:function(a){var b=this.createElementNSPlus("Halo");if(a.haloRadius){this.writeNode("Radius",a.haloRadius,b)}if(a.haloColor||a.haloOpacity){this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b)}return b},Radius:function(a){return node=this.createElementNSPlus("Radius",{value:a})},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("PolygonSymbolizer");if(a.fillColor!=undefined||a.fillOpacity!=undefined){this.writeNode("Fill",a,b)}if(a.strokeWidth!=undefined||a.strokeColor!=undefined||a.strokeOpacity!=undefined||a.strokeDashstyle!=undefined){this.writeNode("Stroke",a,b)}return b},Fill:function(a){var b=this.createElementNSPlus("Fill");if(a.fillColor){this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b)}if(a.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b)}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("Graphic");if(a.externalGraphic!=undefined){this.writeNode("ExternalGraphic",a,b)}else{this.writeNode("Mark",a,b)}if(a.graphicOpacity!=undefined){this.writeNode("Opacity",a.graphicOpacity,b)}if(a.pointRadius!=undefined){this.writeNode("Size",a.pointRadius*2,b)}if(a.rotation!=undefined){this.writeNode("Rotation",a.rotation,b)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",c,b);return b},Mark:function(a){var b=this.createElementNSPlus("Mark");if(a.graphicName){this.writeNode("WellKnownName",a.graphicName,b)}this.writeNode("Fill",a,b);this.writeNode("Stroke",a,b);return b},WellKnownName:function(a){return this.createElementNSPlus("WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[];b.success=false;this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c);b.insertIds.push(c.fids[0])},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=true}},OpenLayers.Format.WFST.v1.prototype.readers["wfs"]),gml:OpenLayers.Format.GML.v2.prototype.readers["gml"],feature:OpenLayers.Format.GML.v2.prototype.readers["feature"],ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers["ogc"]},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(a.featureNS?a.featurePrefix+":":"")+a.featureType}});if(a.featureNS){b.setAttribute("xmlns:"+a.featurePrefix,a.featureNS)}if(a.propertyNames){for(var c=0,d=a.propertyNames.length;c<d;c++){this.writeNode("ogc:PropertyName",{property:a.propertyNames[c]},b)}}if(a.filter){this.setFilterProperty(a.filter);this.writeNode("ogc:Filter",a.filter,b)}return b}},OpenLayers.Format.WFST.v1.prototype.writers["wfs"]),gml:OpenLayers.Format.GML.v2.prototype.writers["gml"],feature:OpenLayers.Format.GML.v2.prototype.writers["feature"],ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers["ogc"]},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readers:{wfs:OpenLayers.Util.applyDefaults({TransactionResponse:function(a,b){b.insertIds=[];b.success=false;this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=true},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c);b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers["wfs"]),gml:OpenLayers.Format.GML.v3.prototype.readers["gml"],feature:OpenLayers.Format.GML.v3.prototype.readers["feature"],ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers["ogc"]},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(a.featureNS?a.featurePrefix+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS){b.setAttribute("xmlns:"+a.featurePrefix,a.featureNS)}if(a.propertyNames){for(var c=0,d=a.propertyNames.length;c<d;c++){this.writeNode("wfs:PropertyName",{property:a.propertyNames[c]},b)}}if(a.filter){this.setFilterProperty(a.filter);this.writeNode("ogc:Filter",a.filter,b)}return b},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers["wfs"]),gml:OpenLayers.Format.GML.v3.prototype.writers["gml"],feature:OpenLayers.Format.GML.v3.prototype.writers["feature"],ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers["ogc"]},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",initialize:function(a){OpenLayers.Format.SLD.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});

//alert(Drupal.settings.openlayers.wmsUrl);


MappingKit.init = function() {
OpenLayers.DOTS_PER_INCH = 72;
OpenLayers.IMAGE_RELOAD_ATTEMPTS = 1;
OpenLayers.ProxyHost = '/sites/all/modules/mappingkit/proxy.php?url=';
var options = {};
var client = {google: null, ve: null};
var map_options = {};
map_options.numZoomLevels = 20;
map_options.projection = new OpenLayers.Projection('EPSG:4326');
map_options.units = 'degrees';
map_options.maxExtent = new OpenLayers.Bounds(0,0,2000,2737);
map_options.maxResolution = 4.914004914;
map_options.title = 'Sample Anatomy Image';
var controls = [new OpenLayers.Control.Attribution()];
var argParserOptions;
controls.push(new MappingKit.Control.ArgParser(argParserOptions));
map_options.options = {useCookies: true};
map_options.controls = controls;
map_options.theme = null;
var map = new OpenLayers.Map('map-0', map_options);
MappingKit.MapClient.OpenLayers.registerMap('map-0', map);
client.map = map;
client.baselayers = [];
maps[maps.length] = map;
var legend = new MappingKit.Legend(map, 'legend', {title: Drupal.t('Legend')});
client.none = new OpenLayers.Layer(Drupal.t('None'), {isBaseLayer: true});
client.baselayers[client.baselayers.length] = client.none;
if ($defined(client.google) && $defined(client.ve)) {
  client.ve.RESOLUTIONS = client.google.RESOLUTIONS;
  client.ve.MAX_ZOOM_LEVEL = client.google.MAX_ZOOM_LEVEL;
}
for (var i = 0; i < client.baselayers.length; i++) {
  map.addLayer(client.baselayers[i]);
}
var selectableLayers = [];

//This somehow enables reverse highlighting

var layer_options_overlay = {};
layer_options_overlay.maxResolution = 4.9140049140049;
layer_options_overlay.useFeedTitle = false;
layer_options_overlay.format = MappingKit.Format.GeoRSS;
var style3 = new OpenLayers.Style({fillColor:'transparent',fillOpacity:0.8,hoverFillColor:'transparent',hoverFillOpacity:0.8,strokeColor:'transparent',strokeOpacity:1,strokeWidth:2,strokeLinecap:'round',strokeDashstyle:'solid',hoverStrokeColor:'transparent',hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:'%',pointerEvents:'visiblePainted',cursor:'pointer',fontColor:'#000000',labelAlign:'cm',labelOutlineColor:'transparent',labelOutlineWidth:3});
layer_options_overlay.styleMap = new OpenLayers.StyleMap({'default': style3});
var georss1 = new OpenLayers.Layer.GML('Anatomy Terms', '../anatomy_image/3474/1/feed', layer_options_overlay);
map.addLayer(georss1);
selectableLayers.push(georss1);
georss1.events.on({'loadend':MappingKit.loadend1, 'featureselected': MappingKit.handleFeatureSelected1, 'featureunselected': MappingKit.handleFeatureUnselected1});

var layAr = JSON.parse(Drupal.settings.openlayers.layerArray);

var output = '';
for (property in layAr) {

	var layer_options = {};
	layer_options.maxResolution = 4.914004914;
	layer_options.useFeedTitle = false;
	layer_options.format = MappingKit.Format.GeoRSS;
	var style = new OpenLayers.Style({externalGraphic: OpenLayers.Util.getImagesLocation() + 'marker.png', graphicWidth: 21, graphicHeight: 25, graphicXOffset: -10.5, graphicYOffset: -12.5});
	var style2 = new OpenLayers.Style({externalGraphic: 'http://www.innerbody.com/sites/all/themes/innerbodyv2/images/point-static.png', graphicWidth: 7, graphicHeight:7, graphicXOffset: -2.5, graphicYOffset: -2.5,fillColor:'transparent',fillOpacity:1,hoverFillColor:'green',hoverFillOpacity:0.8,strokeColor:'green',strokeOpacity:1,strokeWidth:2,strokeLinecap:'round',strokeDashstyle:'solid',hoverStrokeColor:'green',hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:'%',pointerEvents:'visiblePainted',cursor:'pointer',fontColor:'#000000',labelAlign:'cm',labelOutlineColor:'green',labelOutlineWidth:3});
	var selectstyle = new OpenLayers.Style({strokeColor:'green',externalGraphic: '/sites/all/themes/innerbodyv2/images/point-anim.gif', graphicWidth: 7, graphicHeight:7, graphicXOffset: -2.5, graphicYOffset: -2.5});
	layer_options.styleMap = new OpenLayers.StyleMap({'default': style2, 'select':selectstyle});
	var georss = new OpenLayers.Layer.GML('Anatomy Terms Layer 2', layAr[property], layer_options);
	ie8test = ifInternetExplorerEight();
	if(ie8test != 1){map.addLayer(georss);};selectableLayers.push(georss);
	georss.events.on({'loadend':MappingKit.loadend, 'featureselected': MappingKit.handleFeatureSelected, 'featureunselected': MappingKit.handleFeatureUnselected});
	totalCnt++;
}

	
var layer_options = {};
layer_options.opacity = 1.0;
layer_options.displayInLegend = true;
layer_options.visibility = false;
layer_options.legend = {};
layer_options.legend.href = Drupal.settings.openlayers.wmsUrl +  '&version=1.1.1&service=WMS&request=GetLegendGraphic&format=image/png&layer=MainImage';
var request_params = {layers: 'MainImage', format: 'image/png', transparent: 'TRUE'};
if (layer_options.params) { OpenLayers.Util.extend(request_params, layer_options.params); }
if (!$defined(layer_options.isBaseLayer)) { layer_options.isBaseLayer = !$defined(map.baseLayer); }
layer_options.visibility = true;
var wms = new OpenLayers.Layer.WMS('WMS', Drupal.settings.openlayers.wmsUrl, request_params, layer_options);

	
wms.gutter = 0;
map.addLayer(wms);
if (selectableLayers.length > 0) {
var selectControl = new OpenLayers.Control.SelectFeature(
      selectableLayers, {
      clickout: true,
      multiple: false,
      hover: true
      });
map.addControl(selectControl);
selectControl.activate();
MappingKit.selectControls.push(selectControl);
};
var default_container = document.getElementById('map-0-default-panel');
var default_panel = new OpenLayers.Control.Panel({div: default_container});
map.addControl(default_panel);
var navigationControl = new OpenLayers.Control.Navigation({title: Drupal.t('Default navigation')});
var mode_panel = new OpenLayers.Control.Panel({div: document.getElementById('map-0-mode-panel')});
map.addControl(mode_panel);
mode_panel.addControls([navigationControl]);
var action_panel = new OpenLayers.Control.Panel({div: document.getElementById('map-0-action-panel')});
map.addControl(action_panel);
if (OpenLayers.Control.NavigationHistory) {
nav = new OpenLayers.Control.NavigationHistory();
map.addControl(nav);
nav.next.title = Drupal.t('Next extent');
nav.previous.title = Drupal.t('Previous extent');
default_panel.addControls([nav.previous, nav.next]);
}
default_panel.addControls([new OpenLayers.Control.ZoomToMaxExtent({title: Drupal.t('Zoom to the maximum extent')})]);
if (!map.getCenter()) {
  map.zoomToMaxExtent();
}
map.events.register('movestart', map, MappingKit.movestart);
map.events.register('removelayer', map, MappingKit.removelayer);
}

if (Drupal.jsEnabled) {
	// ready is ok in Firefox, but not in IE6
	$(document).ready(MappingKit.init);
}
;