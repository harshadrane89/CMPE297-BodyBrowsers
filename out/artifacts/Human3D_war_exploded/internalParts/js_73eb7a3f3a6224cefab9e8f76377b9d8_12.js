MappingKit.OpenLayers={};MappingKit.selectControls=[];$.fn.scrollTo=function(target,options,callback){if(typeof options=='function'&&arguments.length==2){callback=options;options=target};var settings=$.extend({scrollTarget:target,offsetTop:50,duration:500,easing:'swing'},options);return this.each(function(){var scrollPane=$(this),scrollTarget=(typeof settings.scrollTarget=="number")?settings.scrollTarget:$(settings.scrollTarget),scrollY=(typeof scrollTarget=="number")?scrollTarget:scrollTarget.offset().top+scrollPane.scrollTop()-parseInt(settings.offsetTop);scrollPane.animate({scrollTop:scrollY},parseInt(settings.duration),settings.easing,function(){if(typeof callback=='function')callback.call(this)})})};if(!$defined(MappingKit.Control))MappingKit.Control={};if(!$defined(MappingKit.Format))MappingKit.Format={};if(!$defined(MappingKit.Layer))MappingKit.Layer={};MappingKit.calculateInRange=function(){var inRange=false;if(this.map){var resolution=this.map.getResolution();inRange=((resolution>=this.minResolution)&&(resolution<=this.maxResolution));var extent=this.map.getExtent();if(extent)inRange=inRange&&extent.intersectsBounds(this.maxExtent)};return inRange};MappingKit.translate=function(key,context){var en_dictionary=OpenLayers.Lang['en'],message=en_dictionary[key];if(OpenLayers.Lang.getCode()!='en'){var drupal_message=Drupal.t(key);if(drupal_message!=key)message=drupal_message};if(!message)message=key;if(context)message=OpenLayers.String.format(message,context);return message};OpenLayers.Lang.translate=MappingKit.translate;OpenLayers.i18n=MappingKit.translate;MappingKit.translateAttribute=function(attributeName,layerName){var search='attribute:'+attributeName,find;if(layerName){var searchMax=search+'/'+layerName;find=Drupal.t(searchMax);if(find!=searchMax)return find};find=Drupal.t(search);return find!=search?find:attributeName};MappingKit.OpenLayers.onFeatureModification=function(feature){var el=document.getElementById('edit-geometry');if(el)el.value=feature.geometry};MappingKit.movestart=function(evt){if(!evt.dragging){MappingKit.loadErrors=[];var el=document.getElementById('mapclient-messages');if(el){$(el).empty();$(el).parent().removeClass('error')}}};MappingKit.removelayer=function(evt){if(!MappingKit.loadErrors)MappingKit.loadErrors=[];if(evt.layer instanceof OpenLayers.Layer.WMS)for(var i=0;i<MappingKit.loadErrors.length;i++)if(evt.layer.params&&MappingKit.loadErrors[i]==evt.layer.params.LAYERS){alert('remove '+evt.layer.name);MappingKit.loadErrors.splice(i,1);var item=document.getElementById('message-'+evt.layer.params.LAYERS);if(item)item.parentNode.removeChild(item);return}};MappingKit.onImageLoadError=function(){if(!MappingKit.loadErrors)MappingKit.loadErrors=[];var el=document.getElementById('mapclient-messages');if(el){var parts=this.src.split('?'),request={service:parts[0]};if(parts.length>1){var params=parts[1].split('&');for(var i=0;i<params.length;i++){var tmp=params[i].split('='),key=tmp[0].toLowerCase(),value=unescape(tmp[1]);request[key]=value;if(key=='layers'){var layers=unescape(tmp[1]);for(var j=0;j<MappingKit.loadErrors.length;j++)if(MappingKit.loadErrors[j]==layers)return;if(j==0)$(el).parent().addClass('error');MappingKit.loadErrors[j]=layers}}}else if(request.service.indexOf('/404.png')>=0){return}else{var matches=request.service.match(/http\:\/\/([^\/]*)\//),layers=matches[0];for(var j=0;j<MappingKit.loadErrors.length;j++)if(MappingKit.loadErrors[j]==layers)return;if(j==0)$(el).parent().addClass('error');MappingKit.loadErrors[j]=layers};var listItem=document.createElement('li');listItem.id='message-'+layers;listItem.innerHTML=Drupal.t('Error loading images for <em>@layers</em>.',{'@layers':layers});el.appendChild(listItem)}}
function osm_getTileURL(bounds){var res=this.map.getResolution(),x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w)),y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h)),z=this.map.getZoom(),limit=Math.pow(2,z);if(y<0||y>=limit){return OpenLayers.Util.getImagesLocation()+"404.png"}else{x=((x%limit)+limit)%limit;return this.url+z+"/"+x+"/"+y+"."+this.type}};MappingKit.onPopupClose=function(evt){this.map.removePopup(this);this.destroy()};MappingKit.handleFeatureSelected=function(e){return MappingKit.onFeatureSelect.apply(this,[e.feature])};MappingKit.handleFeatureSelected1=function(e){removeNotInitFeatures();outFeature=true};MappingKit.handleFeatureUnselected1=function(e){removeNotInitFeatures();outFeature=true};var currentoverlay=new Array();MappingKit.loadend1=function(e){currentoverlay[0]=e.object;removeNotInitFeatures()};var mappingurl=new Array(),mappinghref=new Array(),hoverin=false,settovisiable="hide",currentobject=new Array(),currentobject0Cnt=0,currentobjectidx=0,currentobjects=new Array(),currentobjectsidx=0,sameidsfromlinks=new Array(),sameidsfromlinksImage=false,hoveredLeftBar=false,coverFeature,newpath="",outSideMap=false,outFeature=true,loadCnt=0,totalCnt=0,allowBlink=1
function blink(){var arr=new Array();i=0;$("path").each(function(){if($(this).attr('stroke')=='green'){$e=$(this);arr[i]=$e;i++}});startBlink(arr)}
function startBlink(arr){if(allowBlink==0)return
function change_path_color(arr,color){for(var i=0;i<arr.length;i++){$e=arr[i];$e.attr('stroke',color)}};change_path_color(arr,'none');setTimeout(function(){change_path_color(arr,'green')},2e3);setTimeout(function(){startBlink(arr)},2500)};MappingKit.loadend=function(e){$("path").attr("stroke","transparent").attr("fill","transparent");if(currentobjectidx==0)currentobject0Cnt=e.object.features.length;currentobject[currentobjectidx++]=e.object;for(var item in e.object.features)currentobjects[currentobjectsidx++]=e.object.features[item];$('.view-anatomy-image-term-list ul li span.highlight-data-href:odd').addClass('data-href2-even');for(var item in e.object.features){featurepath=e.object.features[item].attributes.link;$(".view-anatomy-image-term-list ul li span.data-href").each(function(){if(featurepath==$(this).attr("data-featurepath"))if(mappingurl[e.object.features[item].geometry.id]);else{mappingurl[e.object.features[item].geometry.id]=$(this).attr("data-link");mappinghref[$(this).attr("data-featurepath")]=e.object.features[item].geometry.id}});$(".mappingurls").each(function(){if($(this).attr("data-featurepath")==featurepath)if(mappingurl[e.object.features[item].geometry.id]);else{mappingurl[e.object.features[item].geometry.id]=$(this).attr("data-link");mappinghref[$(this).attr("data-featurepath")]=e.object.features[item].geometry.id}})};for(var item in e.object.features){featurepath=e.object.features[item].attributes.link;$(".default_system_poly").each(function(){if($(this).attr("data-featurepath")==featurepath){var pathid=e.object.features[item].geometry.id;$("path").each(function(){if($(this).attr("id")==pathid)$(this).attr("stroke","green")})}})};$(".view-anatomy-image-term-list span.data-href").hover(function(){allowBlink=0;if(hoverin==true)return;hoverin=true;$("path").attr("stroke","transparent");var featurepath=$(this).attr("data-featurepath");for(var item in currentobjects)if(featurepath==currentobjects[item].attributes.link){var pathid=currentobjects[item].geometry.id;$("path").each(function(){if($(this).attr("id")==pathid){$(this).attr("stroke","green");sameidsfromlinks[pathid]=pathid}});$("image").each(function(){if($(this).attr("id")==pathid){sameidsfromlinks[pathid]=pathid;sameidsfromlinksImage=true;$(this).attr("href","http://www.innerbody.com/sites/all/themes/innerbodyv2/images/point-anim.gif")}})};$(this).parent().children(".mappingurls").each(function(){var featurepath=$(this).attr("data-featurepath");for(var item in currentobjects)if(featurepath==currentobjects[item].attributes.link){var pathid=currentobjects[item].geometry.id;$("path").each(function(){if($(this).attr("id")==pathid){sameidsfromlinks[pathid]=pathid;$(this).attr("stroke","green")}});$("image").each(function(){if($(this).attr("id")==pathid){sameidsfromlinks[pathid]=pathid;sameidsfromlinksImage=true;$(this).attr("href","http://www.innerbody.com/sites/all/themes/innerbodyv2/images/point-anim.gif")}})}});var hasitem=false;for(var item in sameidsfromlinks)hasitem=true;if(hasitem==false)return;if(sameidsfromlinksImage==true){sameidsfromlinks=new Array();sameidsfromlinksImage=false}else{var site_style={},site_points=new Array();site_points.push(new OpenLayers.Geometry.Point(0.570024570025,2819.1142506143));site_points.push(new OpenLayers.Geometry.Point(3e3,2819.1142506143));site_points.push(new OpenLayers.Geometry.Point(2990.171990172,0.91769041769));site_points.push(new OpenLayers.Geometry.Point(0.914004914005,0.91769041769));site_points.push(site_points[0]);var linear_ring=new OpenLayers.Geometry.LinearRing(site_points);polygonFeature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([linear_ring]),null,site_style);for(fid in sameidsfromlinks)for(var i=0;i<currentobject.length;i++)for(var item in currentobject[i].features)if(fid==currentobject[i].features[item].geometry.id)polygonFeature=Subtract(polygonFeature,currentobject[i].features[item]);coverFeature=polygonFeature;currentobject[0].addFeatures([coverFeature]);$("path").each(function(){if($(this).attr("id")==coverFeature.geometry.id){$(this).attr("fill","#ffffff");$(this).attr("fill-opacity","0.6");$(this).attr("stroke","transparent")}})}},function(){if(hoverin==true&&settovisiable=="hide"){$("path").attr("stroke","transparent").attr("fill","transparent");$("image").attr("href","http://www.innerbody.com/sites/all/themes/innerbodyv2/images/point-static.png")};hoverin=false;$(".default_system_poly").each(function(){var featurepath=$(this).attr("data-featurepath");for(var item in e.object.features)if(featurepath==e.object.features[item].attributes.link){var pathid=e.object.features[item].geometry.id;$("path").each(function(){if($(this).attr("id")==pathid)$(this).attr("stroke","green")})}});$("path").attr("fill","transparent");$("path").each(function(){if(coverFeature)if($(this).attr("id")==coverFeature.geometry.id)$(this).remove()});sameidsfromlinks=new Array();sameidsfromlinksImage=false});$("path").click(function(){window.location.href=mappingurl[$(this).attr("id")]});$("image").click(function(){window.location.href=mappingurl[$(this).attr("id")]});if($("body").hasClass("logged-in"))if($(".settovisiable").size()<=0)$("#map-map-0-block").after('<input type="radio" value="show" class="settovisiable" name="settovisiable">Visible polygons<br/><input type="radio" value="hide" checked="true" class="settovisiable" name="settovisiable">Transparent polygons / points');$(".settovisiable").click(function(){settovisiable=$(this).val();if($(this).val()=="show"){$("path").attr("stroke","green")}else{$("path").attr("stroke","transparent");refreshDefaultPolygons()}});$("#map-map-0-block").hover(function(){allowBlink=0;outSideMap=false},function(){$("path").attr("fill","transparent");$(".featurepathunselected").removeClass("featurepathunselected");if(settovisiable=="hide")$("path").attr("stroke","transparent");$("div.qtip").hide();$(".featurepathselected").removeClass("featurepathselected");refreshDefaultPolygons()});if($("body").hasClass("not-logged-in")){$("body").mousemove(function(event){var msg="Handler for .mousemove() called at ";msg+=event.pageX+", "+event.pageY;if(event.pageX>$("#map-map-0-block").offset().left&&event.pageX<$("#map-map-0-block").offset().left+$("#map-map-0-block").width()&&event.pageY>$("#map-map-0-block").offset().top&&event.pageY<$("#map-map-0-block").offset().top+$("#map-map-0-block").height());else{removeNotInitFeatures();outSideMap=true}});refreshDefaultPolygons()};loadCnt++;if(loadCnt==totalCnt)blink()}
function Subtract(bigFeature,smallFeature){var newPolygon=new OpenLayers.Geometry.Polygon(bigFeature.geometry.components),newFeature=new OpenLayers.Feature.Vector(newPolygon);newPolygon.addComponent(smallFeature.geometry.components[0]);return newFeature};MappingKit.handleFeatureUnselected=function(e){return MappingKit.onFeatureUnselect.apply(this,[e.feature])}
function addFeaturepathselected(featurepath){console.log("attempt");$(".view-anatomy-image-term-list .mappingurls").each(function(){if($(this).attr("data-featurepath")!="")if($(this).attr("data-featurepath")==featurepath)$(this).parent().children("span.data-href").addClass("featurepathselected")})};var sameids;MappingKit.onFeatureSelect=function(feature){sameids=new Array();MappingKit.selectedFeature=feature;featurepath=feature.attributes.link;var editorurl="",tp=0,newtp=0,winheight=330,firstele=0;outFeature=false;var blupdatePosition=false;$("path").attr("stroke","transparent");feature.layer.setZIndex(10);$(".view-anatomy-image-term-list .mappingurls").each(function(){if($(this).attr("data-featurepath")!="")if($(this).attr("data-featurepath")==featurepath){console.log($($(this).parent().children("span.data-href")));$(this).parent().children("span.data-href").addClass("featurepathselected");$(this).parent().children("span.data-href").animate({backgroundColor:"FF0000"},"slow");$(".view-anatomy-image-term-list ul li a.active").addClass("featurepathunselected");$(".qtip-link").each(function(){if($(this).attr("id")==$(".featurepathselected").parent().attr("id"))if(!$(this).data("toolTipAttached")){if($(this).children('.qtip-header').length){tooltip_title=$(this).children('.qtip-header').html()}else tooltip_title=false;$var1=$(this).qtip({content:{prerender:false,title:{text:tooltip_title},text:$(this).attr('data-popuptitle')},position:{corner:{target:Drupal.settings.qtip.target_position,tooltip:Drupal.settings.qtip.tooltip_position},adjust:{y:-3}},style:{tip:show_tip,border:{width:parseInt(Drupal.settings.qtip.border_width),radius:parseInt(Drupal.settings.qtip.border_radius)},name:Drupal.settings.qtip.color},show:{ready:true,when:{event:Drupal.settings.qtip.show_event_type},solo:'false',delay:show_delay},hide:{when:{event:Drupal.settings.qtip.hide_event_type}}});$(this).data("toolTipAttached",true);var alternate_api=$(this).qtip("api");alternate_api.elements.target.attr("qtlinkid",alternate_api.id)}});$qtipid=$(this).parent().attr("qtlinkid");editorurl=$(this).attr("href");$("div.qtip").hide();$("div.qtip").each(function(){if($(this).attr("qtip")==$qtipid)if(blupdatePosition==false){if($('.featurepathselected')&&$('.featurepathselected').size()>0);else addFeaturepathselected(featurepath);if($(".terms-double-list-bot")[0]){var container=$('.terms-double-list-bot .pane-content .item-list'),scrollTo=$('.featurepathselected');container.scrollTop(scrollTo.offset().top-container.offset().top+container.scrollTop())}else{tp=$('.featurepathselected').position().top-38;firstele=$("#qtip-link-0").position().top-38;winheight=330;if(tp>0&&tp<winheight);else $("#block-views-anatomy_image_term_list-default .content .item-list, .pane-anatomy-image-term-list .pane-content .item-list").scrollTop((tp-firstele))};var $popuponleftmenu=$(this);setTimeout(function(){if($('.featurepathselected')&&$('.featurepathselected').size()>0);else addFeaturepathselected(featurepath);if($('.featurepathselected')&&$('.featurepathselected').size()>0){newtp=$('.featurepathselected').position().top;$("div.qtip").hide();if(outSideMap==false){if(outFeature==false){$popuponleftmenu.show()}else $(".featurepathselected").removeClass("featurepathselected")}else $(".featurepathselected").removeClass("featurepathselected")}},500);blupdatePosition=true}})}});refreshSameGroupPolygrons();var count=0,description_type='none';for(var item in feature.attributes){count+=1;if(item=='description')description_type='html'};if(description_type=='html'){var content='<div style="font-size:.8em;">',title=feature.attributes['title']||feature.attributes['name'],link=feature.attributes['link'];if(title)content+='<h2><a href="'+link+'">'+title+'</a></h2>';if(feature.attributes['description']){content+=feature.attributes.description}else for(var item in feature.attributes)if(item!='name'&&feature.attributes[item]!=null&&feature.attributes[item]!='')content+='<p>'+item+'='+feature.attributes[item]+'</p>';content+='</div>'}else{var content='';content+='<div class="feature-layer">'+Drupal.t('Layer %layer',{'%layer':feature.layer.name})+'</div>';content+=Drupal.theme('feature',feature)};tooltipformap="";if($("body").hasClass("logged-in")){var content1="<a href='"+editorurl+"'>Term link</a><br/><a href='"+feature.attributes.link+"'>Polygon Link</a>",popups=feature.layer.map.popups;if(popups)for(var i=0;i<popups.length;i++)feature.layer.map.removePopup(popups[i])}else if(feature.geometry.id.indexOf("Point_")>0);else{var hasitem=false;for(var item in sameids)hasitem=true;if(hasitem==false)return;var site_style={},site_points=new Array();site_points.push(new OpenLayers.Geometry.Point(0.570024570025,2819.1142506143));site_points.push(new OpenLayers.Geometry.Point(3e3,2819.1142506143));site_points.push(new OpenLayers.Geometry.Point(2990.171990172,0.91769041769));site_points.push(new OpenLayers.Geometry.Point(0.914004914005,0.91769041769));site_points.push(site_points[0]);var linear_ring=new OpenLayers.Geometry.LinearRing(site_points);polygonFeature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([linear_ring]),null,site_style);for(fid in sameids)for(var i=0;i<currentobject.length;i++)for(var item in currentobject[i].features)if(fid==currentobject[i].features[item].geometry.id)polygonFeature=Subtract(polygonFeature,currentobject[i].features[item]);coverFeature=polygonFeature;currentoverlay[0].addFeatures([coverFeature]);$("path").each(function(){if($(this).attr("id")==coverFeature.geometry.id){$(this).attr("fill","#ffffff");$(this).attr("fill-opacity","0.6");$(this).attr("stroke","transparent");$(this).hover(function(){setTimeout(function(){if($(".featurepathselected").length>0);else removeNotInitFeatures()},500)},function(){})}})}}
function removeNotInitFeatures(){for(var i=currentoverlay[0].features.length;i>=0;i--)currentoverlay[0].removeFeatures(currentoverlay[0].features[i])};MappingKit.onFeatureUnselect=function(feature){$("path").attr("fill","transparent");$(".featurepathunselected").removeClass("featurepathunselected");featurepath=feature.attributes.link;if(settovisiable=="hide")$("path").attr("stroke","transparent");$("div.qtip").hide();$(".featurepathselected").removeClass("featurepathselected");outFeature=true;refreshDefaultPolygons()}
function refreshDefaultPolygons(){$(".default_system_poly").each(function(){var pathid=mappinghref[$(this).attr("data-featurepath")];$("path").each(function(){if($(this).attr("id")==pathid)$(this).attr("stroke","green")})})}
function refreshSameGroupPolygrons(){$(".featurepathselected").parent().children(".mappingurls").each(function(){var pathid=mappinghref[$(this).attr("data-featurepath")];$("path").each(function(){if($(this).attr("id")==pathid){$(this).attr("stroke","green");sameids[pathid]=pathid}})})}
function refreshForNonUser(){if($("body").hasClass("logged-in"));else $("path").each(function(){if($(this).attr("stroke")=="green")$(this).attr("stroke","transparent")})}
function ifInternetExplorerEight(){var rv=-1;if(navigator.appName=='Microsoft Internet Explorer'){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");if(re.exec(ua)!=null)rv=parseFloat(RegExp.$1)};if(rv>-1)if(rv<9){rv=true}else rv=false;return rv};MappingKit.supportsGeolocation=function(){return(navigator.geolocation)?true:false};MappingKit.getGeolocation=function(successHandler,errorHandler){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(successHandler,errorHandler)};MappingKit.getMapCookieKey=function(map){return map.id+'_'+location.href.replace(/([^a-z0-9_])/g,'')};Drupal.theme.prototype.feature=function(feature){var tpl='<div class="feature-item"><table class="feature-table">',count=0;for(var item in feature.attributes){count+=1;if(feature.attributes[item])tpl+='<tr class="'+((count&1)!=0?'odd':'even')+'">'+Drupal.theme('featureAttribute',feature,item,feature.attributes[item])+'</tr>'};tpl+='</table></div>';return tpl};Drupal.theme.prototype.featureAttribute=function(featureType,name,value){var tpl='';tpl+='<td class="feature-attribute-name">'+MappingKit.translateAttribute(name)+'</td><td class="feature-attribute-value">'+value+'</td>';return tpl};MappingKit.search=function(obj,options){var elem=obj.previousSibling.firstChild,value=elem.value.trim();if(value.length<=0){alert(Drupal.t('Enter a value to search for !attr in !layer',{'!attr':options.attribute,'!layer':options.layer}))}else{var map=MappingKit.getMap(elem.id.substr(0,elem.id.indexOf('-search-input'))),layers=map.getLayersByName(options.layer);if(layers.length>0){var protocol=OpenLayers.Protocol.WFS.fromWMSLayer(layers[0],{featurePrefix:options.featurePrefix,version:options.version,maxFeatures:options.maxFeatures?options.maxFeatures:1,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:options.attribute,value:value}),callback:MappingKit.searchCallback}),response=protocol.read()}}};MappingKit.searchCallback=function(response){if(response.features.length>0){var map=MappingKit.getMap(),geom=response.features[0].geometry,centroid=geom.getCentroid(),bounds=geom.getBounds(),zoom=map.getZoomForExtent(bounds);zoom-=1;map.setCenter(new OpenLayers.LonLat(centroid.x,centroid.y),zoom)}else alert(Drupal.t('No feature found.'))};
OpenLayers.Control.MapProjection=OpenLayers.Class(OpenLayers.Control,{displayProjection:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.redraw();return this.div},redraw:function(evt){if(this.displayProjection){this.div.innerHTML=this.displayProjection}else this.div.innerHTML=$defined(this.map.displayProjection)?this.map.displayProjection:this.map.projection},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register('changebaselayer',this,this.redraw)},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.MapProjection"});
MappingKit.Format=MappingKit.Format||{};MappingKit.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.GeoRSS,{initialize:function(){OpenLayers.Format.GeoRSS.prototype.initialize.apply(this,arguments)},createFeatureFromItem:function(item){var feature=OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments),pubDate=this.getChildValue(item,'*','pubDate');if(pubDate)feature.attributes.pubDate=pubDate;var thumbnails=this.getElementsByTagNameNS(item,"*","thumbnail");if(thumbnails&&thumbnails.length>0){feature.attributes.thumbnail=thumbnails[0].getAttribute('url');if(!feature.attributes.thumbnail)feature.attributes.thumbnail=thumbnails[0].textContent};return feature},CLASS_NAME:'MappingKit.Format.GeoRSS'});
MappingKit.Control.ArgParser=OpenLayers.Class(OpenLayers.Control.ArgParser,{args:null,cookies:false,initialize:function(options){OpenLayers.Control.ArgParser.prototype.initialize.apply(this,arguments)},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);if(this.map.options)this.cookies=this.map.options.useCookies;for(var i=0,len=this.map.controls.length;i<len;i++){var control=this.map.controls[i];if((control!=this)&&(control.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(control.displayProjection!=this.displayProjection)this.displayProjection=control.displayProjection;break}};if(i==this.map.controls.length){var args={};if(this.args)args=OpenLayers.Util.getParameters('?'+this.args);OpenLayers.Util.extend(args,OpenLayers.Util.getParameters());if(this.cookies&&document.cookie){var cookies=document.cookie.split(';');for(var i=0,count=cookies.length;i<count;i++){var cookie=cookies[i].trim(),len=cookie.indexOf('='),key=cookie.substr(0,len);if(key==MappingKit.getMapCookieKey(this.map)){var value=decodeURIComponent(cookie.substr(len+1)),cookieParams=OpenLayers.Util.getParameters('?'+value);if(cookieParams.search==window.location.search)OpenLayers.Util.extend(args,cookieParams);break}}};if(args.layers){this.layers=args.layers;this.map.events.register('addlayer',this,this.configureLayers);this.configureLayers()};if(args.lat&&args.lon){this.center=new OpenLayers.LonLat(parseFloat(args.lon),parseFloat(args.lat));if(args.zoom)this.zoom=parseInt(args.zoom);this.map.events.register('changebaselayer',this,this.setCenter);this.setCenter()}}},CLASS_NAME:"MappingKit.Control.ArgParser"});
OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options])},setVisible:function(visible){this.visible=visible;if(visible){OpenLayers.Element.show(this.div)}else OpenLayers.Element.hide(this.div)},getVisible:function(){return this.visible},hide:function(){this.setVisible(false)},show:function(){this.setVisible(true)},toggle:function(){this.setVisible(!this.getVisible())},addLayer:function(evt){if(evt.layer){evt.layer.events.register('loadstart',this,this.increaseCounter);evt.layer.events.register('loadend',this,this.decreaseCounter)}},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register('preaddlayer',this,this.addLayer);for(var i=0;i<this.map.layers.length;i++){var layer=this.map.layers[i];layer.events.register('loadstart',this,this.increaseCounter);layer.events.register('loadend',this,this.decreaseCounter)}},increaseCounter:function(){this.counter++;if(this.counter>0)if(!this.maximized&&this.visible)this.maximizeControl()},decreaseCounter:function(){if(this.counter>0)this.counter--;if(this.counter==0)if(this.maximized&&this.visible)this.minimizeControl()},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div},minimizeControl:function(evt){this.div.style.display="none";this.maximized=false;if(evt!=null)OpenLayers.Event.stop(evt)},maximizeControl:function(evt){this.div.style.display="block";var viewSize=this.map.getSize(),msgW=viewSize.w,msgH=viewSize.h;this.div.style.left=msgW/2-this.div.offsetWidth/2+"px";this.div.style.top=msgH/2-this.div.offsetHeight/2+"px";this.maximized=true;if(evt!=null)OpenLayers.Event.stop(evt)},destroy:function(){if(this.map){this.map.events.unregister('preaddlayer',this,this.addLayer);if(this.map.layers)for(var i=0;i<this.map.layers.length;i++){var layer=this.map.layers[i];layer.events.unregister('loadstart',this,this.increaseCounter);layer.events.unregister('loadend',this,this.decreaseCounter)}};OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});